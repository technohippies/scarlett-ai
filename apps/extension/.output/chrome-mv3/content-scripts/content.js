var content=function(){"use strict";var zn=Object.defineProperty;var Wn=(te,V,ne)=>V in te?zn(te,V,{enumerable:!0,configurable:!0,writable:!0,value:ne}):te[V]=ne;var Y=(te,V,ne)=>Wn(te,typeof V!="symbol"?V+"":V,ne);var ct,ut;const V=(e,t)=>e===t,ne=Symbol("solid-track"),pe={equals:V};let We=Xe;const J=1,ye=2,Ve={owned:null,cleanups:null,context:null,owner:null};var $=null;let Pe=null,dt=null,L=null,U=null,q=null,me=0;function be(e,t){const n=L,o=$,r=e.length===0,s=t===void 0?o:t,a=r?Ve:{owned:null,cleanups:null,context:s?s.context:null,owner:s},i=r?e:()=>e(()=>H(()=>ue(a)));$=a,L=null;try{return ce(i,!0)}finally{L=n,$=o}}function w(e,t){t=t?Object.assign({},pe,t):pe;const n={value:e,observers:null,observerSlots:null,comparator:t.equals||void 0},o=r=>(typeof r=="function"&&(r=r(n.value)),Ge(n,r));return[He.bind(n),o]}function W(e,t,n){const o=$e(e,t,!1,J);le(o)}function ve(e,t,n){We=mt;const o=$e(e,t,!1,J);o.user=!0,q?q.push(o):le(o)}function Q(e,t,n){n=n?Object.assign({},pe,n):pe;const o=$e(e,t,!0,0);return o.observers=null,o.observerSlots=null,o.comparator=n.equals||void 0,le(o),He.bind(o)}function H(e){if(L===null)return e();const t=L;L=null;try{return e()}finally{L=t}}function ft(e){ve(()=>H(e))}function we(e){return $===null||($.cleanups===null?$.cleanups=[e]:$.cleanups.push(e)),e}function ht(e,t){const n=Symbol("context");return{id:n,Provider:vt(n),defaultValue:e}}function qe(e){let t;return $&&$.context&&(t=$.context[e.id])!==void 0?t:e.defaultValue}function gt(e){const t=Q(e),n=Q(()=>Ie(t()));return n.toArray=()=>{const o=n();return Array.isArray(o)?o:o!=null?[o]:[]},n}function He(){if(this.sources&&this.state)if(this.state===J)le(this);else{const e=U;U=null,ce(()=>Se(this),!1),U=e}if(L){const e=this.observers?this.observers.length:0;L.sources?(L.sources.push(this),L.sourceSlots.push(e)):(L.sources=[this],L.sourceSlots=[e]),this.observers?(this.observers.push(L),this.observerSlots.push(L.sources.length-1)):(this.observers=[L],this.observerSlots=[L.sources.length-1])}return this.value}function Ge(e,t,n){let o=e.value;return(!e.comparator||!e.comparator(o,t))&&(e.value=t,e.observers&&e.observers.length&&ce(()=>{for(let r=0;r<e.observers.length;r+=1){const s=e.observers[r],a=Pe&&Pe.running;a&&Pe.disposed.has(s),(a?!s.tState:!s.state)&&(s.pure?U.push(s):q.push(s),s.observers&&Je(s)),a||(s.state=J)}if(U.length>1e6)throw U=[],new Error},!1)),t}function le(e){if(!e.fn)return;ue(e);const t=me;pt(e,e.value,t)}function pt(e,t,n){let o;const r=$,s=L;L=$=e;try{o=e.fn(t)}catch(a){return e.pure&&(e.state=J,e.owned&&e.owned.forEach(ue),e.owned=null),e.updatedAt=n+1,Ye(a)}finally{L=s,$=r}(!e.updatedAt||e.updatedAt<=n)&&(e.updatedAt!=null&&"observers"in e?Ge(e,o):e.value=o,e.updatedAt=n)}function $e(e,t,n,o=J,r){const s={fn:e,state:o,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:$,context:$?$.context:null,pure:n};return $===null||$!==Ve&&($.owned?$.owned.push(s):$.owned=[s]),s}function ke(e){if(e.state===0)return;if(e.state===ye)return Se(e);if(e.suspense&&H(e.suspense.inFallback))return e.suspense.effects.push(e);const t=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<me);)e.state&&t.push(e);for(let n=t.length-1;n>=0;n--)if(e=t[n],e.state===J)le(e);else if(e.state===ye){const o=U;U=null,ce(()=>Se(e,t[0]),!1),U=o}}function ce(e,t){if(U)return e();let n=!1;t||(U=[]),q?n=!0:q=[],me++;try{const o=e();return yt(n),o}catch(o){n||(q=null),U=null,Ye(o)}}function yt(e){if(U&&(Xe(U),U=null),e)return;const t=q;q=null,t.length&&ce(()=>We(t),!1)}function Xe(e){for(let t=0;t<e.length;t++)ke(e[t])}function mt(e){let t,n=0;for(t=0;t<e.length;t++){const o=e[t];o.user?e[n++]=o:ke(o)}for(t=0;t<n;t++)ke(e[t])}function Se(e,t){e.state=0;for(let n=0;n<e.sources.length;n+=1){const o=e.sources[n];if(o.sources){const r=o.state;r===J?o!==t&&(!o.updatedAt||o.updatedAt<me)&&ke(o):r===ye&&Se(o,t)}}}function Je(e){for(let t=0;t<e.observers.length;t+=1){const n=e.observers[t];n.state||(n.state=ye,n.pure?U.push(n):q.push(n),n.observers&&Je(n))}}function ue(e){let t;if(e.sources)for(;e.sources.length;){const n=e.sources.pop(),o=e.sourceSlots.pop(),r=n.observers;if(r&&r.length){const s=r.pop(),a=n.observerSlots.pop();o<r.length&&(s.sourceSlots[a]=o,r[o]=s,n.observerSlots[o]=a)}}if(e.tOwned){for(t=e.tOwned.length-1;t>=0;t--)ue(e.tOwned[t]);delete e.tOwned}if(e.owned){for(t=e.owned.length-1;t>=0;t--)ue(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}e.state=0}function bt(e){return e instanceof Error?e:new Error(typeof e=="string"?e:"Unknown error",{cause:e})}function Ye(e,t=$){throw bt(e)}function Ie(e){if(typeof e=="function"&&!e.length)return Ie(e());if(Array.isArray(e)){const t=[];for(let n=0;n<e.length;n++){const o=Ie(e[n]);Array.isArray(o)?t.push.apply(t,o):t.push(o)}return t}return e}function vt(e,t){return function(o){let r;return W(()=>r=H(()=>($.context={...$.context,[e]:o.value},gt(()=>o.children))),void 0),r}}const wt=Symbol("fallback");function Qe(e){for(let t=0;t<e.length;t++)e[t]()}function kt(e,t,n={}){let o=[],r=[],s=[],a=0,i=t.length>1?[]:null;return we(()=>Qe(s)),()=>{let l=e()||[],c=l.length,f,d;return l[ne],H(()=>{let A,k,T,R,B,M,P,I,K;if(c===0)a!==0&&(Qe(s),s=[],o=[],r=[],a=0,i&&(i=[])),n.fallback&&(o=[wt],r[0]=be(F=>(s[0]=F,n.fallback())),a=1);else if(a===0){for(r=new Array(c),d=0;d<c;d++)o[d]=l[d],r[d]=be(C);a=c}else{for(T=new Array(c),R=new Array(c),i&&(B=new Array(c)),M=0,P=Math.min(a,c);M<P&&o[M]===l[M];M++);for(P=a-1,I=c-1;P>=M&&I>=M&&o[P]===l[I];P--,I--)T[I]=r[P],R[I]=s[P],i&&(B[I]=i[P]);for(A=new Map,k=new Array(I+1),d=I;d>=M;d--)K=l[d],f=A.get(K),k[d]=f===void 0?-1:f,A.set(K,d);for(f=M;f<=P;f++)K=o[f],d=A.get(K),d!==void 0&&d!==-1?(T[d]=r[f],R[d]=s[f],i&&(B[d]=i[f]),d=k[d],A.set(K,d)):s[f]();for(d=M;d<c;d++)d in T?(r[d]=T[d],s[d]=R[d],i&&(i[d]=B[d],i[d](d))):r[d]=be(C);r=r.slice(0,a=c),o=l.slice(0)}return r});function C(A){if(s[d]=A,i){const[k,T]=w(d);return i[d]=T,t(l[d],k)}return t(l[d])}}}function _(e,t){return H(()=>e(t||{}))}const St=e=>`Stale read from <${e}>.`;function Ze(e){const t="fallback"in e&&{fallback:()=>e.fallback};return Q(kt(()=>e.each,e.children,t||void 0))}function Z(e){const t=e.keyed,n=Q(()=>e.when,void 0,void 0),o=t?n:Q(n,void 0,{equals:(r,s)=>!r==!s});return Q(()=>{const r=o();if(r){const s=e.children;return typeof s=="function"&&s.length>0?H(()=>s(t?r:()=>{if(!H(o))throw St("Show");return n()})):s}return e.fallback},void 0,void 0)}const G=e=>Q(()=>e());function xt(e,t,n){let o=n.length,r=t.length,s=o,a=0,i=0,l=t[r-1].nextSibling,c=null;for(;a<r||i<s;){if(t[a]===n[i]){a++,i++;continue}for(;t[r-1]===n[s-1];)r--,s--;if(r===a){const f=s<o?i?n[i-1].nextSibling:n[s-i]:l;for(;i<s;)e.insertBefore(n[i++],f)}else if(s===i)for(;a<r;)(!c||!c.has(t[a]))&&t[a].remove(),a++;else if(t[a]===n[s-1]&&n[i]===t[r-1]){const f=t[--r].nextSibling;e.insertBefore(n[i++],t[a++].nextSibling),e.insertBefore(n[--s],f),t[r]=n[s]}else{if(!c){c=new Map;let d=i;for(;d<s;)c.set(n[d],d++)}const f=c.get(t[a]);if(f!=null)if(i<f&&f<s){let d=a,C=1,A;for(;++d<r&&d<s&&!((A=c.get(t[d]))==null||A!==f+C);)C++;if(C>f-i){const k=t[a];for(;i<f;)e.insertBefore(n[i++],k)}else e.replaceChild(n[i++],t[a++])}else a++;else t[a++].remove()}}}const et="_$DX_DELEGATE";function Ct(e,t,n,o={}){let r;return be(s=>{r=s,t===document?e():x(t,e(),t.firstChild?null:void 0,n)},o.owner),()=>{r(),t.textContent=""}}function D(e,t,n,o){let r;const s=()=>{const i=document.createElement("template");return i.innerHTML=e,i.content.firstChild},a=()=>(r||(r=s())).cloneNode(!0);return a.cloneNode=a,a}function X(e,t=window.document){const n=t[et]||(t[et]=new Set);for(let o=0,r=e.length;o<r;o++){const s=e[o];n.has(s)||(n.add(s),t.addEventListener(s,Et))}}function At(e,t,n){n==null?e.removeAttribute(t):e.setAttribute(t,n)}function O(e,t){t==null?e.removeAttribute("class"):e.className=t}function tt(e,t,n,o){Array.isArray(n)?(e[`$$${t}`]=n[0],e[`$$${t}Data`]=n[1]):e[`$$${t}`]=n}function Tt(e,t,n){return H(()=>e(t,n))}function x(e,t,n,o){if(n!==void 0&&!o&&(o=[]),typeof t!="function")return xe(e,t,o,n);W(r=>xe(e,t(),r,n),o)}function Et(e){let t=e.target;const n=`$$${e.type}`,o=e.target,r=e.currentTarget,s=l=>Object.defineProperty(e,"target",{configurable:!0,value:l}),a=()=>{const l=t[n];if(l&&!t.disabled){const c=t[`${n}Data`];if(c!==void 0?l.call(t,c,e):l.call(t,e),e.cancelBubble)return}return t.host&&typeof t.host!="string"&&!t.host._$host&&t.contains(e.target)&&s(t.host),!0},i=()=>{for(;a()&&(t=t._$host||t.parentNode||t.host););};if(Object.defineProperty(e,"currentTarget",{configurable:!0,get(){return t||document}}),e.composedPath){const l=e.composedPath();s(l[0]);for(let c=0;c<l.length-2&&(t=l[c],!!a());c++){if(t._$host){t=t._$host,i();break}if(t.parentNode===r)break}}else i();s(o)}function xe(e,t,n,o,r){for(;typeof n=="function";)n=n();if(t===n)return n;const s=typeof t,a=o!==void 0;if(e=a&&n[0]&&n[0].parentNode||e,s==="string"||s==="number"){if(s==="number"&&(t=t.toString(),t===n))return n;if(a){let i=n[0];i&&i.nodeType===3?i.data!==t&&(i.data=t):i=document.createTextNode(t),n=oe(e,n,o,i)}else n!==""&&typeof n=="string"?n=e.firstChild.data=t:n=e.textContent=t}else if(t==null||s==="boolean")n=oe(e,n,o);else{if(s==="function")return W(()=>{let i=t();for(;typeof i=="function";)i=i();n=xe(e,i,n,o)}),()=>n;if(Array.isArray(t)){const i=[],l=n&&Array.isArray(n);if(_e(i,t,n,r))return W(()=>n=xe(e,i,n,o,!0)),()=>n;if(i.length===0){if(n=oe(e,n,o),a)return n}else l?n.length===0?nt(e,i,o):xt(e,n,i):(n&&oe(e),nt(e,i));n=i}else if(t.nodeType){if(Array.isArray(n)){if(a)return n=oe(e,n,o,t);oe(e,n,null,t)}else n==null||n===""||!e.firstChild?e.appendChild(t):e.replaceChild(t,e.firstChild);n=t}}return n}function _e(e,t,n,o){let r=!1;for(let s=0,a=t.length;s<a;s++){let i=t[s],l=n&&n[e.length],c;if(!(i==null||i===!0||i===!1))if((c=typeof i)=="object"&&i.nodeType)e.push(i);else if(Array.isArray(i))r=_e(e,i,l)||r;else if(c==="function")if(o){for(;typeof i=="function";)i=i();r=_e(e,Array.isArray(i)?i:[i],Array.isArray(l)?l:[l])||r}else e.push(i),r=!0;else{const f=String(i);l&&l.nodeType===3&&l.data===f?e.push(l):e.push(document.createTextNode(f))}}return r}function nt(e,t,n=null){for(let o=0,r=t.length;o<r;o++)e.insertBefore(t[o],n)}function oe(e,t,n,o){if(n===void 0)return e.textContent="";const r=o||document.createTextNode("");if(t.length){let s=!1;for(let a=t.length-1;a>=0;a--){const i=t[a];if(r!==i){const l=i.parentNode===e;!s&&!a?l?e.replaceChild(r,i):e.insertBefore(r,n):l&&i.remove()}else s=!0}}else e.insertBefore(r,n);return[r]}const re=(ut=(ct=globalThis.browser)==null?void 0:ct.runtime)!=null&&ut.id?globalThis.browser:globalThis.chrome;function Pt(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Fe,ot;function $t(){if(ot)return Fe;ot=1;var e=/^[a-z](?:[\.0-9_a-z\xB7\xC0-\xD6\xD8-\xF6\xF8-\u037D\u037F-\u1FFF\u200C\u200D\u203F\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])*-(?:[\x2D\.0-9_a-z\xB7\xC0-\xD6\xD8-\xF6\xF8-\u037D\u037F-\u1FFF\u200C\u200D\u203F\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])*$/,t=function(n){return e.test(n)};return Fe=t,Fe}var It=$t();const _t=Pt(It);var Ft=(e,t,n)=>new Promise((o,r)=>{var s=l=>{try{i(n.next(l))}catch(c){r(c)}},a=l=>{try{i(n.throw(l))}catch(c){r(c)}},i=l=>l.done?o(l.value):Promise.resolve(l.value).then(s,a);i((n=n.apply(e,t)).next())});function Kt(e){return Ft(this,null,function*(){const{name:t,mode:n="closed",css:o,isolateEvents:r=!1}=e;if(!_t(t))throw Error(`"${t}" is not a valid custom element name. It must be two words and kebab-case, with a few exceptions. See spec for more details: https://html.spec.whatwg.org/multipage/custom-elements.html#valid-custom-element-name`);const s=document.createElement(t),a=s.attachShadow({mode:n}),i=document.createElement("html"),l=document.createElement("body"),c=document.createElement("head");if(o){const f=document.createElement("style");"url"in o?f.textContent=yield fetch(o.url).then(d=>d.text()):f.textContent=o.textContent,c.appendChild(f)}return i.appendChild(c),i.appendChild(l),a.appendChild(i),r&&(Array.isArray(r)?r:["keydown","keyup","keypress"]).forEach(d=>{l.addEventListener(d,C=>C.stopPropagation())}),{parentElement:s,shadow:a,isolatedElement:l}})}const Lt=Symbol("null");let Dt=0;class Rt extends Map{constructor(){super(),this._objectHashes=new WeakMap,this._symbolHashes=new Map,this._publicKeys=new Map;const[t]=arguments;if(t!=null){if(typeof t[Symbol.iterator]!="function")throw new TypeError(typeof t+" is not iterable (cannot read property Symbol(Symbol.iterator))");for(const[n,o]of t)this.set(n,o)}}_getPublicKeys(t,n=!1){if(!Array.isArray(t))throw new TypeError("The keys parameter must be an array");const o=this._getPrivateKey(t,n);let r;return o&&this._publicKeys.has(o)?r=this._publicKeys.get(o):n&&(r=[...t],this._publicKeys.set(o,r)),{privateKey:o,publicKey:r}}_getPrivateKey(t,n=!1){const o=[];for(let r of t){r===null&&(r=Lt);const s=typeof r=="object"||typeof r=="function"?"_objectHashes":typeof r=="symbol"?"_symbolHashes":!1;if(!s)o.push(r);else if(this[s].has(r))o.push(this[s].get(r));else if(n){const a=`@@mkm-ref-${Dt++}@@`;this[s].set(r,a),o.push(a)}else return!1}return JSON.stringify(o)}set(t,n){const{publicKey:o}=this._getPublicKeys(t,!0);return super.set(o,n)}get(t){const{publicKey:n}=this._getPublicKeys(t);return super.get(n)}has(t){const{publicKey:n}=this._getPublicKeys(t);return super.has(n)}delete(t){const{publicKey:n,privateKey:o}=this._getPublicKeys(t);return!!(n&&super.delete(n)&&this._publicKeys.delete(o))}clear(){super.clear(),this._symbolHashes.clear(),this._publicKeys.clear()}get[Symbol.toStringTag](){return"ManyKeysMap"}get size(){return super.size}}function Ke(e){if(e===null||typeof e!="object")return!1;const t=Object.getPrototypeOf(e);return t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||Symbol.iterator in e?!1:Symbol.toStringTag in e?Object.prototype.toString.call(e)==="[object Module]":!0}function Le(e,t,n=".",o){if(!Ke(t))return Le(e,{},n,o);const r=Object.assign({},t);for(const s in e){if(s==="__proto__"||s==="constructor")continue;const a=e[s];a!=null&&(o&&o(r,s,a,n)||(Array.isArray(a)&&Array.isArray(r[s])?r[s]=[...a,...r[s]]:Ke(a)&&Ke(r[s])?r[s]=Le(a,r[s],(n?`${n}.`:"")+s.toString(),o):r[s]=a))}return r}function Mt(e){return(...t)=>t.reduce((n,o)=>Le(n,o,"",e),{})}const Nt=Mt(),rt=e=>e!==null?{isDetected:!0,result:e}:{isDetected:!1},Ut=e=>e===null?{isDetected:!0,result:null}:{isDetected:!1},Ot=()=>({target:globalThis.document,unifyProcess:!0,detector:rt,observeConfigs:{childList:!0,subtree:!0,attributes:!0},signal:void 0,customMatcher:void 0}),jt=(e,t)=>Nt(e,t),De=new Rt;function Bt(e){const{defaultOptions:t}=e;return(n,o)=>{const{target:r,unifyProcess:s,observeConfigs:a,detector:i,signal:l,customMatcher:c}=jt(o,t),f=[n,r,s,a,i,l,c],d=De.get(f);if(s&&d)return d;const C=new Promise(async(A,k)=>{if(l!=null&&l.aborted)return k(l.reason);const T=new MutationObserver(async B=>{for(const M of B){if(l!=null&&l.aborted){T.disconnect();break}const P=await st({selector:n,target:r,detector:i,customMatcher:c});if(P.isDetected){T.disconnect(),A(P.result);break}}});l==null||l.addEventListener("abort",()=>(T.disconnect(),k(l.reason)),{once:!0});const R=await st({selector:n,target:r,detector:i,customMatcher:c});if(R.isDetected)return A(R.result);T.observe(r,a)}).finally(()=>{De.delete(f)});return De.set(f,C),C}}async function st({target:e,selector:t,detector:n,customMatcher:o}){const r=o?o(t):e.querySelector(t);return await n(r)}const zt=Bt({defaultOptions:Ot()});function Ce(e,...t){}const Re={debug:(...e)=>Ce(console.debug,...e),log:(...e)=>Ce(console.log,...e),warn:(...e)=>Ce(console.warn,...e),error:(...e)=>Ce(console.error,...e)};function Wt(e,t,n){var o,r;n.position!=="inline"&&(n.zIndex!=null&&(e.style.zIndex=String(n.zIndex)),e.style.overflow="visible",e.style.position="relative",e.style.width="0",e.style.height="0",e.style.display="block",t&&(n.position==="overlay"?(t.style.position="absolute",(o=n.alignment)!=null&&o.startsWith("bottom-")?t.style.bottom="0":t.style.top="0",(r=n.alignment)!=null&&r.endsWith("-right")?t.style.right="0":t.style.left="0"):(t.style.position="fixed",t.style.top="0",t.style.bottom="0",t.style.left="0",t.style.right="0")))}function Me(e){if(e.anchor==null)return document.body;let t=typeof e.anchor=="function"?e.anchor():e.anchor;return typeof t=="string"?t.startsWith("/")?document.evaluate(t,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue??void 0:document.querySelector(t)??void 0:t??void 0}function Vt(e,t){var o,r;const n=Me(t);if(n==null)throw Error("Failed to mount content script UI: could not find anchor element");switch(t.append){case void 0:case"last":n.append(e);break;case"first":n.prepend(e);break;case"replace":n.replaceWith(e);break;case"after":(o=n.parentElement)==null||o.insertBefore(e,n.nextElementSibling);break;case"before":(r=n.parentElement)==null||r.insertBefore(e,n);break;default:t.append(n,e);break}}function qt(e,t){let n;const o=()=>{n==null||n.stopAutoMount(),n=void 0},r=()=>{e.mount()},s=e.remove;return{mount:r,remove:()=>{o(),e.remove()},autoMount:l=>{n&&Re.warn("autoMount is already set."),n=Ht({mount:r,unmount:s,stopAutoMount:o},{...t,...l})}}}function Ht(e,t){const n=new AbortController,o="explicit_stop_auto_mount",r=()=>{var i;n.abort(o),(i=t.onStop)==null||i.call(t)};let s=typeof t.anchor=="function"?t.anchor():t.anchor;if(s instanceof Element)throw Error("autoMount and Element anchor option cannot be combined. Avoid passing `Element` directly or `() => Element` to the anchor.");async function a(i){let l=!!Me(t);for(l&&e.mount();!n.signal.aborted;)try{l=!!await zt(i??"body",{customMatcher:()=>Me(t)??null,detector:l?Ut:rt,signal:n.signal}),l?e.mount():(e.unmount(),t.once&&e.stopAutoMount())}catch(c){if(n.signal.aborted&&n.signal.reason===o)break;throw c}}return a(s),{stopAutoMount:r}}function Gt(e){let t=e,n="";const o=/(\s*@(property|font-face)[\s\S]*?{[\s\S]*?})/gm;let r;for(;(r=o.exec(e))!==null;)n+=r[1],t=t.replace(r[1],"");return{documentCss:n.trim(),shadowCss:t.trim()}}async function Xt(e,t){var A;const n=Math.random().toString(36).substring(2,15),o=[];if(t.inheritStyles||o.push("/* WXT Shadow Root Reset */ :host{all:initial !important;}"),t.css&&o.push(t.css),((A=e.options)==null?void 0:A.cssInjectionMode)==="ui"){const k=await Jt();o.push(k.replaceAll(":root",":host"))}const{shadowCss:r,documentCss:s}=Gt(o.join(`
`).trim()),{isolatedElement:a,parentElement:i,shadow:l}=await Kt({name:t.name,css:{textContent:r},mode:t.mode??"open",isolateEvents:t.isolateEvents});i.setAttribute("data-wxt-shadow-root","");let c;const f=()=>{if(Vt(i,t),Wt(i,l.querySelector("html"),t),s&&!document.querySelector(`style[wxt-shadow-root-document-styles="${n}"]`)){const k=document.createElement("style");k.textContent=s,k.setAttribute("wxt-shadow-root-document-styles",n),(document.head??document.body).append(k)}c=t.onMount(a,l,i)},d=()=>{var T;(T=t.onRemove)==null||T.call(t,c),i.remove();const k=document.querySelector(`style[wxt-shadow-root-document-styles="${n}"]`);for(k==null||k.remove();a.lastChild;)a.removeChild(a.lastChild);c=void 0},C=qt({mount:f,remove:d},t);return e.onInvalidated(d),{shadow:l,shadowHost:i,uiContainer:a,...C,get mounted(){return c}}}async function Jt(){const e=re.runtime.getURL("/content-scripts/content.css");try{return await(await fetch(e)).text()}catch(t){return Re.warn(`Failed to load styles @ ${e}. Did you forget to import the stylesheet in your entrypoint?`,t),""}}function qn(e){return e}function it(e){var t,n,o="";if(typeof e=="string"||typeof e=="number")o+=e;else if(typeof e=="object")if(Array.isArray(e)){var r=e.length;for(t=0;t<r;t++)e[t]&&(n=it(e[t]))&&(o&&(o+=" "),o+=n)}else for(n in e)e[n]&&(o&&(o+=" "),o+=n);return o}function Yt(){for(var e,t,n=0,o="",r=arguments.length;n<r;n++)(e=arguments[n])&&(t=it(e))&&(o&&(o+=" "),o+=t);return o}function j(...e){return Yt(e)}X(["click"]);var Qt=D('<div><div class="bg-surface rounded-lg p-4 flex flex-col items-center justify-center min-h-[80px]"><div class="text-2xl font-mono font-bold text-accent-primary"></div><div class="text-sm text-secondary mt-1">Score</div></div><div class="bg-surface rounded-lg p-4 flex flex-col items-center justify-center min-h-[80px]"><div class="text-2xl font-mono font-bold text-accent-secondary"></div><div class="text-sm text-secondary mt-1">Rank');const Zt=e=>(()=>{var t=Qt(),n=t.firstChild,o=n.firstChild,r=n.nextSibling,s=r.firstChild;return x(o,()=>e.score),x(s,()=>e.rank),W(()=>O(t,j("grid grid-cols-[1fr_1fr] gap-2 p-4",e.class))),t})();X(["click","input"]);var en=D("<div><div class=space-y-8>"),tn=D("<div>");const nn=e=>{const[t,n]=w(-1);let o;return ve(()=>{if(!e.currentTime){n(-1);return}const r=e.currentTime,s=e.lyrics.findIndex(a=>{const i=a.startTime+a.duration;return r>=a.startTime&&r<i});n(s)}),ve(()=>{const r=t();if(r===-1||!o||!e.isPlaying)return;const a=o.querySelectorAll("[data-line-index]")[r];if(a){const i=o.clientHeight,l=a.offsetTop,c=a.offsetHeight,f=l-i/2+c/2;o.scrollTo({top:f,behavior:"smooth"})}}),(()=>{var r=en(),s=r.firstChild,a=o;return typeof a=="function"?Tt(a,r):o=r,x(s,_(Ze,{get each(){return e.lyrics},children:(i,l)=>(()=>{var c=tn();return x(c,()=>i.text),W(f=>{var d=l(),C=j("text-center transition-all duration-300","text-2xl leading-relaxed",l()===t()?"text-primary font-semibold scale-110":"text-secondary opacity-60");return d!==f.e&&At(c,"data-line-index",f.e=d),C!==f.t&&O(c,f.t=C),f},{e:void 0,t:void 0}),c})()})),W(()=>O(r,j("lyrics-display overflow-y-auto scroll-smooth","h-full px-6 py-12",e.class))),r})()};X(["click"]);var on=D("<div>"),rn=D("<div><span>#</span><span></span><span>");const sn=e=>(()=>{var t=on();return x(t,_(Ze,{get each(){return e.entries},children:n=>(()=>{var o=rn(),r=o.firstChild;r.firstChild;var s=r.nextSibling,a=s.nextSibling;return x(r,()=>n.rank,null),x(s,()=>n.username),x(a,()=>n.score.toLocaleString()),W(i=>{var l=j("flex items-center gap-3 px-3 py-2 rounded-lg transition-colors",n.isCurrentUser?"bg-accent-primary/10 border border-accent-primary/20":"bg-surface hover:bg-surface-hover"),c=j("w-8 text-center font-mono font-bold",n.rank<=3?"text-accent-primary":"text-secondary"),f=j("flex-1 truncate",n.isCurrentUser?"text-accent-primary font-medium":"text-primary"),d=j("font-mono font-bold",n.isCurrentUser?"text-accent-primary":"text-primary");return l!==i.e&&O(o,i.e=l),c!==i.t&&O(r,i.t=c),f!==i.a&&O(s,i.a=f),d!==i.o&&O(a,i.o=d),i},{e:void 0,t:void 0,a:void 0,o:void 0}),o})()})),W(()=>O(t,j("flex flex-col gap-2 p-4",e.class))),t})();var an=D('<div><button><span class="relative z-10">Start</span></button><div class="w-px bg-black/20"></div><button aria-label="Change playback speed"><span class="relative z-10">');const Ne=["1x","0.75x","0.5x"],ln=e=>{const[t,n]=w(0),o=()=>Ne[t()],r=s=>{var l;s.stopPropagation();const a=(t()+1)%Ne.length;n(a);const i=Ne[a];i&&((l=e.onSpeedChange)==null||l.call(e,i))};return(()=>{var s=an(),a=s.firstChild,i=a.nextSibling,l=i.nextSibling,c=l.firstChild;return tt(a,"click",e.onStart),l.$$click=r,x(c,o),W(f=>{var d=j("relative inline-flex w-full rounded-lg overflow-hidden","bg-gradient-primary text-white shadow-lg","transition-all duration-300",e.class),C=e.disabled,A=j("flex-1 inline-flex items-center justify-center relative overflow-hidden","h-12 px-6 text-lg font-medium","cursor-pointer border-none outline-none","disabled:cursor-not-allowed disabled:opacity-50","hover:bg-white/10 active:bg-white/20"),k=e.disabled,T=j("inline-flex items-center justify-center relative","w-20 text-lg font-medium","cursor-pointer border-none outline-none","disabled:cursor-not-allowed disabled:opacity-50","hover:bg-white/10 active:bg-white/20",'after:content-[""] after:absolute after:inset-0',"after:bg-gradient-to-r after:from-transparent after:via-white/20 after:to-transparent","after:translate-x-[-200%] hover:after:translate-x-[200%]","after:transition-transform after:duration-700");return d!==f.e&&O(s,f.e=d),C!==f.t&&(a.disabled=f.t=C),A!==f.a&&O(a,f.a=A),k!==f.o&&(l.disabled=f.o=k),T!==f.i&&O(l,f.i=T),f},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),s})()};X(["click"]);var Ue=D("<div>"),cn=D("<button>");const Oe=ht(),un=e=>{var s,a;const[t,n]=w(e.defaultTab||((s=e.tabs[0])==null?void 0:s.id)||"");console.log("[Tabs] Initializing with:",{defaultTab:e.defaultTab,firstTabId:(a=e.tabs[0])==null?void 0:a.id,activeTab:t()});const r={activeTab:t,setActiveTab:i=>{var l;console.log("[Tabs] Tab changed to:",i),n(i),(l=e.onTabChange)==null||l.call(e,i)}};return _(Oe.Provider,{value:r,get children(){var i=Ue();return x(i,()=>e.children),W(()=>O(i,j("w-full",e.class))),i}})},dn=e=>(()=>{var t=Ue();return x(t,()=>e.children),W(()=>O(t,j("inline-flex h-10 items-center justify-center rounded-md bg-surface p-1 text-secondary","w-full",e.class))),t})(),at=e=>{const t=qe(Oe);if(!t)return console.error("[TabsTrigger] No TabsContext found. TabsTrigger must be used within Tabs component."),null;const n=()=>t.activeTab()===e.value;return(()=>{var o=cn();return o.$$click=()=>t.setActiveTab(e.value),x(o,()=>e.children),W(()=>O(o,j("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5","text-sm font-medium ring-offset-base transition-all","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent-primary focus-visible:ring-offset-2","disabled:pointer-events-none disabled:opacity-50","flex-1",n()?"bg-base text-primary shadow-sm":"text-secondary hover:text-primary",e.class))),o})()},lt=e=>{const t=qe(Oe);if(!t)return console.error("[TabsContent] No TabsContext found. TabsContent must be used within Tabs component."),null;const n=t.activeTab()===e.value;return console.log("[TabsContent] Rendering:",{value:e.value,activeTab:t.activeTab(),isActive:n}),_(Z,{when:n,get children(){var o=Ue();return x(o,()=>e.children),W(()=>O(o,j("mt-2 ring-offset-base","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent-primary focus-visible:ring-offset-2",e.class))),o}})};X(["click"]);var fn=D("<div class=px-4>"),hn=D('<div class="p-4 bg-surface border-t border-subtle">'),gn=D('<div class="flex flex-col h-full"><div class="flex-1 min-h-0 overflow-hidden">'),pn=D('<div class="overflow-y-auto h-full">'),yn=D("<div>");const mn=e=>{var t;return console.log("[ExtensionKaraokeView] Rendering with props:",{isPlaying:e.isPlaying,hasOnStart:!!e.onStart,lyricsLength:(t=e.lyrics)==null?void 0:t.length}),(()=>{var n=yn();return x(n,_(Zt,{get score(){return e.score},get rank(){return e.rank}}),null),x(n,_(un,{tabs:[{id:"lyrics",label:"Lyrics"},{id:"leaderboard",label:"Leaderboard"}],defaultTab:"lyrics",class:"flex-1 flex flex-col min-h-0",get children(){return[(()=>{var o=fn();return x(o,_(dn,{get children(){return[_(at,{value:"lyrics",children:"Lyrics"}),_(at,{value:"leaderboard",children:"Leaderboard"})]}})),o})(),_(lt,{value:"lyrics",class:"flex-1 min-h-0",get children(){return[G(()=>console.log("[ExtensionKaraokeView] Inside lyrics TabsContent")),(()=>{var o=gn(),r=o.firstChild;return x(r,_(nn,{get lyrics(){return e.lyrics},get currentTime(){return e.currentTime},get isPlaying(){return e.isPlaying}})),x(o,()=>console.log("[ExtensionKaraokeView] Start button check:",{isPlaying:e.isPlaying,notPlaying:!e.isPlaying,hasOnStart:!!e.onStart,shouldShowButton:()=>!e.isPlaying&&e.onStart}),null),x(o,_(Z,{get when(){return!e.isPlaying&&e.onStart},get children(){var s=hn();return s.style.setProperty("flex-shrink","0"),x(s,()=>console.log("[ExtensionKaraokeView] Rendering Start button div"),null),x(s,_(ln,{get onStart(){return e.onStart},get onSpeedChange(){return e.onSpeedChange}}),null),s}}),null),o})()]}}),_(lt,{value:"leaderboard",class:"flex-1 overflow-hidden",get children(){var o=pn();return x(o,_(sn,{get entries(){return e.leaderboard}})),o}})]}}),null),W(()=>O(n,j("flex flex-col h-full bg-base",e.class))),n})()};function bn(e){const[t,n]=w(null),[o,r]=w(null),[s,a]=w(null),[i,l]=w(!1),[c,f]=w(null),[d,C]=w(!1),[A,k]=w(null),[T,R]=w([]),[B,M]=w(!1),[P,I]=w([]),K=e==null?void 0:e.sampleRate,F=async()=>{if(!t()){f(null);try{console.log("[KaraokeAudioProcessor] Initializing audio capture...");const u=new AudioContext({sampleRate:K});n(u);const h=await navigator.mediaDevices.getUserMedia({audio:{sampleRate:K,channelCount:1,echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1}});r(h),await u.audioWorklet.addModule(fe());const b=new AudioWorkletNode(u,"karaoke-audio-processor",{numberOfInputs:1,numberOfOutputs:0,channelCount:1});b.port.onmessage=E=>{if(E.data.type==="audioData"){const N=new Float32Array(E.data.audioData);A()!==null&&R(z=>[...z,N]),B()&&I(z=>[...z,N])}},a(b);const S=u.createMediaStreamSource(h),m=u.createGain();m.gain.value=1.2,S.connect(m),m.connect(b),l(!0),console.log("[KaraokeAudioProcessor] Audio capture initialized successfully.")}catch(u){console.error("[KaraokeAudioProcessor] Failed to initialize:",u),f(u instanceof Error?u:new Error("Unknown audio initialization error")),l(!1)}}},fe=()=>{const u=`
      class KaraokeAudioProcessor extends AudioWorkletProcessor {
        constructor() {
          super();
          this.bufferSize = 1024;
          this.rmsHistory = [];
          this.maxHistoryLength = 10;
        }

        process(inputs, outputs, parameters) {
          const input = inputs[0];
          if (input && input[0]) {
            const inputData = input[0];
            
            let sum = 0;
            for (let i = 0; i < inputData.length; i++) {
              sum += inputData[i] * inputData[i];
            }
            const rms = Math.sqrt(sum / inputData.length);
            
            this.rmsHistory.push(rms);
            if (this.rmsHistory.length > this.maxHistoryLength) {
              this.rmsHistory.shift();
            }
            
            const avgRms = this.rmsHistory.reduce((a, b) => a + b, 0) / this.rmsHistory.length;
            
            this.port.postMessage({
              type: 'audioData',
              audioData: inputData,
              rmsLevel: rms,
              avgRmsLevel: avgRms,
              isTooQuiet: avgRms < 0.01,
              isTooLoud: avgRms > 0.3
            });
          }
          return true;
        }
      }
      registerProcessor('karaoke-audio-processor', KaraokeAudioProcessor);
    `,h=new Blob([u],{type:"application/javascript"});return URL.createObjectURL(h)},se=()=>{const u=t();u&&u.state==="suspended"&&u.resume(),C(!0),console.log("[KaraokeAudioProcessor] Started listening for audio.")},he=()=>{const u=t();u&&u.state==="running"&&u.suspend(),C(!1),console.log("[KaraokeAudioProcessor] Paused listening for audio.")},ee=()=>{console.log("[KaraokeAudioProcessor] Cleaning up audio capture...");const u=o();u&&(u.getTracks().forEach(b=>b.stop()),r(null));const h=t();h&&h.state!=="closed"&&(h.close(),n(null)),a(null),l(!1),C(!1),console.log("[KaraokeAudioProcessor] Audio capture cleaned up.")};we(ee);const ie=u=>{console.log(`[KaraokeAudioProcessor] Starting audio capture for line ${u}`),k(u),R([]),i()&&!d()&&se()},ge=()=>{const u=A();if(u===null)return console.warn("[KaraokeAudioProcessor] No active recording line."),[];const h=T();console.log(`[KaraokeAudioProcessor] Stopping capture for line ${u}. Collected ${h.length} chunks.`),k(null);const b=[...h];return R([]),b.length===0&&console.log(`[KaraokeAudioProcessor] No audio captured for line ${u}.`),b},p=u=>{if(u.length===0)return null;const h=u.reduce((m,E)=>m+E.length,0),b=new Float32Array(h);let S=0;for(const m of u)b.set(m,S),S+=m.length;return v(b,K)},v=(u,h)=>{const b=u.length,S=new ArrayBuffer(44+b*2),m=new DataView(S),E=(z,ae)=>{for(let Ee=0;Ee<ae.length;Ee++)m.setUint8(z+Ee,ae.charCodeAt(Ee))};E(0,"RIFF"),m.setUint32(4,36+b*2,!0),E(8,"WAVE"),E(12,"fmt "),m.setUint32(16,16,!0),m.setUint16(20,1,!0),m.setUint16(22,1,!0),m.setUint32(24,h,!0),m.setUint32(28,h*2,!0),m.setUint16(32,2,!0),m.setUint16(34,16,!0),E(36,"data"),m.setUint32(40,b*2,!0);const N=44;for(let z=0;z<b;z++){const ae=Math.max(-1,Math.min(1,u[z]||0));m.setInt16(N+z*2,ae*32767,!0)}return new Blob([S],{type:"audio/wav"})};return{isReady:i,error:c,isListening:d,isSessionActive:B,initialize:F,startListening:se,pauseListening:he,cleanup:ee,startRecordingLine:ie,stopRecordingLineAndGetRawAudio:ge,convertAudioToWavBlob:p,startFullSession:()=>{console.log("[KaraokeAudioProcessor] Starting full session recording"),I([]),M(!0)},stopFullSessionAndGetWav:()=>{console.log("[KaraokeAudioProcessor] Stopping full session recording"),M(!1);const u=P(),h=p(u);return console.log(`[KaraokeAudioProcessor] Full session: ${u.length} chunks, ${h?(h.size/1024).toFixed(1)+"KB":"null"}`),I([]),h}}}const vn=8,wn=15,kn=3;function Sn(e){return e.trim().split(/\s+/).filter(t=>t.length>0).length}function xn(e,t){let n=0,o=t;const r=[];for(;o<e.length&&n<vn;){const s=e[o];if(!s)break;const a=Sn(s.text);if(n+a>wn&&n>=5||(r.push(s.text),n+=a,o++,o-t>=kn))break}return{startIndex:t,endIndex:o-1,expectedText:r.join(" "),wordCount:n}}function Cn(e,t){var s;const{startIndex:n,endIndex:o}=t,r=e[n];if(!r)return 3e3;if(o>n){const a=e[o];if(a&&r.recordingStart&&a.recordingEnd)return a.recordingEnd-r.recordingStart;if(o+1<e.length){const l=e[o+1];if(l)return l.timestamp-r.timestamp}let i=0;for(let l=n;l<=o;l++)i+=((s=e[l])==null?void 0:s.duration)||3e3;return Math.min(i,8e3)}else{if(r.recordingStart&&r.recordingEnd)return r.recordingEnd-r.recordingStart;if(n+1<e.length){const a=e[n+1];if(a){const i=a.timestamp-r.timestamp;return Math.min(Math.max(i,1e3),5e3)}}return Math.min(r.duration||3e3,5e3)}}var An=D('<button aria-label="Open Karaoke"><span>🎤');const Tn=e=>(()=>{var t=An(),n=t.firstChild;return t.addEventListener("mouseleave",o=>{o.currentTarget.style.transform="scale(1)"}),t.addEventListener("mouseenter",o=>{o.currentTarget.style.transform="scale(1.1)"}),tt(t,"click",e.onClick),t.style.setProperty("position","fixed"),t.style.setProperty("bottom","24px"),t.style.setProperty("right","24px"),t.style.setProperty("width","80px"),t.style.setProperty("height","80px"),t.style.setProperty("border-radius","50%"),t.style.setProperty("background","linear-gradient(135deg, #FF006E 0%, #C13584 100%)"),t.style.setProperty("box-shadow","0 8px 32px rgba(0, 0, 0, 0.3)"),t.style.setProperty("display","flex"),t.style.setProperty("align-items","center"),t.style.setProperty("justify-content","center"),t.style.setProperty("overflow","hidden"),t.style.setProperty("cursor","pointer"),t.style.setProperty("z-index","99999"),t.style.setProperty("border","none"),t.style.setProperty("transition","transform 0.2s ease"),n.style.setProperty("font-size","36px"),t})();X(["click"]),X(["click"]),X(["click"]);function En(e){const[t,n]=w(!1),[o,r]=w(0),[s,a]=w(0),[i,l]=w(null),[c,f]=w(null),[d,C]=w([]),[A,k]=w(null),[T,R]=w(!1),[B,M]=w(e.audioElement);let P=null,I=null;const K=bn({sampleRate:16e3}),F=e.apiUrl||"http://localhost:3000/api",fe=async()=>{try{await K.initialize(),console.log("[KaraokeSession] Audio processor initialized")}catch(y){console.error("[KaraokeSession] Failed to initialize audio:",y)}if(console.log("[KaraokeSession] Session creation check:",{hasTrackId:!!e.trackId,hasSongData:!!e.songData,trackId:e.trackId,songData:e.songData,apiUrl:F}),e.trackId&&e.songData)try{console.log("[KaraokeSession] Creating session on server...");const y=await fetch(`${F}/karaoke/start`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({trackId:e.trackId,songData:e.songData})});if(console.log("[KaraokeSession] Session response:",y.status,y.statusText),y.ok){const u=await y.json();f(u.session.id),console.log("[KaraokeSession] Session created:",u.session.id)}else{const u=await y.text();console.error("[KaraokeSession] Failed to create session:",y.status,u)}}catch(y){console.error("[KaraokeSession] Failed to create session:",y)}else console.log("[KaraokeSession] Skipping session creation - missing trackId or songData");l(3);const g=setInterval(()=>{const y=i();y!==null&&y>1?l(y-1):(clearInterval(g),l(null),se())},1e3)},se=()=>{n(!0),K.startFullSession();const g=B()||e.audioElement;g?(console.log("[KaraokeSession] Starting playback with audio element"),g.play().catch(console.error),P=setInterval(()=>{const u=g.currentTime*1e3;r(u),he(u)},100),g.addEventListener("ended",p)):console.log("[KaraokeSession] No audio element available for playback")},he=g=>{if(!(T()||!e.lyrics.length))for(let y=0;y<e.lyrics.length;y++){const u=xn(e.lyrics,y),h=e.lyrics[u.startIndex];if(h&&h.startTime!==void 0){const b=h.startTime*1e3-1e3;if(g>=b&&g<h.startTime*1e3){console.log(`[KaraokeSession] Time to start recording chunk ${y}: ${g}ms >= ${b}ms`),ee(u);break}}y=u.endIndex}},ee=async g=>{console.log(`[KaraokeSession] Starting recording for chunk ${g.startIndex}-${g.endIndex}`),k(g),R(!0),K.startRecordingLine(g.startIndex);const y=Cn(e.lyrics,g);I=setTimeout(()=>{ie()},y)},ie=async()=>{const g=A();if(!g)return;console.log(`[KaraokeSession] Stopping recording for chunk ${g.startIndex}-${g.endIndex}`),R(!1);const y=K.stopRecordingLineAndGetRawAudio(),u=K.convertAudioToWavBlob(y);if(console.log("[KaraokeSession] Audio blob created:",{hasBlob:!!u,blobSize:u==null?void 0:u.size,hasSessionId:!!c(),sessionId:c()}),u&&c()){const h=new FileReader;h.onloadend=async()=>{var S;const b=(S=h.result)==null?void 0:S.toString().split(",")[1];b&&await ge(g,b)},h.readAsDataURL(u)}else u&&!c()&&console.warn("[KaraokeSession] Have audio but no session ID - cannot grade");k(null),I&&(clearTimeout(I),I=null)},ge=async(g,y)=>{var h,b;const u=c();if(console.log("[KaraokeSession] Grading chunk:",{hasSessionId:!!u,sessionId:u,chunkIndex:g.startIndex,audioLength:y.length}),!u){console.warn("[KaraokeSession] No session ID, skipping grade");return}try{console.log("[KaraokeSession] Sending grade request...");const S=await fetch(`${F}/karaoke/grade`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:c(),lineIndex:g.startIndex,audioBuffer:y,expectedText:g.expectedText,startTime:((h=e.lyrics[g.startIndex])==null?void 0:h.startTime)||0,endTime:((b=e.lyrics[g.endIndex])==null?void 0:b.endTime)||0})});if(S.ok){const m=await S.json();console.log("[KaraokeSession] Chunk graded:",m),C(z=>[...z,{lineIndex:g.startIndex,score:m.score,transcription:m.transcription,feedback:m.feedback}]);const E=[...d(),{lineIndex:g.startIndex,score:m.score,transcription:m.transcription}],N=E.reduce((z,ae)=>z+ae.score,0)/E.length;a(Math.round(N))}}catch(S){console.error("[KaraokeSession] Failed to grade chunk:",S)}},p=async()=>{var y,u;n(!1),P&&clearInterval(P),T()&&ie();const g=K.stopFullSessionAndGetWav();if(c()&&g)try{const h=new FileReader;h.onloadend=async()=>{var m,E;const b=(m=h.result)==null?void 0:m.toString().split(",")[1],S=await fetch(`${F}/karaoke/complete`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:c(),fullAudioBuffer:b})});if(S.ok){const N=await S.json();console.log("[KaraokeSession] Session completed:",N);const z={score:N.finalScore,accuracy:N.accuracy,totalLines:N.totalLines,perfectLines:N.perfectLines,goodLines:N.goodLines,needsWorkLines:N.needsWorkLines,sessionId:c()||void 0};(E=e.onComplete)==null||E.call(e,z)}},h.readAsDataURL(g)}catch(h){console.error("[KaraokeSession] Failed to complete session:",h);const b=d(),S=b.length>0?b.reduce((E,N)=>E+N.score,0)/b.length:0,m={score:Math.round(S),accuracy:Math.round(S),totalLines:e.lyrics.length,perfectLines:b.filter(E=>E.score>=90).length,goodLines:b.filter(E=>E.score>=70&&E.score<90).length,needsWorkLines:b.filter(E=>E.score<70).length,sessionId:c()||void 0};(y=e.onComplete)==null||y.call(e,m)}else{const h=d(),b=h.length>0?h.reduce((m,E)=>m+E.score,0)/h.length:0,S={score:Math.round(b),accuracy:Math.round(b),totalLines:e.lyrics.length,perfectLines:h.filter(m=>m.score>=90).length,goodLines:h.filter(m=>m.score>=70&&m.score<90).length,needsWorkLines:h.filter(m=>m.score<70).length};(u=e.onComplete)==null||u.call(e,S)}},v=()=>{n(!1),l(null),R(!1),k(null),P&&(clearInterval(P),P=null),I&&(clearTimeout(I),I=null);const g=B()||e.audioElement;g&&(g.pause(),g.currentTime=0,g.removeEventListener("ended",p)),K.cleanup()};return we(()=>{v()}),{isPlaying:t,currentTime:o,score:s,countdown:i,sessionId:c,lineScores:d,isRecording:T,currentChunk:A,startSession:fe,stopSession:v,audioProcessor:K,setAudioElement:M}}class Pn{detectCurrentTrack(){return window.location.href.includes("sc.maid.zone")?this.detectSoundCloudTrack():null}detectSoundCloudTrack(){try{const t=window.location.pathname.split("/").filter(Boolean);if(t.length<2)return null;const n=t[0],o=t[1],r=[".soundTitle__title",".trackItem__trackTitle",'h1[itemprop="name"]',".sound__header h1",".sc-text-h4",".sc-text-primary"];let s="";for(const i of r){const l=document.querySelector(i);if(l&&l.textContent){s=l.textContent.trim();break}}s||(s=o.replace(/-/g," "));const a=n.replace(/-/g," ").replace(/_/g," ");return{trackId:`${n}/${o}`,title:s,artist:a,platform:"soundcloud",url:window.location.href}}catch(t){return console.error("[TrackDetector] Error detecting SoundCloud track:",t),null}}watchForChanges(t){let n=window.location.href,o=this.detectCurrentTrack();t(o);const r=()=>{const c=window.location.href;if(c!==n){n=c;const f=this.detectCurrentTrack();(!o||!f||o.trackId!==f.trackId)&&(o=f,t(f))}},s=setInterval(r,1e3),a=()=>{setTimeout(r,100)};window.addEventListener("popstate",a);const i=history.pushState,l=history.replaceState;return history.pushState=function(...c){i.apply(history,c),a()},history.replaceState=function(...c){l.apply(history,c),a()},()=>{clearInterval(s),window.removeEventListener("popstate",a),history.pushState=i,history.replaceState=l}}}const $n=new Pn;async function In(){return(await re.storage.local.get("authToken")).authToken||null}class _n{constructor(){Y(this,"baseUrl");this.baseUrl="http://localhost:8787/api"}async getKaraokeData(t,n,o){try{const r=new URLSearchParams;n&&r.set("title",n),o&&r.set("artist",o);const s=`${this.baseUrl}/karaoke/${encodeURIComponent(t)}${r.toString()?"?"+r.toString():""}`;console.log("[KaraokeApi] Fetching karaoke data:",s);const a=await fetch(s,{method:"GET"});if(!a.ok)return console.error("[KaraokeApi] Failed to fetch karaoke data:",a.status),null;const i=await a.json();return console.log("[KaraokeApi] Received karaoke data:",i),i.error?(console.log("[KaraokeApi] Server error (but API is reachable):",i.error),{success:!1,has_karaoke:!1,error:i.error,track_id:t,api_connected:!0}):i}catch(r){return console.error("[KaraokeApi] Error fetching karaoke data:",r),null}}async startSession(t,n){try{const o=await fetch(`${this.baseUrl}/karaoke/start`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({trackId:t,songData:n})});return o.ok?(await o.json()).session:(console.error("[KaraokeApi] Failed to start session:",o.status),null)}catch(o){return console.error("[KaraokeApi] Error starting session:",o),null}}async testConnection(){try{return(await fetch(`${this.baseUrl.replace("/api","")}/health`)).ok}catch(t){return console.error("[KaraokeApi] Connection test failed:",t),!1}}}const Fn=new _n;var Kn=D('<div class="absolute inset-0 bg-black/80 flex items-center justify-center z-50"><div class=text-center><div class="text-8xl font-bold text-white animate-pulse"></div><p class="text-xl text-white/80 mt-4">Get ready!'),Ln=D('<div class="h-full flex flex-col"><div class="flex-1 min-h-0 overflow-hidden">'),Dn=D('<div><div class="h-full bg-surface rounded-2xl overflow-hidden flex flex-col"><div class="flex items-center justify-end p-2 bg-surface border-b border-subtle"><button class="w-10 h-10 flex items-center justify-center rounded-lg transition-colors hover:bg-white/10"aria-label=Minimize><svg width=24 height=24 viewBox="0 0 24 24"fill=none xmlns=http://www.w3.org/2000/svg><path d="M6 12h12"stroke=currentColor stroke-width=3 stroke-linecap=round></path></svg></button></div><div class="flex-1 min-h-0 overflow-hidden">'),Rn=D("<div>"),Mn=D('<div class="flex items-center justify-center h-full bg-base"><div class=text-center><div class="animate-spin rounded-full h-12 w-12 border-b-2 border-accent-primary mx-auto mb-4"></div><p class=text-secondary>Loading lyrics...'),Nn=D('<div class="flex items-center justify-center h-full p-8"><div class=text-center><p class="text-lg text-secondary mb-2">No lyrics available</p><p class="text-sm text-tertiary">Try a different song');const Un=()=>{console.log("[ContentApp] Rendering ContentApp component");const[e,t]=w(null),[n,o]=w(null),[r,s]=w(!1),[a,i]=w(null),[l,c]=w(!1),[f,d]=w(!1),[C,A]=w(!1),[k,T]=w(null),[R,B]=w(!1),[M,P]=w(0),[I,K]=w(null),[F,fe]=w(null);ft(async()=>{console.log("[ContentApp] Loading auth token");const p=await In();p?(o(p),console.log("[ContentApp] Auth token loaded")):(console.log("[ContentApp] No auth token found, using demo token"),o("scarlett_demo_token_123"));const v=$n.watchForChanges(g=>{console.log("[ContentApp] Track changed:",g),t(g),g&&(s(!0),se(g))});we(v)});const se=async p=>{console.log("[ContentApp] Fetching karaoke data for track:",p),c(!0);try{const v=await Fn.getKaraokeData(p.trackId,p.title,p.artist);console.log("[ContentApp] Karaoke data loaded:",v),i(v)}catch(v){console.error("[ContentApp] Failed to fetch karaoke data:",v)}finally{c(!1)}},he=async()=>{var g,y;console.log("[ContentApp] Start karaoke session"),d(!0);const p=a();I();const v=e();if(p&&v&&((g=p.lyrics)!=null&&g.lines)){console.log("[ContentApp] Creating karaoke session with audio capture",{trackId:v.id,trackTitle:v.title,songData:p.song,hasLyrics:!!((y=p.lyrics)!=null&&y.lines)});const u=En({lyrics:p.lyrics.lines,trackId:v.id,songData:p.song?{title:p.song.title,artist:p.song.artist,album:p.song.album,duration:p.song.duration}:{title:v.title,artist:v.artist},audioElement:void 0,apiUrl:"http://localhost:8787/api",onComplete:h=>{console.log("[ContentApp] Karaoke session completed:",h),d(!1)}});fe(u),await u.startSession(),ve(()=>{u.countdown()===null&&u.isPlaying()&&!R()&&(console.log("[ContentApp] Countdown finished, starting audio playback"),ee());const h=I();h&&u&&(console.log("[ContentApp] Setting audio element on new session"),u.setAudioElement(h))})}else{console.log("[ContentApp] Fallback to simple countdown"),T(3);const u=setInterval(()=>{const h=k();h!==null&&h>1?T(h-1):(clearInterval(u),T(null),ee())},1e3)}},ee=()=>{console.log("[ContentApp] Starting audio playback"),B(!0);const p=document.querySelectorAll("audio");if(console.log("[ContentApp] Found audio elements:",p.length),p.length>0){const v=p[0];console.log("[ContentApp] Audio element:",{src:v.src,paused:v.paused,duration:v.duration,currentTime:v.currentTime}),K(v);const g=F();g&&(console.log("[ContentApp] Setting audio element on karaoke session"),g.setAudioElement(v),g.audioProcessor.isReady()||(console.log("[ContentApp] Initializing audio processor for session"),g.audioProcessor.initialize().catch(console.error))),v.play().then(()=>{console.log("[ContentApp] Audio started playing successfully")}).catch(u=>{console.error("[ContentApp] Failed to play audio:",u),console.log("[ContentApp] Attempting to click play button...");const h=document.querySelector('button[title*="Play"], button[aria-label*="Play"], .playControl, .playButton, [class*="play-button"]');h&&(console.log("[ContentApp] Found play button, clicking it"),h.click())});const y=()=>{P(v.currentTime)};v.addEventListener("timeupdate",y),v.addEventListener("ended",()=>{B(!1),v.removeEventListener("timeupdate",y)})}else{console.log("[ContentApp] No audio elements found, trying SoundCloud-specific approach");const v=document.querySelector('.playControl, .sc-button-play, button[title*="Play"]');v&&(console.log("[ContentApp] Found SoundCloud play button, clicking it"),v.click(),setTimeout(()=>{const g=document.querySelectorAll("audio");if(g.length>0){console.log("[ContentApp] Found audio element after clicking play");const y=g[0];K(y);const u=()=>{P(y.currentTime)};y.addEventListener("timeupdate",u),y.addEventListener("ended",()=>{B(!1),y.removeEventListener("timeupdate",u)})}},500))}},ie=()=>{console.log("[ContentApp] Minimize karaoke widget"),A(!0)},ge=()=>{console.log("[ContentApp] Restore karaoke widget"),A(!1)};return console.log("[ContentApp] Render state:",{showKaraoke:r(),currentTrack:e(),karaokeData:a(),loading:l()}),[_(Z,{get when(){return G(()=>!!(r()&&e()))()&&C()},get children(){return _(Tn,{onClick:ge})}}),_(Z,{get when(){return G(()=>!!(r()&&e()))()&&!C()},get fallback(){return(()=>{var p=Rn();return p.style.setProperty("display","none"),x(p,()=>console.log("[ContentApp] Not showing - showKaraoke:",r(),"currentTrack:",e())),p})()},get children(){var p=Dn(),v=p.firstChild,g=v.firstChild,y=g.firstChild,u=g.nextSibling;return p.style.setProperty("position","fixed"),p.style.setProperty("top","20px"),p.style.setProperty("right","20px"),p.style.setProperty("bottom","20px"),p.style.setProperty("width","480px"),p.style.setProperty("z-index","99999"),p.style.setProperty("overflow","hidden"),p.style.setProperty("border-radius","16px"),p.style.setProperty("box-shadow","0 25px 50px -12px rgba(0, 0, 0, 0.6)"),p.style.setProperty("display","flex"),p.style.setProperty("flex-direction","column"),x(p,()=>console.log("[ContentApp] Rendering ExtensionKaraokeView with data:",a(),"session:",F()),v),g.style.setProperty("height","48px"),y.$$click=ie,y.style.setProperty("color","#a8a8a8"),x(u,_(Z,{get when(){return!l()},get fallback(){return Mn()},get children(){return _(Z,{get when(){var h,b;return(b=(h=a())==null?void 0:h.lyrics)==null?void 0:b.lines},get fallback(){return Nn()},get children(){var h=Ln(),b=h.firstChild;return x(b,_(mn,{get score(){return G(()=>!!F())()?F().score():0},rank:1,get lyrics(){var S,m;return((m=(S=a())==null?void 0:S.lyrics)==null?void 0:m.lines)||[]},get currentTime(){return G(()=>!!F())()?F().currentTime():M()*1e3},leaderboard:[],get isPlaying(){return G(()=>!!F())()?F().isPlaying():R()||k()!==null},onStart:he,onSpeedChange:S=>console.log("[ContentApp] Speed changed:",S),get isRecording(){return G(()=>!!F())()?F().isRecording():!1}})),x(h,_(Z,{get when(){return G(()=>!!F())()?F().countdown()!==null:k()!==null},get children(){var S=Kn(),m=S.firstChild,E=m.firstChild;return x(E,(()=>{var N=G(()=>!!F());return()=>N()?F().countdown():k()})()),S}}),null),h}})}})),p}})]};X(["click"]);const On={matches:["*://soundcloud.com/*","*://soundcloak.com/*","*://sc.maid.zone/*","*://*.maid.zone/*"],runAt:"document_idle",cssInjectionMode:"ui",async main(e){if(window.top!==window.self){console.log("[Scarlett CS] Not top-level frame, skipping content script.");return}console.log("[Scarlett CS] Scarlett Karaoke content script loaded"),(await Xt(e,{name:"scarlett-karaoke-ui",position:"overlay",anchor:"body",onMount:async n=>{var a;console.log("[Content Script] onMount called, container:",n),console.log("[Content Script] Shadow root:",n.getRootNode());const o=n.getRootNode();console.log("[Content Script] Shadow root stylesheets:",(a=o.styleSheets)==null?void 0:a.length);const r=document.createElement("div");r.className="karaoke-widget-container",n.appendChild(r),console.log("[Content Script] Wrapper created and appended:",r),console.log("[Content Script] Wrapper computed styles:",window.getComputedStyle(r)),console.log("[Content Script] About to render ContentApp");const s=Ct(()=>_(Un,{}),r);return console.log("[Content Script] ContentApp rendered, dispose function:",s),s},onRemove:n=>{n==null||n()}})).mount(),console.log("[Scarlett CS] Karaoke overlay mounted")}},Te=class Te extends Event{constructor(t,n){super(Te.EVENT_NAME,{}),this.newUrl=t,this.oldUrl=n}};Y(Te,"EVENT_NAME",Be("wxt:locationchange"));let je=Te;function Be(e){var t;return`${(t=re==null?void 0:re.runtime)==null?void 0:t.id}:content:${e}`}function jn(e){let t,n;return{run(){t==null&&(n=new URL(location.href),t=e.setInterval(()=>{let o=new URL(location.href);o.href!==n.href&&(window.dispatchEvent(new je(o,n)),n=o)},1e3))}}}const de=class de{constructor(t,n){Y(this,"isTopFrame",window.self===window.top);Y(this,"abortController");Y(this,"locationWatcher",jn(this));Y(this,"receivedMessageIds",new Set);this.contentScriptName=t,this.options=n,this.abortController=new AbortController,this.isTopFrame?(this.listenForNewerScripts({ignoreFirstEvent:!0}),this.stopOldScripts()):this.listenForNewerScripts()}get signal(){return this.abortController.signal}abort(t){return this.abortController.abort(t)}get isInvalid(){return re.runtime.id==null&&this.notifyInvalidated(),this.signal.aborted}get isValid(){return!this.isInvalid}onInvalidated(t){return this.signal.addEventListener("abort",t),()=>this.signal.removeEventListener("abort",t)}block(){return new Promise(()=>{})}setInterval(t,n){const o=setInterval(()=>{this.isValid&&t()},n);return this.onInvalidated(()=>clearInterval(o)),o}setTimeout(t,n){const o=setTimeout(()=>{this.isValid&&t()},n);return this.onInvalidated(()=>clearTimeout(o)),o}requestAnimationFrame(t){const n=requestAnimationFrame((...o)=>{this.isValid&&t(...o)});return this.onInvalidated(()=>cancelAnimationFrame(n)),n}requestIdleCallback(t,n){const o=requestIdleCallback((...r)=>{this.signal.aborted||t(...r)},n);return this.onInvalidated(()=>cancelIdleCallback(o)),o}addEventListener(t,n,o,r){var s;n==="wxt:locationchange"&&this.isValid&&this.locationWatcher.run(),(s=t.addEventListener)==null||s.call(t,n.startsWith("wxt:")?Be(n):n,o,{...r,signal:this.signal})}notifyInvalidated(){this.abort("Content script context invalidated"),Re.debug(`Content script "${this.contentScriptName}" context invalidated`)}stopOldScripts(){window.postMessage({type:de.SCRIPT_STARTED_MESSAGE_TYPE,contentScriptName:this.contentScriptName,messageId:Math.random().toString(36).slice(2)},"*")}verifyScriptStartedEvent(t){var s,a,i;const n=((s=t.data)==null?void 0:s.type)===de.SCRIPT_STARTED_MESSAGE_TYPE,o=((a=t.data)==null?void 0:a.contentScriptName)===this.contentScriptName,r=!this.receivedMessageIds.has((i=t.data)==null?void 0:i.messageId);return n&&o&&r}listenForNewerScripts(t){let n=!0;const o=r=>{if(this.verifyScriptStartedEvent(r)){this.receivedMessageIds.add(r.data.messageId);const s=n;if(n=!1,s&&(t!=null&&t.ignoreFirstEvent))return;this.notifyInvalidated()}};addEventListener("message",o),this.onInvalidated(()=>removeEventListener("message",o))}};Y(de,"SCRIPT_STARTED_MESSAGE_TYPE",Be("wxt:content-script-started"));let ze=de;function Hn(){}function Ae(e,...t){}const Bn={debug:(...e)=>Ae(console.debug,...e),log:(...e)=>Ae(console.log,...e),warn:(...e)=>Ae(console.warn,...e),error:(...e)=>Ae(console.error,...e)};return(async()=>{try{const{main:e,...t}=On,n=new ze("content",t);return await e(n)}catch(e){throw Bn.error('The content script "content" crashed on startup!',e),e}})()}();
content;
