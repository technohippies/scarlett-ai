var content=function(){"use strict";var Wn=Object.defineProperty;var zn=(te,V,ne)=>V in te?Wn(te,V,{enumerable:!0,configurable:!0,writable:!0,value:ne}):te[V]=ne;var Y=(te,V,ne)=>zn(te,typeof V!="symbol"?V+"":V,ne);var ct,ut;const V=(e,t)=>e===t,ne=Symbol("solid-track"),ge={equals:V};let ze=Xe;const J=1,pe=2,Ve={owned:null,cleanups:null,context:null,owner:null};var $=null;let Pe=null,dt=null,K=null,U=null,q=null,ye=0;function me(e,t){const n=K,o=$,r=e.length===0,s=t===void 0?o:t,l=r?Ve:{owned:null,cleanups:null,context:s?s.context:null,owner:s},i=r?e:()=>e(()=>H(()=>ce(l)));$=l,K=null;try{return ae(i,!0)}finally{K=n,$=o}}function v(e,t){t=t?Object.assign({},ge,t):ge;const n={value:e,observers:null,observerSlots:null,comparator:t.equals||void 0},o=r=>(typeof r=="function"&&(r=r(n.value)),Ge(n,r));return[He.bind(n),o]}function W(e,t,n){const o=$e(e,t,!1,J);le(o)}function be(e,t,n){ze=mt;const o=$e(e,t,!1,J);o.user=!0,q?q.push(o):le(o)}function Q(e,t,n){n=n?Object.assign({},ge,n):ge;const o=$e(e,t,!0,0);return o.observers=null,o.observerSlots=null,o.comparator=n.equals||void 0,le(o),He.bind(o)}function H(e){if(K===null)return e();const t=K;K=null;try{return e()}finally{K=t}}function ft(e){be(()=>H(e))}function ve(e){return $===null||($.cleanups===null?$.cleanups=[e]:$.cleanups.push(e)),e}function ht(e,t){const n=Symbol("context");return{id:n,Provider:vt(n),defaultValue:e}}function qe(e){let t;return $&&$.context&&(t=$.context[e.id])!==void 0?t:e.defaultValue}function gt(e){const t=Q(e),n=Q(()=>_e(t()));return n.toArray=()=>{const o=n();return Array.isArray(o)?o:o!=null?[o]:[]},n}function He(){if(this.sources&&this.state)if(this.state===J)le(this);else{const e=U;U=null,ae(()=>xe(this),!1),U=e}if(K){const e=this.observers?this.observers.length:0;K.sources?(K.sources.push(this),K.sourceSlots.push(e)):(K.sources=[this],K.sourceSlots=[e]),this.observers?(this.observers.push(K),this.observerSlots.push(K.sources.length-1)):(this.observers=[K],this.observerSlots=[K.sources.length-1])}return this.value}function Ge(e,t,n){let o=e.value;return(!e.comparator||!e.comparator(o,t))&&(e.value=t,e.observers&&e.observers.length&&ae(()=>{for(let r=0;r<e.observers.length;r+=1){const s=e.observers[r],l=Pe&&Pe.running;l&&Pe.disposed.has(s),(l?!s.tState:!s.state)&&(s.pure?U.push(s):q.push(s),s.observers&&Je(s)),l||(s.state=J)}if(U.length>1e6)throw U=[],new Error},!1)),t}function le(e){if(!e.fn)return;ce(e);const t=ye;pt(e,e.value,t)}function pt(e,t,n){let o;const r=$,s=K;K=$=e;try{o=e.fn(t)}catch(l){return e.pure&&(e.state=J,e.owned&&e.owned.forEach(ce),e.owned=null),e.updatedAt=n+1,Ye(l)}finally{K=s,$=r}(!e.updatedAt||e.updatedAt<=n)&&(e.updatedAt!=null&&"observers"in e?Ge(e,o):e.value=o,e.updatedAt=n)}function $e(e,t,n,o=J,r){const s={fn:e,state:o,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:$,context:$?$.context:null,pure:n};return $===null||$!==Ve&&($.owned?$.owned.push(s):$.owned=[s]),s}function we(e){if(e.state===0)return;if(e.state===pe)return xe(e);if(e.suspense&&H(e.suspense.inFallback))return e.suspense.effects.push(e);const t=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<ye);)e.state&&t.push(e);for(let n=t.length-1;n>=0;n--)if(e=t[n],e.state===J)le(e);else if(e.state===pe){const o=U;U=null,ae(()=>xe(e,t[0]),!1),U=o}}function ae(e,t){if(U)return e();let n=!1;t||(U=[]),q?n=!0:q=[],ye++;try{const o=e();return yt(n),o}catch(o){n||(q=null),U=null,Ye(o)}}function yt(e){if(U&&(Xe(U),U=null),e)return;const t=q;q=null,t.length&&ae(()=>ze(t),!1)}function Xe(e){for(let t=0;t<e.length;t++)we(e[t])}function mt(e){let t,n=0;for(t=0;t<e.length;t++){const o=e[t];o.user?e[n++]=o:we(o)}for(t=0;t<n;t++)we(e[t])}function xe(e,t){e.state=0;for(let n=0;n<e.sources.length;n+=1){const o=e.sources[n];if(o.sources){const r=o.state;r===J?o!==t&&(!o.updatedAt||o.updatedAt<ye)&&we(o):r===pe&&xe(o,t)}}}function Je(e){for(let t=0;t<e.observers.length;t+=1){const n=e.observers[t];n.state||(n.state=pe,n.pure?U.push(n):q.push(n),n.observers&&Je(n))}}function ce(e){let t;if(e.sources)for(;e.sources.length;){const n=e.sources.pop(),o=e.sourceSlots.pop(),r=n.observers;if(r&&r.length){const s=r.pop(),l=n.observerSlots.pop();o<r.length&&(s.sourceSlots[l]=o,r[o]=s,n.observerSlots[o]=l)}}if(e.tOwned){for(t=e.tOwned.length-1;t>=0;t--)ce(e.tOwned[t]);delete e.tOwned}if(e.owned){for(t=e.owned.length-1;t>=0;t--)ce(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}e.state=0}function bt(e){return e instanceof Error?e:new Error(typeof e=="string"?e:"Unknown error",{cause:e})}function Ye(e,t=$){throw bt(e)}function _e(e){if(typeof e=="function"&&!e.length)return _e(e());if(Array.isArray(e)){const t=[];for(let n=0;n<e.length;n++){const o=_e(e[n]);Array.isArray(o)?t.push.apply(t,o):t.push(o)}return t}return e}function vt(e,t){return function(o){let r;return W(()=>r=H(()=>($.context={...$.context,[e]:o.value},gt(()=>o.children))),void 0),r}}const wt=Symbol("fallback");function Qe(e){for(let t=0;t<e.length;t++)e[t]()}function xt(e,t,n={}){let o=[],r=[],s=[],l=0,i=t.length>1?[]:null;return ve(()=>Qe(s)),()=>{let a=e()||[],c=a.length,f,u;return a[ne],H(()=>{let A,w,T,M,B,N,P,_,F;if(c===0)l!==0&&(Qe(s),s=[],o=[],r=[],l=0,i&&(i=[])),n.fallback&&(o=[wt],r[0]=me(L=>(s[0]=L,n.fallback())),l=1);else if(l===0){for(r=new Array(c),u=0;u<c;u++)o[u]=a[u],r[u]=me(C);l=c}else{for(T=new Array(c),M=new Array(c),i&&(B=new Array(c)),N=0,P=Math.min(l,c);N<P&&o[N]===a[N];N++);for(P=l-1,_=c-1;P>=N&&_>=N&&o[P]===a[_];P--,_--)T[_]=r[P],M[_]=s[P],i&&(B[_]=i[P]);for(A=new Map,w=new Array(_+1),u=_;u>=N;u--)F=a[u],f=A.get(F),w[u]=f===void 0?-1:f,A.set(F,u);for(f=N;f<=P;f++)F=o[f],u=A.get(F),u!==void 0&&u!==-1?(T[u]=r[f],M[u]=s[f],i&&(B[u]=i[f]),u=w[u],A.set(F,u)):s[f]();for(u=N;u<c;u++)u in T?(r[u]=T[u],s[u]=M[u],i&&(i[u]=B[u],i[u](u))):r[u]=me(C);r=r.slice(0,l=c),o=a.slice(0)}return r});function C(A){if(s[u]=A,i){const[w,T]=v(u);return i[u]=T,t(a[u],w)}return t(a[u])}}}function I(e,t){return H(()=>e(t||{}))}const kt=e=>`Stale read from <${e}>.`;function Ze(e){const t="fallback"in e&&{fallback:()=>e.fallback};return Q(xt(()=>e.each,e.children,t||void 0))}function Z(e){const t=e.keyed,n=Q(()=>e.when,void 0,void 0),o=t?n:Q(n,void 0,{equals:(r,s)=>!r==!s});return Q(()=>{const r=o();if(r){const s=e.children;return typeof s=="function"&&s.length>0?H(()=>s(t?r:()=>{if(!H(o))throw kt("Show");return n()})):s}return e.fallback},void 0,void 0)}const G=e=>Q(()=>e());function St(e,t,n){let o=n.length,r=t.length,s=o,l=0,i=0,a=t[r-1].nextSibling,c=null;for(;l<r||i<s;){if(t[l]===n[i]){l++,i++;continue}for(;t[r-1]===n[s-1];)r--,s--;if(r===l){const f=s<o?i?n[i-1].nextSibling:n[s-i]:a;for(;i<s;)e.insertBefore(n[i++],f)}else if(s===i)for(;l<r;)(!c||!c.has(t[l]))&&t[l].remove(),l++;else if(t[l]===n[s-1]&&n[i]===t[r-1]){const f=t[--r].nextSibling;e.insertBefore(n[i++],t[l++].nextSibling),e.insertBefore(n[--s],f),t[r]=n[s]}else{if(!c){c=new Map;let u=i;for(;u<s;)c.set(n[u],u++)}const f=c.get(t[l]);if(f!=null)if(i<f&&f<s){let u=l,C=1,A;for(;++u<r&&u<s&&!((A=c.get(t[u]))==null||A!==f+C);)C++;if(C>f-i){const w=t[l];for(;i<f;)e.insertBefore(n[i++],w)}else e.replaceChild(n[i++],t[l++])}else l++;else t[l++].remove()}}}const et="_$DX_DELEGATE";function Ct(e,t,n,o={}){let r;return me(s=>{r=s,t===document?e():S(t,e(),t.firstChild?null:void 0,n)},o.owner),()=>{r(),t.textContent=""}}function D(e,t,n,o){let r;const s=()=>{const i=document.createElement("template");return i.innerHTML=e,i.content.firstChild},l=()=>(r||(r=s())).cloneNode(!0);return l.cloneNode=l,l}function X(e,t=window.document){const n=t[et]||(t[et]=new Set);for(let o=0,r=e.length;o<r;o++){const s=e[o];n.has(s)||(n.add(s),t.addEventListener(s,Et))}}function At(e,t,n){n==null?e.removeAttribute(t):e.setAttribute(t,n)}function O(e,t){t==null?e.removeAttribute("class"):e.className=t}function tt(e,t,n,o){Array.isArray(n)?(e[`$$${t}`]=n[0],e[`$$${t}Data`]=n[1]):e[`$$${t}`]=n}function Tt(e,t,n){return H(()=>e(t,n))}function S(e,t,n,o){if(n!==void 0&&!o&&(o=[]),typeof t!="function")return ke(e,t,o,n);W(r=>ke(e,t(),r,n),o)}function Et(e){let t=e.target;const n=`$$${e.type}`,o=e.target,r=e.currentTarget,s=a=>Object.defineProperty(e,"target",{configurable:!0,value:a}),l=()=>{const a=t[n];if(a&&!t.disabled){const c=t[`${n}Data`];if(c!==void 0?a.call(t,c,e):a.call(t,e),e.cancelBubble)return}return t.host&&typeof t.host!="string"&&!t.host._$host&&t.contains(e.target)&&s(t.host),!0},i=()=>{for(;l()&&(t=t._$host||t.parentNode||t.host););};if(Object.defineProperty(e,"currentTarget",{configurable:!0,get(){return t||document}}),e.composedPath){const a=e.composedPath();s(a[0]);for(let c=0;c<a.length-2&&(t=a[c],!!l());c++){if(t._$host){t=t._$host,i();break}if(t.parentNode===r)break}}else i();s(o)}function ke(e,t,n,o,r){for(;typeof n=="function";)n=n();if(t===n)return n;const s=typeof t,l=o!==void 0;if(e=l&&n[0]&&n[0].parentNode||e,s==="string"||s==="number"){if(s==="number"&&(t=t.toString(),t===n))return n;if(l){let i=n[0];i&&i.nodeType===3?i.data!==t&&(i.data=t):i=document.createTextNode(t),n=oe(e,n,o,i)}else n!==""&&typeof n=="string"?n=e.firstChild.data=t:n=e.textContent=t}else if(t==null||s==="boolean")n=oe(e,n,o);else{if(s==="function")return W(()=>{let i=t();for(;typeof i=="function";)i=i();n=ke(e,i,n,o)}),()=>n;if(Array.isArray(t)){const i=[],a=n&&Array.isArray(n);if(Ie(i,t,n,r))return W(()=>n=ke(e,i,n,o,!0)),()=>n;if(i.length===0){if(n=oe(e,n,o),l)return n}else a?n.length===0?nt(e,i,o):St(e,n,i):(n&&oe(e),nt(e,i));n=i}else if(t.nodeType){if(Array.isArray(n)){if(l)return n=oe(e,n,o,t);oe(e,n,null,t)}else n==null||n===""||!e.firstChild?e.appendChild(t):e.replaceChild(t,e.firstChild);n=t}}return n}function Ie(e,t,n,o){let r=!1;for(let s=0,l=t.length;s<l;s++){let i=t[s],a=n&&n[e.length],c;if(!(i==null||i===!0||i===!1))if((c=typeof i)=="object"&&i.nodeType)e.push(i);else if(Array.isArray(i))r=Ie(e,i,a)||r;else if(c==="function")if(o){for(;typeof i=="function";)i=i();r=Ie(e,Array.isArray(i)?i:[i],Array.isArray(a)?a:[a])||r}else e.push(i),r=!0;else{const f=String(i);a&&a.nodeType===3&&a.data===f?e.push(a):e.push(document.createTextNode(f))}}return r}function nt(e,t,n=null){for(let o=0,r=t.length;o<r;o++)e.insertBefore(t[o],n)}function oe(e,t,n,o){if(n===void 0)return e.textContent="";const r=o||document.createTextNode("");if(t.length){let s=!1;for(let l=t.length-1;l>=0;l--){const i=t[l];if(r!==i){const a=i.parentNode===e;!s&&!l?a?e.replaceChild(r,i):e.insertBefore(r,n):a&&i.remove()}else s=!0}}else e.insertBefore(r,n);return[r]}const re=(ut=(ct=globalThis.browser)==null?void 0:ct.runtime)!=null&&ut.id?globalThis.browser:globalThis.chrome;function Pt(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Fe,ot;function $t(){if(ot)return Fe;ot=1;var e=/^[a-z](?:[\.0-9_a-z\xB7\xC0-\xD6\xD8-\xF6\xF8-\u037D\u037F-\u1FFF\u200C\u200D\u203F\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])*-(?:[\x2D\.0-9_a-z\xB7\xC0-\xD6\xD8-\xF6\xF8-\u037D\u037F-\u1FFF\u200C\u200D\u203F\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])*$/,t=function(n){return e.test(n)};return Fe=t,Fe}var _t=$t();const It=Pt(_t);var Ft=(e,t,n)=>new Promise((o,r)=>{var s=a=>{try{i(n.next(a))}catch(c){r(c)}},l=a=>{try{i(n.throw(a))}catch(c){r(c)}},i=a=>a.done?o(a.value):Promise.resolve(a.value).then(s,l);i((n=n.apply(e,t)).next())});function Lt(e){return Ft(this,null,function*(){const{name:t,mode:n="closed",css:o,isolateEvents:r=!1}=e;if(!It(t))throw Error(`"${t}" is not a valid custom element name. It must be two words and kebab-case, with a few exceptions. See spec for more details: https://html.spec.whatwg.org/multipage/custom-elements.html#valid-custom-element-name`);const s=document.createElement(t),l=s.attachShadow({mode:n}),i=document.createElement("html"),a=document.createElement("body"),c=document.createElement("head");if(o){const f=document.createElement("style");"url"in o?f.textContent=yield fetch(o.url).then(u=>u.text()):f.textContent=o.textContent,c.appendChild(f)}return i.appendChild(c),i.appendChild(a),l.appendChild(i),r&&(Array.isArray(r)?r:["keydown","keyup","keypress"]).forEach(u=>{a.addEventListener(u,C=>C.stopPropagation())}),{parentElement:s,shadow:l,isolatedElement:a}})}const Kt=Symbol("null");let Dt=0;class Rt extends Map{constructor(){super(),this._objectHashes=new WeakMap,this._symbolHashes=new Map,this._publicKeys=new Map;const[t]=arguments;if(t!=null){if(typeof t[Symbol.iterator]!="function")throw new TypeError(typeof t+" is not iterable (cannot read property Symbol(Symbol.iterator))");for(const[n,o]of t)this.set(n,o)}}_getPublicKeys(t,n=!1){if(!Array.isArray(t))throw new TypeError("The keys parameter must be an array");const o=this._getPrivateKey(t,n);let r;return o&&this._publicKeys.has(o)?r=this._publicKeys.get(o):n&&(r=[...t],this._publicKeys.set(o,r)),{privateKey:o,publicKey:r}}_getPrivateKey(t,n=!1){const o=[];for(let r of t){r===null&&(r=Kt);const s=typeof r=="object"||typeof r=="function"?"_objectHashes":typeof r=="symbol"?"_symbolHashes":!1;if(!s)o.push(r);else if(this[s].has(r))o.push(this[s].get(r));else if(n){const l=`@@mkm-ref-${Dt++}@@`;this[s].set(r,l),o.push(l)}else return!1}return JSON.stringify(o)}set(t,n){const{publicKey:o}=this._getPublicKeys(t,!0);return super.set(o,n)}get(t){const{publicKey:n}=this._getPublicKeys(t);return super.get(n)}has(t){const{publicKey:n}=this._getPublicKeys(t);return super.has(n)}delete(t){const{publicKey:n,privateKey:o}=this._getPublicKeys(t);return!!(n&&super.delete(n)&&this._publicKeys.delete(o))}clear(){super.clear(),this._symbolHashes.clear(),this._publicKeys.clear()}get[Symbol.toStringTag](){return"ManyKeysMap"}get size(){return super.size}}function Le(e){if(e===null||typeof e!="object")return!1;const t=Object.getPrototypeOf(e);return t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||Symbol.iterator in e?!1:Symbol.toStringTag in e?Object.prototype.toString.call(e)==="[object Module]":!0}function Ke(e,t,n=".",o){if(!Le(t))return Ke(e,{},n,o);const r=Object.assign({},t);for(const s in e){if(s==="__proto__"||s==="constructor")continue;const l=e[s];l!=null&&(o&&o(r,s,l,n)||(Array.isArray(l)&&Array.isArray(r[s])?r[s]=[...l,...r[s]]:Le(l)&&Le(r[s])?r[s]=Ke(l,r[s],(n?`${n}.`:"")+s.toString(),o):r[s]=l))}return r}function Mt(e){return(...t)=>t.reduce((n,o)=>Ke(n,o,"",e),{})}const Nt=Mt(),rt=e=>e!==null?{isDetected:!0,result:e}:{isDetected:!1},Ut=e=>e===null?{isDetected:!0,result:null}:{isDetected:!1},Ot=()=>({target:globalThis.document,unifyProcess:!0,detector:rt,observeConfigs:{childList:!0,subtree:!0,attributes:!0},signal:void 0,customMatcher:void 0}),jt=(e,t)=>Nt(e,t),De=new Rt;function Bt(e){const{defaultOptions:t}=e;return(n,o)=>{const{target:r,unifyProcess:s,observeConfigs:l,detector:i,signal:a,customMatcher:c}=jt(o,t),f=[n,r,s,l,i,a,c],u=De.get(f);if(s&&u)return u;const C=new Promise(async(A,w)=>{if(a!=null&&a.aborted)return w(a.reason);const T=new MutationObserver(async B=>{for(const N of B){if(a!=null&&a.aborted){T.disconnect();break}const P=await st({selector:n,target:r,detector:i,customMatcher:c});if(P.isDetected){T.disconnect(),A(P.result);break}}});a==null||a.addEventListener("abort",()=>(T.disconnect(),w(a.reason)),{once:!0});const M=await st({selector:n,target:r,detector:i,customMatcher:c});if(M.isDetected)return A(M.result);T.observe(r,l)}).finally(()=>{De.delete(f)});return De.set(f,C),C}}async function st({target:e,selector:t,detector:n,customMatcher:o}){const r=o?o(t):e.querySelector(t);return await n(r)}const Wt=Bt({defaultOptions:Ot()});function Se(e,...t){}const Re={debug:(...e)=>Se(console.debug,...e),log:(...e)=>Se(console.log,...e),warn:(...e)=>Se(console.warn,...e),error:(...e)=>Se(console.error,...e)};function zt(e,t,n){var o,r;n.position!=="inline"&&(n.zIndex!=null&&(e.style.zIndex=String(n.zIndex)),e.style.overflow="visible",e.style.position="relative",e.style.width="0",e.style.height="0",e.style.display="block",t&&(n.position==="overlay"?(t.style.position="absolute",(o=n.alignment)!=null&&o.startsWith("bottom-")?t.style.bottom="0":t.style.top="0",(r=n.alignment)!=null&&r.endsWith("-right")?t.style.right="0":t.style.left="0"):(t.style.position="fixed",t.style.top="0",t.style.bottom="0",t.style.left="0",t.style.right="0")))}function Me(e){if(e.anchor==null)return document.body;let t=typeof e.anchor=="function"?e.anchor():e.anchor;return typeof t=="string"?t.startsWith("/")?document.evaluate(t,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue??void 0:document.querySelector(t)??void 0:t??void 0}function Vt(e,t){var o,r;const n=Me(t);if(n==null)throw Error("Failed to mount content script UI: could not find anchor element");switch(t.append){case void 0:case"last":n.append(e);break;case"first":n.prepend(e);break;case"replace":n.replaceWith(e);break;case"after":(o=n.parentElement)==null||o.insertBefore(e,n.nextElementSibling);break;case"before":(r=n.parentElement)==null||r.insertBefore(e,n);break;default:t.append(n,e);break}}function qt(e,t){let n;const o=()=>{n==null||n.stopAutoMount(),n=void 0},r=()=>{e.mount()},s=e.remove;return{mount:r,remove:()=>{o(),e.remove()},autoMount:a=>{n&&Re.warn("autoMount is already set."),n=Ht({mount:r,unmount:s,stopAutoMount:o},{...t,...a})}}}function Ht(e,t){const n=new AbortController,o="explicit_stop_auto_mount",r=()=>{var i;n.abort(o),(i=t.onStop)==null||i.call(t)};let s=typeof t.anchor=="function"?t.anchor():t.anchor;if(s instanceof Element)throw Error("autoMount and Element anchor option cannot be combined. Avoid passing `Element` directly or `() => Element` to the anchor.");async function l(i){let a=!!Me(t);for(a&&e.mount();!n.signal.aborted;)try{a=!!await Wt(i??"body",{customMatcher:()=>Me(t)??null,detector:a?Ut:rt,signal:n.signal}),a?e.mount():(e.unmount(),t.once&&e.stopAutoMount())}catch(c){if(n.signal.aborted&&n.signal.reason===o)break;throw c}}return l(s),{stopAutoMount:r}}function Gt(e){let t=e,n="";const o=/(\s*@(property|font-face)[\s\S]*?{[\s\S]*?})/gm;let r;for(;(r=o.exec(e))!==null;)n+=r[1],t=t.replace(r[1],"");return{documentCss:n.trim(),shadowCss:t.trim()}}async function Xt(e,t){var A;const n=Math.random().toString(36).substring(2,15),o=[];if(t.inheritStyles||o.push("/* WXT Shadow Root Reset */ :host{all:initial !important;}"),t.css&&o.push(t.css),((A=e.options)==null?void 0:A.cssInjectionMode)==="ui"){const w=await Jt();o.push(w.replaceAll(":root",":host"))}const{shadowCss:r,documentCss:s}=Gt(o.join(`
`).trim()),{isolatedElement:l,parentElement:i,shadow:a}=await Lt({name:t.name,css:{textContent:r},mode:t.mode??"open",isolateEvents:t.isolateEvents});i.setAttribute("data-wxt-shadow-root","");let c;const f=()=>{if(Vt(i,t),zt(i,a.querySelector("html"),t),s&&!document.querySelector(`style[wxt-shadow-root-document-styles="${n}"]`)){const w=document.createElement("style");w.textContent=s,w.setAttribute("wxt-shadow-root-document-styles",n),(document.head??document.body).append(w)}c=t.onMount(l,a,i)},u=()=>{var T;(T=t.onRemove)==null||T.call(t,c),i.remove();const w=document.querySelector(`style[wxt-shadow-root-document-styles="${n}"]`);for(w==null||w.remove();l.lastChild;)l.removeChild(l.lastChild);c=void 0},C=qt({mount:f,remove:u},t);return e.onInvalidated(u),{shadow:a,shadowHost:i,uiContainer:l,...C,get mounted(){return c}}}async function Jt(){const e=re.runtime.getURL("/content-scripts/content.css");try{return await(await fetch(e)).text()}catch(t){return Re.warn(`Failed to load styles @ ${e}. Did you forget to import the stylesheet in your entrypoint?`,t),""}}function qn(e){return e}function it(e){var t,n,o="";if(typeof e=="string"||typeof e=="number")o+=e;else if(typeof e=="object")if(Array.isArray(e)){var r=e.length;for(t=0;t<r;t++)e[t]&&(n=it(e[t]))&&(o&&(o+=" "),o+=n)}else for(n in e)e[n]&&(o&&(o+=" "),o+=n);return o}function Yt(){for(var e,t,n=0,o="",r=arguments.length;n<r;n++)(e=arguments[n])&&(t=it(e))&&(o&&(o+=" "),o+=t);return o}function j(...e){return Yt(e)}X(["click"]);var Qt=D('<div><div class="bg-surface rounded-lg p-4 flex flex-col items-center justify-center min-h-[80px]"><div class="text-2xl font-mono font-bold text-accent-primary"></div><div class="text-sm text-secondary mt-1">Score</div></div><div class="bg-surface rounded-lg p-4 flex flex-col items-center justify-center min-h-[80px]"><div class="text-2xl font-mono font-bold text-accent-secondary"></div><div class="text-sm text-secondary mt-1">Rank');const Zt=e=>(()=>{var t=Qt(),n=t.firstChild,o=n.firstChild,r=n.nextSibling,s=r.firstChild;return S(o,()=>e.score),S(s,()=>e.rank),W(()=>O(t,j("grid grid-cols-[1fr_1fr] gap-2 p-4",e.class))),t})();X(["click","input"]);var en=D("<div><div class=space-y-8>"),tn=D("<div>");const nn=e=>{const[t,n]=v(-1);let o;return be(()=>{if(!e.currentTime){n(-1);return}const r=e.currentTime,s=e.lyrics.findIndex(l=>{const i=l.startTime+l.duration;return r>=l.startTime&&r<i});n(s)}),be(()=>{const r=t();if(r===-1||!o||!e.isPlaying)return;const l=o.querySelectorAll("[data-line-index]")[r];if(l){const i=o.clientHeight,a=l.offsetTop,c=l.offsetHeight,f=a-i/2+c/2;o.scrollTo({top:f,behavior:"smooth"})}}),(()=>{var r=en(),s=r.firstChild,l=o;return typeof l=="function"?Tt(l,r):o=r,S(s,I(Ze,{get each(){return e.lyrics},children:(i,a)=>(()=>{var c=tn();return S(c,()=>i.text),W(f=>{var u=a(),C=j("text-center transition-all duration-300","text-2xl leading-relaxed",a()===t()?"text-primary font-semibold scale-110":"text-secondary opacity-60");return u!==f.e&&At(c,"data-line-index",f.e=u),C!==f.t&&O(c,f.t=C),f},{e:void 0,t:void 0}),c})()})),W(()=>O(r,j("lyrics-display overflow-y-auto scroll-smooth","h-full px-6 py-12",e.class))),r})()};X(["click"]);var on=D("<div>"),rn=D("<div><span>#</span><span></span><span>");const sn=e=>(()=>{var t=on();return S(t,I(Ze,{get each(){return e.entries},children:n=>(()=>{var o=rn(),r=o.firstChild;r.firstChild;var s=r.nextSibling,l=s.nextSibling;return S(r,()=>n.rank,null),S(s,()=>n.username),S(l,()=>n.score.toLocaleString()),W(i=>{var a=j("flex items-center gap-3 px-3 py-2 rounded-lg transition-colors",n.isCurrentUser?"bg-accent-primary/10 border border-accent-primary/20":"bg-surface hover:bg-surface-hover"),c=j("w-8 text-center font-mono font-bold",n.rank<=3?"text-accent-primary":"text-secondary"),f=j("flex-1 truncate",n.isCurrentUser?"text-accent-primary font-medium":"text-primary"),u=j("font-mono font-bold",n.isCurrentUser?"text-accent-primary":"text-primary");return a!==i.e&&O(o,i.e=a),c!==i.t&&O(r,i.t=c),f!==i.a&&O(s,i.a=f),u!==i.o&&O(l,i.o=u),i},{e:void 0,t:void 0,a:void 0,o:void 0}),o})()})),W(()=>O(t,j("flex flex-col gap-2 p-4",e.class))),t})();var ln=D('<div><button><span class="relative z-10">Start</span></button><div class="w-px bg-black/20"></div><button aria-label="Change playback speed"><span class="relative z-10">');const Ne=["1x","0.75x","0.5x"],an=e=>{const[t,n]=v(0),o=()=>Ne[t()],r=s=>{var a;s.stopPropagation();const l=(t()+1)%Ne.length;n(l);const i=Ne[l];i&&((a=e.onSpeedChange)==null||a.call(e,i))};return(()=>{var s=ln(),l=s.firstChild,i=l.nextSibling,a=i.nextSibling,c=a.firstChild;return tt(l,"click",e.onStart),a.$$click=r,S(c,o),W(f=>{var u=j("relative inline-flex w-full rounded-lg overflow-hidden","bg-gradient-primary text-white shadow-lg","transition-all duration-300",e.class),C=e.disabled,A=j("flex-1 inline-flex items-center justify-center relative overflow-hidden","h-12 px-6 text-lg font-medium","cursor-pointer border-none outline-none","disabled:cursor-not-allowed disabled:opacity-50","hover:bg-white/10 active:bg-white/20"),w=e.disabled,T=j("inline-flex items-center justify-center relative","w-20 text-lg font-medium","cursor-pointer border-none outline-none","disabled:cursor-not-allowed disabled:opacity-50","hover:bg-white/10 active:bg-white/20",'after:content-[""] after:absolute after:inset-0',"after:bg-gradient-to-r after:from-transparent after:via-white/20 after:to-transparent","after:translate-x-[-200%] hover:after:translate-x-[200%]","after:transition-transform after:duration-700");return u!==f.e&&O(s,f.e=u),C!==f.t&&(l.disabled=f.t=C),A!==f.a&&O(l,f.a=A),w!==f.o&&(a.disabled=f.o=w),T!==f.i&&O(a,f.i=T),f},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),s})()};X(["click"]);var Ue=D("<div>"),cn=D("<button>");const Oe=ht(),un=e=>{var s,l;const[t,n]=v(e.defaultTab||((s=e.tabs[0])==null?void 0:s.id)||"");console.log("[Tabs] Initializing with:",{defaultTab:e.defaultTab,firstTabId:(l=e.tabs[0])==null?void 0:l.id,activeTab:t()});const r={activeTab:t,setActiveTab:i=>{var a;console.log("[Tabs] Tab changed to:",i),n(i),(a=e.onTabChange)==null||a.call(e,i)}};return I(Oe.Provider,{value:r,get children(){var i=Ue();return S(i,()=>e.children),W(()=>O(i,j("w-full",e.class))),i}})},dn=e=>(()=>{var t=Ue();return S(t,()=>e.children),W(()=>O(t,j("inline-flex h-10 items-center justify-center rounded-md bg-surface p-1 text-secondary","w-full",e.class))),t})(),lt=e=>{const t=qe(Oe);if(!t)return console.error("[TabsTrigger] No TabsContext found. TabsTrigger must be used within Tabs component."),null;const n=()=>t.activeTab()===e.value;return(()=>{var o=cn();return o.$$click=()=>t.setActiveTab(e.value),S(o,()=>e.children),W(()=>O(o,j("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5","text-sm font-medium ring-offset-base transition-all","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent-primary focus-visible:ring-offset-2","disabled:pointer-events-none disabled:opacity-50","flex-1",n()?"bg-base text-primary shadow-sm":"text-secondary hover:text-primary",e.class))),o})()},at=e=>{const t=qe(Oe);if(!t)return console.error("[TabsContent] No TabsContext found. TabsContent must be used within Tabs component."),null;const n=t.activeTab()===e.value;return console.log("[TabsContent] Rendering:",{value:e.value,activeTab:t.activeTab(),isActive:n}),I(Z,{when:n,get children(){var o=Ue();return S(o,()=>e.children),W(()=>O(o,j("mt-2 ring-offset-base","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent-primary focus-visible:ring-offset-2",e.class))),o}})};X(["click"]);var fn=D("<div class=px-4>"),hn=D('<div class="p-4 bg-surface border-t border-subtle">'),gn=D('<div class="flex flex-col h-full"><div class="flex-1 min-h-0 overflow-hidden">'),pn=D('<div class="overflow-y-auto h-full">'),yn=D("<div>");const mn=e=>{var t;return console.log("[ExtensionKaraokeView] Rendering with props:",{isPlaying:e.isPlaying,hasOnStart:!!e.onStart,lyricsLength:(t=e.lyrics)==null?void 0:t.length}),(()=>{var n=yn();return S(n,I(Zt,{get score(){return e.score},get rank(){return e.rank}}),null),S(n,I(un,{tabs:[{id:"lyrics",label:"Lyrics"},{id:"leaderboard",label:"Leaderboard"}],defaultTab:"lyrics",class:"flex-1 flex flex-col min-h-0",get children(){return[(()=>{var o=fn();return S(o,I(dn,{get children(){return[I(lt,{value:"lyrics",children:"Lyrics"}),I(lt,{value:"leaderboard",children:"Leaderboard"})]}})),o})(),I(at,{value:"lyrics",class:"flex-1 min-h-0",get children(){return[G(()=>console.log("[ExtensionKaraokeView] Inside lyrics TabsContent")),(()=>{var o=gn(),r=o.firstChild;return S(r,I(nn,{get lyrics(){return e.lyrics},get currentTime(){return e.currentTime},get isPlaying(){return e.isPlaying}})),S(o,()=>console.log("[ExtensionKaraokeView] Start button check:",{isPlaying:e.isPlaying,notPlaying:!e.isPlaying,hasOnStart:!!e.onStart,shouldShowButton:()=>!e.isPlaying&&e.onStart}),null),S(o,I(Z,{get when(){return!e.isPlaying&&e.onStart},get children(){var s=hn();return s.style.setProperty("flex-shrink","0"),S(s,()=>console.log("[ExtensionKaraokeView] Rendering Start button div"),null),S(s,I(an,{get onStart(){return e.onStart},get onSpeedChange(){return e.onSpeedChange}}),null),s}}),null),o})()]}}),I(at,{value:"leaderboard",class:"flex-1 overflow-hidden",get children(){var o=pn();return S(o,I(sn,{get entries(){return e.leaderboard}})),o}})]}}),null),W(()=>O(n,j("flex flex-col h-full bg-base",e.class))),n})()};function bn(e){const[t,n]=v(null),[o,r]=v(null),[s,l]=v(null),[i,a]=v(!1),[c,f]=v(null),[u,C]=v(!1),[A,w]=v(null),[T,M]=v([]),[B,N]=v(!1),[P,_]=v([]),F=e==null?void 0:e.sampleRate,L=async()=>{if(!t()){f(null);try{console.log("[KaraokeAudioProcessor] Initializing audio capture...");const d=new AudioContext({sampleRate:F});n(d);const g=await navigator.mediaDevices.getUserMedia({audio:{sampleRate:F,channelCount:1,echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1}});r(g),await d.audioWorklet.addModule(de());const m=new AudioWorkletNode(d,"karaoke-audio-processor",{numberOfInputs:1,numberOfOutputs:0,channelCount:1});m.port.onmessage=E=>{if(E.data.type==="audioData"){const R=new Float32Array(E.data.audioData);A()!==null&&M(z=>[...z,R]),B()&&_(z=>[...z,R])}},l(m);const k=d.createMediaStreamSource(g),b=d.createGain();b.gain.value=1.2,k.connect(b),b.connect(m),a(!0),console.log("[KaraokeAudioProcessor] Audio capture initialized successfully.")}catch(d){console.error("[KaraokeAudioProcessor] Failed to initialize:",d),f(d instanceof Error?d:new Error("Unknown audio initialization error")),a(!1)}}},de=()=>{const d=`
      class KaraokeAudioProcessor extends AudioWorkletProcessor {
        constructor() {
          super();
          this.bufferSize = 1024;
          this.rmsHistory = [];
          this.maxHistoryLength = 10;
        }

        process(inputs, outputs, parameters) {
          const input = inputs[0];
          if (input && input[0]) {
            const inputData = input[0];
            
            let sum = 0;
            for (let i = 0; i < inputData.length; i++) {
              sum += inputData[i] * inputData[i];
            }
            const rms = Math.sqrt(sum / inputData.length);
            
            this.rmsHistory.push(rms);
            if (this.rmsHistory.length > this.maxHistoryLength) {
              this.rmsHistory.shift();
            }
            
            const avgRms = this.rmsHistory.reduce((a, b) => a + b, 0) / this.rmsHistory.length;
            
            this.port.postMessage({
              type: 'audioData',
              audioData: inputData,
              rmsLevel: rms,
              avgRmsLevel: avgRms,
              isTooQuiet: avgRms < 0.01,
              isTooLoud: avgRms > 0.3
            });
          }
          return true;
        }
      }
      registerProcessor('karaoke-audio-processor', KaraokeAudioProcessor);
    `,g=new Blob([d],{type:"application/javascript"});return URL.createObjectURL(g)},se=()=>{const d=t();d&&d.state==="suspended"&&d.resume(),C(!0),console.log("[KaraokeAudioProcessor] Started listening for audio.")},fe=()=>{const d=t();d&&d.state==="running"&&d.suspend(),C(!1),console.log("[KaraokeAudioProcessor] Paused listening for audio.")},ee=()=>{console.log("[KaraokeAudioProcessor] Cleaning up audio capture...");const d=o();d&&(d.getTracks().forEach(m=>m.stop()),r(null));const g=t();g&&g.state!=="closed"&&(g.close(),n(null)),l(null),a(!1),C(!1),console.log("[KaraokeAudioProcessor] Audio capture cleaned up.")};ve(ee);const ie=d=>{console.log(`[KaraokeAudioProcessor] Starting audio capture for line ${d}`),w(d),M([]),i()&&!u()&&se()},he=()=>{const d=A();if(d===null)return console.warn("[KaraokeAudioProcessor] No active recording line."),[];const g=T();console.log(`[KaraokeAudioProcessor] Stopping capture for line ${d}. Collected ${g.length} chunks.`),w(null);const m=[...g];return M([]),m.length===0&&console.log(`[KaraokeAudioProcessor] No audio captured for line ${d}.`),m},y=d=>{if(d.length===0)return null;const g=d.reduce((b,E)=>b+E.length,0),m=new Float32Array(g);let k=0;for(const b of d)m.set(b,k),k+=b.length;return x(m,F)},x=(d,g)=>{const m=d.length,k=new ArrayBuffer(44+m*2),b=new DataView(k),E=(z,Te)=>{for(let Ee=0;Ee<Te.length;Ee++)b.setUint8(z+Ee,Te.charCodeAt(Ee))};E(0,"RIFF"),b.setUint32(4,36+m*2,!0),E(8,"WAVE"),E(12,"fmt "),b.setUint32(16,16,!0),b.setUint16(20,1,!0),b.setUint16(22,1,!0),b.setUint32(24,g,!0),b.setUint32(28,g*2,!0),b.setUint16(32,2,!0),b.setUint16(34,16,!0),E(36,"data"),b.setUint32(40,m*2,!0);const R=44;for(let z=0;z<m;z++){const Te=Math.max(-1,Math.min(1,d[z]||0));b.setInt16(R+z*2,Te*32767,!0)}return new Blob([k],{type:"audio/wav"})};return{isReady:i,error:c,isListening:u,isSessionActive:B,initialize:L,startListening:se,pauseListening:fe,cleanup:ee,startRecordingLine:ie,stopRecordingLineAndGetRawAudio:he,convertAudioToWavBlob:y,startFullSession:()=>{console.log("[KaraokeAudioProcessor] Starting full session recording"),_([]),N(!0)},stopFullSessionAndGetWav:()=>{console.log("[KaraokeAudioProcessor] Stopping full session recording"),N(!1);const d=P(),g=y(d);return console.log(`[KaraokeAudioProcessor] Full session: ${d.length} chunks, ${g?(g.size/1024).toFixed(1)+"KB":"null"}`),_([]),g}}}const vn=8,wn=15,xn=3;function kn(e){return e.trim().split(/\s+/).filter(t=>t.length>0).length}function Sn(e,t){let n=0,o=t;const r=[];for(;o<e.length&&n<vn;){const s=e[o];if(!s)break;const l=kn(s.text);if(n+l>wn&&n>=5||(r.push(s.text),n+=l,o++,o-t>=xn))break}return{startIndex:t,endIndex:o-1,expectedText:r.join(" "),wordCount:n}}function Cn(e,t){var s;const{startIndex:n,endIndex:o}=t,r=e[n];if(!r)return 3e3;if(o>n){const l=e[o];if(l&&r.recordingStart&&l.recordingEnd)return l.recordingEnd-r.recordingStart;if(o+1<e.length){const a=e[o+1];if(a)return a.timestamp-r.timestamp}let i=0;for(let a=n;a<=o;a++)i+=((s=e[a])==null?void 0:s.duration)||3e3;return Math.min(i,8e3)}else{if(r.recordingStart&&r.recordingEnd)return r.recordingEnd-r.recordingStart;if(n+1<e.length){const l=e[n+1];if(l){const i=l.timestamp-r.timestamp;return Math.min(Math.max(i,1e3),5e3)}}return Math.min(r.duration||3e3,5e3)}}var An=D('<button aria-label="Open Karaoke"><span>🎤');const Tn=e=>(()=>{var t=An(),n=t.firstChild;return t.addEventListener("mouseleave",o=>{o.currentTarget.style.transform="scale(1)"}),t.addEventListener("mouseenter",o=>{o.currentTarget.style.transform="scale(1.1)"}),tt(t,"click",e.onClick),t.style.setProperty("position","fixed"),t.style.setProperty("bottom","24px"),t.style.setProperty("right","24px"),t.style.setProperty("width","80px"),t.style.setProperty("height","80px"),t.style.setProperty("border-radius","50%"),t.style.setProperty("background","linear-gradient(135deg, #FF006E 0%, #C13584 100%)"),t.style.setProperty("box-shadow","0 8px 32px rgba(0, 0, 0, 0.3)"),t.style.setProperty("display","flex"),t.style.setProperty("align-items","center"),t.style.setProperty("justify-content","center"),t.style.setProperty("overflow","hidden"),t.style.setProperty("cursor","pointer"),t.style.setProperty("z-index","99999"),t.style.setProperty("border","none"),t.style.setProperty("transition","transform 0.2s ease"),n.style.setProperty("font-size","36px"),t})();X(["click"]),X(["click"]),X(["click"]);function En(e){const[t,n]=v(!1),[o,r]=v(0),[s,l]=v(0),[i,a]=v(null),[c,f]=v(null),[u,C]=v([]),[A,w]=v(null),[T,M]=v(!1),[B,N]=v(e.audioElement);let P=null,_=null;const F=bn({sampleRate:16e3}),L=e.apiUrl||"http://localhost:3000/api",de=async()=>{try{await F.initialize(),console.log("[KaraokeSession] Audio processor initialized")}catch(p){console.error("[KaraokeSession] Failed to initialize audio:",p)}if(e.trackId&&e.songData)try{const p=await fetch(`${L}/karaoke/start`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({trackId:e.trackId,songData:e.songData})});if(p.ok){const d=await p.json();f(d.session.id),console.log("[KaraokeSession] Session created:",d.session.id)}}catch(p){console.error("[KaraokeSession] Failed to create session:",p)}a(3);const h=setInterval(()=>{const p=i();p!==null&&p>1?a(p-1):(clearInterval(h),a(null),se())},1e3)},se=()=>{n(!0),F.startFullSession();const h=B()||e.audioElement;h?(console.log("[KaraokeSession] Starting playback with audio element"),h.play().catch(console.error),P=setInterval(()=>{const d=h.currentTime*1e3;r(d),fe(d)},100),h.addEventListener("ended",y)):console.log("[KaraokeSession] No audio element available for playback")},fe=h=>{if(!(T()||!e.lyrics.length))for(let p=0;p<e.lyrics.length;p++){const d=Sn(e.lyrics,p),g=e.lyrics[d.startIndex];if(g&&g.startTime!==void 0){const m=g.startTime*1e3-1e3;if(h>=m&&h<g.startTime*1e3){console.log(`[KaraokeSession] Time to start recording chunk ${p}: ${h}ms >= ${m}ms`),ee(d);break}}p=d.endIndex}},ee=async h=>{console.log(`[KaraokeSession] Starting recording for chunk ${h.startIndex}-${h.endIndex}`),w(h),M(!0),F.startRecordingLine(h.startIndex);const p=Cn(e.lyrics,h);_=setTimeout(()=>{ie()},p)},ie=async()=>{const h=A();if(!h)return;console.log(`[KaraokeSession] Stopping recording for chunk ${h.startIndex}-${h.endIndex}`),M(!1);const p=F.stopRecordingLineAndGetRawAudio(),d=F.convertAudioToWavBlob(p);if(d&&c()){const g=new FileReader;g.onloadend=async()=>{var k;const m=(k=g.result)==null?void 0:k.toString().split(",")[1];m&&await he(h,m)},g.readAsDataURL(d)}w(null),_&&(clearTimeout(_),_=null)},he=async(h,p)=>{var d,g;if(c())try{const m=await fetch(`${L}/karaoke/grade`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:c(),lineIndex:h.startIndex,audioBuffer:p,expectedText:h.expectedText,startTime:((d=e.lyrics[h.startIndex])==null?void 0:d.startTime)||0,endTime:((g=e.lyrics[h.endIndex])==null?void 0:g.endTime)||0})});if(m.ok){const k=await m.json();console.log("[KaraokeSession] Chunk graded:",k),C(R=>[...R,{lineIndex:h.startIndex,score:k.score,transcription:k.transcription,feedback:k.feedback}]);const b=[...u(),{lineIndex:h.startIndex,score:k.score,transcription:k.transcription}],E=b.reduce((R,z)=>R+z.score,0)/b.length;l(Math.round(E))}}catch(m){console.error("[KaraokeSession] Failed to grade chunk:",m)}},y=async()=>{var p,d;n(!1),P&&clearInterval(P),T()&&ie();const h=F.stopFullSessionAndGetWav();if(c()&&h)try{const g=new FileReader;g.onloadend=async()=>{var b,E;const m=(b=g.result)==null?void 0:b.toString().split(",")[1],k=await fetch(`${L}/karaoke/complete`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:c(),fullAudioBuffer:m})});if(k.ok){const R=await k.json();console.log("[KaraokeSession] Session completed:",R);const z={score:R.finalScore,accuracy:R.accuracy,totalLines:R.totalLines,perfectLines:R.perfectLines,goodLines:R.goodLines,needsWorkLines:R.needsWorkLines,sessionId:c()||void 0};(E=e.onComplete)==null||E.call(e,z)}},g.readAsDataURL(h)}catch(g){console.error("[KaraokeSession] Failed to complete session:",g);const m=u(),k=m.length>0?m.reduce((E,R)=>E+R.score,0)/m.length:0,b={score:Math.round(k),accuracy:Math.round(k),totalLines:e.lyrics.length,perfectLines:m.filter(E=>E.score>=90).length,goodLines:m.filter(E=>E.score>=70&&E.score<90).length,needsWorkLines:m.filter(E=>E.score<70).length,sessionId:c()||void 0};(p=e.onComplete)==null||p.call(e,b)}else{const g=u(),m=g.length>0?g.reduce((b,E)=>b+E.score,0)/g.length:0,k={score:Math.round(m),accuracy:Math.round(m),totalLines:e.lyrics.length,perfectLines:g.filter(b=>b.score>=90).length,goodLines:g.filter(b=>b.score>=70&&b.score<90).length,needsWorkLines:g.filter(b=>b.score<70).length};(d=e.onComplete)==null||d.call(e,k)}},x=()=>{n(!1),a(null),M(!1),w(null),P&&(clearInterval(P),P=null),_&&(clearTimeout(_),_=null);const h=B()||e.audioElement;h&&(h.pause(),h.currentTime=0,h.removeEventListener("ended",y)),F.cleanup()};return ve(()=>{x()}),{isPlaying:t,currentTime:o,score:s,countdown:i,sessionId:c,lineScores:u,isRecording:T,currentChunk:A,startSession:de,stopSession:x,audioProcessor:F,setAudioElement:N}}class Pn{detectCurrentTrack(){return window.location.href.includes("sc.maid.zone")?this.detectSoundCloudTrack():null}detectSoundCloudTrack(){try{const t=window.location.pathname.split("/").filter(Boolean);if(t.length<2)return null;const n=t[0],o=t[1],r=[".soundTitle__title",".trackItem__trackTitle",'h1[itemprop="name"]',".sound__header h1",".sc-text-h4",".sc-text-primary"];let s="";for(const i of r){const a=document.querySelector(i);if(a&&a.textContent){s=a.textContent.trim();break}}s||(s=o.replace(/-/g," "));const l=n.replace(/-/g," ").replace(/_/g," ");return{trackId:`${n}/${o}`,title:s,artist:l,platform:"soundcloud",url:window.location.href}}catch(t){return console.error("[TrackDetector] Error detecting SoundCloud track:",t),null}}watchForChanges(t){let n=window.location.href,o=this.detectCurrentTrack();t(o);const r=()=>{const c=window.location.href;if(c!==n){n=c;const f=this.detectCurrentTrack();(!o||!f||o.trackId!==f.trackId)&&(o=f,t(f))}},s=setInterval(r,1e3),l=()=>{setTimeout(r,100)};window.addEventListener("popstate",l);const i=history.pushState,a=history.replaceState;return history.pushState=function(...c){i.apply(history,c),l()},history.replaceState=function(...c){a.apply(history,c),l()},()=>{clearInterval(s),window.removeEventListener("popstate",l),history.pushState=i,history.replaceState=a}}}const $n=new Pn;async function _n(){return(await re.storage.local.get("authToken")).authToken||null}class In{constructor(){Y(this,"baseUrl");this.baseUrl="http://localhost:8787/api"}async getKaraokeData(t,n,o){try{const r=new URLSearchParams;n&&r.set("title",n),o&&r.set("artist",o);const s=`${this.baseUrl}/karaoke/${encodeURIComponent(t)}${r.toString()?"?"+r.toString():""}`;console.log("[KaraokeApi] Fetching karaoke data:",s);const l=await fetch(s,{method:"GET"});if(!l.ok)return console.error("[KaraokeApi] Failed to fetch karaoke data:",l.status),null;const i=await l.json();return console.log("[KaraokeApi] Received karaoke data:",i),i.error?(console.log("[KaraokeApi] Server error (but API is reachable):",i.error),{success:!1,has_karaoke:!1,error:i.error,track_id:t,api_connected:!0}):i}catch(r){return console.error("[KaraokeApi] Error fetching karaoke data:",r),null}}async startSession(t,n){try{const o=await fetch(`${this.baseUrl}/karaoke/start`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({trackId:t,songData:n})});return o.ok?(await o.json()).session:(console.error("[KaraokeApi] Failed to start session:",o.status),null)}catch(o){return console.error("[KaraokeApi] Error starting session:",o),null}}async testConnection(){try{return(await fetch(`${this.baseUrl.replace("/api","")}/health`)).ok}catch(t){return console.error("[KaraokeApi] Connection test failed:",t),!1}}}const Fn=new In;var Ln=D('<div class="absolute inset-0 bg-black/80 flex items-center justify-center z-50"><div class=text-center><div class="text-8xl font-bold text-white animate-pulse"></div><p class="text-xl text-white/80 mt-4">Get ready!'),Kn=D('<div class="h-full flex flex-col"><div class="flex-1 min-h-0 overflow-hidden">'),Dn=D('<div><div class="h-full bg-surface rounded-2xl overflow-hidden flex flex-col"><div class="flex items-center justify-end p-2 bg-surface border-b border-subtle"><button class="w-10 h-10 flex items-center justify-center rounded-lg transition-colors hover:bg-white/10"aria-label=Minimize><svg width=24 height=24 viewBox="0 0 24 24"fill=none xmlns=http://www.w3.org/2000/svg><path d="M6 12h12"stroke=currentColor stroke-width=3 stroke-linecap=round></path></svg></button></div><div class="flex-1 min-h-0 overflow-hidden">'),Rn=D("<div>"),Mn=D('<div class="flex items-center justify-center h-full bg-base"><div class=text-center><div class="animate-spin rounded-full h-12 w-12 border-b-2 border-accent-primary mx-auto mb-4"></div><p class=text-secondary>Loading lyrics...'),Nn=D('<div class="flex items-center justify-center h-full p-8"><div class=text-center><p class="text-lg text-secondary mb-2">No lyrics available</p><p class="text-sm text-tertiary">Try a different song');const Un=()=>{console.log("[ContentApp] Rendering ContentApp component");const[e,t]=v(null),[n,o]=v(null),[r,s]=v(!1),[l,i]=v(null),[a,c]=v(!1),[f,u]=v(!1),[C,A]=v(!1),[w,T]=v(null),[M,B]=v(!1),[N,P]=v(0),[_,F]=v(null),[L,de]=v(null);ft(async()=>{console.log("[ContentApp] Loading auth token");const y=await _n();y?(o(y),console.log("[ContentApp] Auth token loaded")):(console.log("[ContentApp] No auth token found, using demo token"),o("scarlett_demo_token_123"));const x=$n.watchForChanges(h=>{console.log("[ContentApp] Track changed:",h),t(h),h&&(s(!0),se(h))});ve(x)});const se=async y=>{console.log("[ContentApp] Fetching karaoke data for track:",y),c(!0);try{const x=await Fn.getKaraokeData(y.trackId,y.title,y.artist);console.log("[ContentApp] Karaoke data loaded:",x),i(x)}catch(x){console.error("[ContentApp] Failed to fetch karaoke data:",x)}finally{c(!1)}},fe=async()=>{var h;console.log("[ContentApp] Start karaoke session"),u(!0);const y=l();_();const x=e();if(y&&x&&((h=y.lyrics)!=null&&h.lines)){console.log("[ContentApp] Creating karaoke session with audio capture");const p=En({lyrics:y.lyrics.lines,trackId:x.id,songData:y.song?{title:y.song.title,artist:y.song.artist,album:y.song.album,duration:y.song.duration}:{title:x.title,artist:x.artist},audioElement:void 0,apiUrl:"http://localhost:3000/api",onComplete:d=>{console.log("[ContentApp] Karaoke session completed:",d),u(!1)}});de(p),await p.startSession(),be(()=>{p.countdown()===null&&p.isPlaying()&&!M()&&(console.log("[ContentApp] Countdown finished, starting audio playback"),ee());const d=_();d&&p&&(console.log("[ContentApp] Setting audio element on new session"),p.setAudioElement(d))})}else{console.log("[ContentApp] Fallback to simple countdown"),T(3);const p=setInterval(()=>{const d=w();d!==null&&d>1?T(d-1):(clearInterval(p),T(null),ee())},1e3)}},ee=()=>{console.log("[ContentApp] Starting audio playback"),B(!0);const y=document.querySelectorAll("audio");if(console.log("[ContentApp] Found audio elements:",y.length),y.length>0){const x=y[0];console.log("[ContentApp] Audio element:",{src:x.src,paused:x.paused,duration:x.duration,currentTime:x.currentTime}),F(x);const h=L();h&&(console.log("[ContentApp] Setting audio element on karaoke session"),h.setAudioElement(x),h.audioProcessor.isReady()||(console.log("[ContentApp] Initializing audio processor for session"),h.audioProcessor.initialize().catch(console.error))),x.play().then(()=>{console.log("[ContentApp] Audio started playing successfully")}).catch(d=>{console.error("[ContentApp] Failed to play audio:",d),console.log("[ContentApp] Attempting to click play button...");const g=document.querySelector('button[title*="Play"], button[aria-label*="Play"], .playControl, .playButton, [class*="play-button"]');g&&(console.log("[ContentApp] Found play button, clicking it"),g.click())});const p=()=>{P(x.currentTime)};x.addEventListener("timeupdate",p),x.addEventListener("ended",()=>{B(!1),x.removeEventListener("timeupdate",p)})}else{console.log("[ContentApp] No audio elements found, trying SoundCloud-specific approach");const x=document.querySelector('.playControl, .sc-button-play, button[title*="Play"]');x&&(console.log("[ContentApp] Found SoundCloud play button, clicking it"),x.click(),setTimeout(()=>{const h=document.querySelectorAll("audio");if(h.length>0){console.log("[ContentApp] Found audio element after clicking play");const p=h[0];F(p);const d=()=>{P(p.currentTime)};p.addEventListener("timeupdate",d),p.addEventListener("ended",()=>{B(!1),p.removeEventListener("timeupdate",d)})}},500))}},ie=()=>{console.log("[ContentApp] Minimize karaoke widget"),A(!0)},he=()=>{console.log("[ContentApp] Restore karaoke widget"),A(!1)};return console.log("[ContentApp] Render state:",{showKaraoke:r(),currentTrack:e(),karaokeData:l(),loading:a()}),[I(Z,{get when(){return G(()=>!!(r()&&e()))()&&C()},get children(){return I(Tn,{onClick:he})}}),I(Z,{get when(){return G(()=>!!(r()&&e()))()&&!C()},get fallback(){return(()=>{var y=Rn();return y.style.setProperty("display","none"),S(y,()=>console.log("[ContentApp] Not showing - showKaraoke:",r(),"currentTrack:",e())),y})()},get children(){var y=Dn(),x=y.firstChild,h=x.firstChild,p=h.firstChild,d=h.nextSibling;return y.style.setProperty("position","fixed"),y.style.setProperty("top","20px"),y.style.setProperty("right","20px"),y.style.setProperty("bottom","20px"),y.style.setProperty("width","480px"),y.style.setProperty("z-index","99999"),y.style.setProperty("overflow","hidden"),y.style.setProperty("border-radius","16px"),y.style.setProperty("box-shadow","0 25px 50px -12px rgba(0, 0, 0, 0.6)"),y.style.setProperty("display","flex"),y.style.setProperty("flex-direction","column"),S(y,()=>console.log("[ContentApp] Rendering ExtensionKaraokeView with data:",l(),"session:",L()),x),h.style.setProperty("height","48px"),p.$$click=ie,p.style.setProperty("color","#a8a8a8"),S(d,I(Z,{get when(){return!a()},get fallback(){return Mn()},get children(){return I(Z,{get when(){var g,m;return(m=(g=l())==null?void 0:g.lyrics)==null?void 0:m.lines},get fallback(){return Nn()},get children(){var g=Kn(),m=g.firstChild;return S(m,I(mn,{get score(){return G(()=>!!L())()?L().score():0},rank:1,get lyrics(){var k,b;return((b=(k=l())==null?void 0:k.lyrics)==null?void 0:b.lines)||[]},get currentTime(){return G(()=>!!L())()?L().currentTime():N()*1e3},leaderboard:[],get isPlaying(){return G(()=>!!L())()?L().isPlaying():M()||w()!==null},onStart:fe,onSpeedChange:k=>console.log("[ContentApp] Speed changed:",k),get isRecording(){return G(()=>!!L())()?L().isRecording():!1}})),S(g,I(Z,{get when(){return G(()=>!!L())()?L().countdown()!==null:w()!==null},get children(){var k=Ln(),b=k.firstChild,E=b.firstChild;return S(E,(()=>{var R=G(()=>!!L());return()=>R()?L().countdown():w()})()),k}}),null),g}})}})),y}})]};X(["click"]);const On={matches:["*://soundcloud.com/*","*://soundcloak.com/*","*://sc.maid.zone/*","*://*.maid.zone/*"],runAt:"document_idle",cssInjectionMode:"ui",async main(e){if(window.top!==window.self){console.log("[Scarlett CS] Not top-level frame, skipping content script.");return}console.log("[Scarlett CS] Scarlett Karaoke content script loaded"),(await Xt(e,{name:"scarlett-karaoke-ui",position:"overlay",anchor:"body",onMount:async n=>{var l;console.log("[Content Script] onMount called, container:",n),console.log("[Content Script] Shadow root:",n.getRootNode());const o=n.getRootNode();console.log("[Content Script] Shadow root stylesheets:",(l=o.styleSheets)==null?void 0:l.length);const r=document.createElement("div");r.className="karaoke-widget-container",n.appendChild(r),console.log("[Content Script] Wrapper created and appended:",r),console.log("[Content Script] Wrapper computed styles:",window.getComputedStyle(r)),console.log("[Content Script] About to render ContentApp");const s=Ct(()=>I(Un,{}),r);return console.log("[Content Script] ContentApp rendered, dispose function:",s),s},onRemove:n=>{n==null||n()}})).mount(),console.log("[Scarlett CS] Karaoke overlay mounted")}},Ae=class Ae extends Event{constructor(t,n){super(Ae.EVENT_NAME,{}),this.newUrl=t,this.oldUrl=n}};Y(Ae,"EVENT_NAME",Be("wxt:locationchange"));let je=Ae;function Be(e){var t;return`${(t=re==null?void 0:re.runtime)==null?void 0:t.id}:content:${e}`}function jn(e){let t,n;return{run(){t==null&&(n=new URL(location.href),t=e.setInterval(()=>{let o=new URL(location.href);o.href!==n.href&&(window.dispatchEvent(new je(o,n)),n=o)},1e3))}}}const ue=class ue{constructor(t,n){Y(this,"isTopFrame",window.self===window.top);Y(this,"abortController");Y(this,"locationWatcher",jn(this));Y(this,"receivedMessageIds",new Set);this.contentScriptName=t,this.options=n,this.abortController=new AbortController,this.isTopFrame?(this.listenForNewerScripts({ignoreFirstEvent:!0}),this.stopOldScripts()):this.listenForNewerScripts()}get signal(){return this.abortController.signal}abort(t){return this.abortController.abort(t)}get isInvalid(){return re.runtime.id==null&&this.notifyInvalidated(),this.signal.aborted}get isValid(){return!this.isInvalid}onInvalidated(t){return this.signal.addEventListener("abort",t),()=>this.signal.removeEventListener("abort",t)}block(){return new Promise(()=>{})}setInterval(t,n){const o=setInterval(()=>{this.isValid&&t()},n);return this.onInvalidated(()=>clearInterval(o)),o}setTimeout(t,n){const o=setTimeout(()=>{this.isValid&&t()},n);return this.onInvalidated(()=>clearTimeout(o)),o}requestAnimationFrame(t){const n=requestAnimationFrame((...o)=>{this.isValid&&t(...o)});return this.onInvalidated(()=>cancelAnimationFrame(n)),n}requestIdleCallback(t,n){const o=requestIdleCallback((...r)=>{this.signal.aborted||t(...r)},n);return this.onInvalidated(()=>cancelIdleCallback(o)),o}addEventListener(t,n,o,r){var s;n==="wxt:locationchange"&&this.isValid&&this.locationWatcher.run(),(s=t.addEventListener)==null||s.call(t,n.startsWith("wxt:")?Be(n):n,o,{...r,signal:this.signal})}notifyInvalidated(){this.abort("Content script context invalidated"),Re.debug(`Content script "${this.contentScriptName}" context invalidated`)}stopOldScripts(){window.postMessage({type:ue.SCRIPT_STARTED_MESSAGE_TYPE,contentScriptName:this.contentScriptName,messageId:Math.random().toString(36).slice(2)},"*")}verifyScriptStartedEvent(t){var s,l,i;const n=((s=t.data)==null?void 0:s.type)===ue.SCRIPT_STARTED_MESSAGE_TYPE,o=((l=t.data)==null?void 0:l.contentScriptName)===this.contentScriptName,r=!this.receivedMessageIds.has((i=t.data)==null?void 0:i.messageId);return n&&o&&r}listenForNewerScripts(t){let n=!0;const o=r=>{if(this.verifyScriptStartedEvent(r)){this.receivedMessageIds.add(r.data.messageId);const s=n;if(n=!1,s&&(t!=null&&t.ignoreFirstEvent))return;this.notifyInvalidated()}};addEventListener("message",o),this.onInvalidated(()=>removeEventListener("message",o))}};Y(ue,"SCRIPT_STARTED_MESSAGE_TYPE",Be("wxt:content-script-started"));let We=ue;function Hn(){}function Ce(e,...t){}const Bn={debug:(...e)=>Ce(console.debug,...e),log:(...e)=>Ce(console.log,...e),warn:(...e)=>Ce(console.warn,...e),error:(...e)=>Ce(console.error,...e)};return(async()=>{try{const{main:e,...t}=On,n=new We("content",t);return await e(n)}catch(e){throw Bn.error('The content script "content" crashed on startup!',e),e}})()}();
content;
