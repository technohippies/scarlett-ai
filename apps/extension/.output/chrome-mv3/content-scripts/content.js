var content=function(){"use strict";var _s=Object.defineProperty;var Es=(me,ce,ue)=>ce in me?_s(me,ce,{enumerable:!0,configurable:!0,writable:!0,value:ue}):me[ce]=ue;var oe=(me,ce,ue)=>Es(me,typeof ce!="symbol"?ce+"":ce,ue);var Ft,Rt;const ce=(e,t)=>e===t,ue=Symbol("solid-proxy"),at=typeof Proxy=="function",Mt=Symbol("solid-track"),$e={equals:ce};let lt=ht;const de=1,Te=2,ct={owned:null,cleanups:null,context:null,owner:null},Ke={};var j=null;let Ue=null,Ot=null,W=null,ne=null,fe=null,Ae=0;function Pe(e,t){const n=W,r=j,s=e.length===0,a=t===void 0?r:t,o=s?ct:{owned:null,cleanups:null,context:a?a.context:null,owner:a},i=s?e:()=>e(()=>ae(()=>ke(o)));j=o,W=null;try{return he(i,!0)}finally{W=n,j=r}}function w(e,t){t=t?Object.assign({},$e,t):$e;const n={value:e,observers:null,observerSlots:null,comparator:t.equals||void 0},r=s=>(typeof s=="function"&&(s=s(n.value)),ft(n,s));return[dt.bind(n),r]}function Nt(e,t,n){const r=_e(e,t,!0,de);ye(r)}function q(e,t,n){const r=_e(e,t,!1,de);ye(r)}function ge(e,t,n){lt=Ht;const r=_e(e,t,!1,de);r.user=!0,fe?fe.push(r):ye(r)}function ie(e,t,n){n=n?Object.assign({},$e,n):$e;const r=_e(e,t,!0,0);return r.observers=null,r.observerSlots=null,r.comparator=n.equals||void 0,ye(r),dt.bind(r)}function jt(e){return e&&typeof e=="object"&&"then"in e}function Kt(e,t,n){let r,s,a;r=!0,s=e,a={};let o=null,i=Ke,l=!1,c="initialValue"in a,d=typeof r=="function"&&ie(r);const u=new Set,[g,k]=(a.storage||w)(a.initialValue),[y,T]=w(void 0),[B,K]=w(void 0,{equals:!1}),[V,O]=w(c?"ready":"unresolved");function P(F,M,X,z){return o===F&&(o=null,z!==void 0&&(c=!0),(F===i||M===i)&&a.onHydrated&&queueMicrotask(()=>a.onHydrated(z,{value:M})),i=Ke,Y(M,X)),M}function Y(F,M){he(()=>{M===void 0&&k(()=>F),O(M!==void 0?"errored":c?"ready":"unresolved"),T(M);for(const X of u.keys())X.decrement();u.clear()},!1)}function U(){const F=qt,M=g(),X=y();if(X!==void 0&&!o)throw X;return W&&W.user,M}function te(F=!0){if(F!==!1&&l)return;l=!1;const M=d?d():r;if(M==null||M===!1){P(o,ae(g));return}let X;const z=i!==Ke?i:ae(()=>{try{return s(M,{value:g(),refetching:F})}catch($){X=$}});if(X!==void 0){P(o,void 0,Le(X),M);return}else if(!jt(z))return P(o,z,void 0,M),z;return o=z,"v"in z?(z.s===1?P(o,z.v,void 0,M):P(o,void 0,Le(z.v),M),z):(l=!0,queueMicrotask(()=>l=!1),he(()=>{O(c?"refreshing":"pending"),K()},!1),z.then($=>P(z,$,void 0,M),$=>P(z,void 0,Le($),M)))}Object.defineProperties(U,{state:{get:()=>V()},error:{get:()=>y()},loading:{get(){const F=V();return F==="pending"||F==="refreshing"}},latest:{get(){if(!c)return U();const F=y();if(F&&!o)throw F;return g()}}});let J=j;return d?Nt(()=>(J=j,te(!1))):te(!1),[U,{refetch:F=>Bt(J,()=>te(F)),mutate:k}]}function ae(e){if(W===null)return e();const t=W;W=null;try{return e()}finally{W=t}}function Ut(e){ge(()=>ae(e))}function xe(e){return j===null||(j.cleanups===null?j.cleanups=[e]:j.cleanups.push(e)),e}function Bt(e,t){const n=j,r=W;j=e,W=null;try{return he(t,!0)}catch(s){ze(s)}finally{j=n,W=r}}const[Is,Ls]=w(!1);function ut(e,t){const n=Symbol("context");return{id:n,Provider:Gt(n),defaultValue:e}}function Be(e){let t;return j&&j.context&&(t=j.context[e.id])!==void 0?t:e.defaultValue}function zt(e){const t=ie(e),n=ie(()=>qe(t()));return n.toArray=()=>{const r=n();return Array.isArray(r)?r:r!=null?[r]:[]},n}let qt;function dt(){if(this.sources&&this.state)if(this.state===de)ye(this);else{const e=ne;ne=null,he(()=>Ie(this),!1),ne=e}if(W){const e=this.observers?this.observers.length:0;W.sources?(W.sources.push(this),W.sourceSlots.push(e)):(W.sources=[this],W.sourceSlots=[e]),this.observers?(this.observers.push(W),this.observerSlots.push(W.sources.length-1)):(this.observers=[W],this.observerSlots=[W.sources.length-1])}return this.value}function ft(e,t,n){let r=e.value;return(!e.comparator||!e.comparator(r,t))&&(e.value=t,e.observers&&e.observers.length&&he(()=>{for(let s=0;s<e.observers.length;s+=1){const a=e.observers[s],o=Ue&&Ue.running;o&&Ue.disposed.has(a),(o?!a.tState:!a.state)&&(a.pure?ne.push(a):fe.push(a),a.observers&&gt(a)),o||(a.state=de)}if(ne.length>1e6)throw ne=[],new Error},!1)),t}function ye(e){if(!e.fn)return;ke(e);const t=Ae;Vt(e,e.value,t)}function Vt(e,t,n){let r;const s=j,a=W;W=j=e;try{r=e.fn(t)}catch(o){return e.pure&&(e.state=de,e.owned&&e.owned.forEach(ke),e.owned=null),e.updatedAt=n+1,ze(o)}finally{W=a,j=s}(!e.updatedAt||e.updatedAt<=n)&&(e.updatedAt!=null&&"observers"in e?ft(e,r):e.value=r,e.updatedAt=n)}function _e(e,t,n,r=de,s){const a={fn:e,state:r,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:j,context:j?j.context:null,pure:n};return j===null||j!==ct&&(j.owned?j.owned.push(a):j.owned=[a]),a}function Ee(e){if(e.state===0)return;if(e.state===Te)return Ie(e);if(e.suspense&&ae(e.suspense.inFallback))return e.suspense.effects.push(e);const t=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<Ae);)e.state&&t.push(e);for(let n=t.length-1;n>=0;n--)if(e=t[n],e.state===de)ye(e);else if(e.state===Te){const r=ne;ne=null,he(()=>Ie(e,t[0]),!1),ne=r}}function he(e,t){if(ne)return e();let n=!1;t||(ne=[]),fe?n=!0:fe=[],Ae++;try{const r=e();return Wt(n),r}catch(r){n||(fe=null),ne=null,ze(r)}}function Wt(e){if(ne&&(ht(ne),ne=null),e)return;const t=fe;fe=null,t.length&&he(()=>lt(t),!1)}function ht(e){for(let t=0;t<e.length;t++)Ee(e[t])}function Ht(e){let t,n=0;for(t=0;t<e.length;t++){const r=e[t];r.user?e[n++]=r:Ee(r)}for(t=0;t<n;t++)Ee(e[t])}function Ie(e,t){e.state=0;for(let n=0;n<e.sources.length;n+=1){const r=e.sources[n];if(r.sources){const s=r.state;s===de?r!==t&&(!r.updatedAt||r.updatedAt<Ae)&&Ee(r):s===Te&&Ie(r,t)}}}function gt(e){for(let t=0;t<e.observers.length;t+=1){const n=e.observers[t];n.state||(n.state=Te,n.pure?ne.push(n):fe.push(n),n.observers&&gt(n))}}function ke(e){let t;if(e.sources)for(;e.sources.length;){const n=e.sources.pop(),r=e.sourceSlots.pop(),s=n.observers;if(s&&s.length){const a=s.pop(),o=n.observerSlots.pop();r<s.length&&(a.sourceSlots[o]=r,s[r]=a,n.observerSlots[r]=o)}}if(e.tOwned){for(t=e.tOwned.length-1;t>=0;t--)ke(e.tOwned[t]);delete e.tOwned}if(e.owned){for(t=e.owned.length-1;t>=0;t--)ke(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}e.state=0}function Le(e){return e instanceof Error?e:new Error(typeof e=="string"?e:"Unknown error",{cause:e})}function ze(e,t=j){throw Le(e)}function qe(e){if(typeof e=="function"&&!e.length)return qe(e());if(Array.isArray(e)){const t=[];for(let n=0;n<e.length;n++){const r=qe(e[n]);Array.isArray(r)?t.push.apply(t,r):t.push(r)}return t}return e}function Gt(e,t){return function(r){let s;return q(()=>s=ae(()=>(j.context={...j.context,[e]:r.value},zt(()=>r.children))),void 0),s}}const Yt=Symbol("fallback");function mt(e){for(let t=0;t<e.length;t++)e[t]()}function Jt(e,t,n={}){let r=[],s=[],a=[],o=0,i=t.length>1?[]:null;return xe(()=>mt(a)),()=>{let l=e()||[],c=l.length,d,u;return l[Mt],ae(()=>{let k,y,T,B,K,V,O,P,Y;if(c===0)o!==0&&(mt(a),a=[],r=[],s=[],o=0,i&&(i=[])),n.fallback&&(r=[Yt],s[0]=Pe(U=>(a[0]=U,n.fallback())),o=1);else if(o===0){for(s=new Array(c),u=0;u<c;u++)r[u]=l[u],s[u]=Pe(g);o=c}else{for(T=new Array(c),B=new Array(c),i&&(K=new Array(c)),V=0,O=Math.min(o,c);V<O&&r[V]===l[V];V++);for(O=o-1,P=c-1;O>=V&&P>=V&&r[O]===l[P];O--,P--)T[P]=s[O],B[P]=a[O],i&&(K[P]=i[O]);for(k=new Map,y=new Array(P+1),u=P;u>=V;u--)Y=l[u],d=k.get(Y),y[u]=d===void 0?-1:d,k.set(Y,u);for(d=V;d<=O;d++)Y=r[d],u=k.get(Y),u!==void 0&&u!==-1?(T[u]=s[d],B[u]=a[d],i&&(K[u]=i[d]),u=y[u],k.set(Y,u)):a[d]();for(u=V;u<c;u++)u in T?(s[u]=T[u],a[u]=B[u],i&&(i[u]=K[u],i[u](u))):s[u]=Pe(g);s=s.slice(0,o=c),r=l.slice(0)}return s});function g(k){if(a[u]=k,i){const[y,T]=w(u);return i[u]=T,t(l[u],y)}return t(l[u])}}}function h(e,t){return ae(()=>e(t||{}))}function Fe(){return!0}const Ve={get(e,t,n){return t===ue?n:e.get(t)},has(e,t){return t===ue?!0:e.has(t)},set:Fe,deleteProperty:Fe,getOwnPropertyDescriptor(e,t){return{configurable:!0,enumerable:!0,get(){return e.get(t)},set:Fe,deleteProperty:Fe}},ownKeys(e){return e.keys()}};function We(e){return(e=typeof e=="function"?e():e)?e:{}}function Xt(){for(let e=0,t=this.length;e<t;++e){const n=this[e]();if(n!==void 0)return n}}function Qt(...e){let t=!1;for(let o=0;o<e.length;o++){const i=e[o];t=t||!!i&&ue in i,e[o]=typeof i=="function"?(t=!0,ie(i)):i}if(at&&t)return new Proxy({get(o){for(let i=e.length-1;i>=0;i--){const l=We(e[i])[o];if(l!==void 0)return l}},has(o){for(let i=e.length-1;i>=0;i--)if(o in We(e[i]))return!0;return!1},keys(){const o=[];for(let i=0;i<e.length;i++)o.push(...Object.keys(We(e[i])));return[...new Set(o)]}},Ve);const n={},r=Object.create(null);for(let o=e.length-1;o>=0;o--){const i=e[o];if(!i)continue;const l=Object.getOwnPropertyNames(i);for(let c=l.length-1;c>=0;c--){const d=l[c];if(d==="__proto__"||d==="constructor")continue;const u=Object.getOwnPropertyDescriptor(i,d);if(!r[d])r[d]=u.get?{enumerable:!0,configurable:!0,get:Xt.bind(n[d]=[u.get.bind(i)])}:u.value!==void 0?u:void 0;else{const g=n[d];g&&(u.get?g.push(u.get.bind(i)):u.value!==void 0&&g.push(()=>u.value))}}}const s={},a=Object.keys(r);for(let o=a.length-1;o>=0;o--){const i=a[o],l=r[i];l&&l.get?Object.defineProperty(s,i,l):s[i]=l?l.value:void 0}return s}function Zt(e,...t){if(at&&ue in e){const s=new Set(t.length>1?t.flat():t[0]),a=t.map(o=>new Proxy({get(i){return o.includes(i)?e[i]:void 0},has(i){return o.includes(i)&&i in e},keys(){return o.filter(i=>i in e)}},Ve));return a.push(new Proxy({get(o){return s.has(o)?void 0:e[o]},has(o){return s.has(o)?!1:o in e},keys(){return Object.keys(e).filter(o=>!s.has(o))}},Ve)),a}const n={},r=t.map(()=>({}));for(const s of Object.getOwnPropertyNames(e)){const a=Object.getOwnPropertyDescriptor(e,s),o=!a.get&&!a.set&&a.enumerable&&a.writable&&a.configurable;let i=!1,l=0;for(const c of t)c.includes(s)&&(i=!0,o?r[l][s]=a.value:Object.defineProperty(r[l],s,a)),++l;i||(o?n[s]=a.value:Object.defineProperty(n,s,a))}return[...r,n]}const en=e=>`Stale read from <${e}>.`;function yt(e){const t="fallback"in e&&{fallback:()=>e.fallback};return ie(Jt(()=>e.each,e.children,t||void 0))}function R(e){const t=e.keyed,n=ie(()=>e.when,void 0,void 0),r=t?n:ie(n,void 0,{equals:(s,a)=>!s==!a});return ie(()=>{const s=r();if(s){const a=e.children;return typeof a=="function"&&a.length>0?ae(()=>a(t?s:()=>{if(!ae(r))throw en("Show");return n()})):a}return e.fallback},void 0,void 0)}const tn=["allowfullscreen","async","autofocus","autoplay","checked","controls","default","disabled","formnovalidate","hidden","indeterminate","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","seamless","selected"],nn=new Set(["className","value","readOnly","noValidate","formNoValidate","isMap","noModule","playsInline",...tn]),rn=new Set(["innerHTML","textContent","innerText","children"]),sn=Object.assign(Object.create(null),{className:"class",htmlFor:"for"}),on=Object.assign(Object.create(null),{class:"className",novalidate:{$:"noValidate",FORM:1},formnovalidate:{$:"formNoValidate",BUTTON:1,INPUT:1},ismap:{$:"isMap",IMG:1},nomodule:{$:"noModule",SCRIPT:1},playsinline:{$:"playsInline",VIDEO:1},readonly:{$:"readOnly",INPUT:1,TEXTAREA:1}});function an(e,t){const n=on[e];return typeof n=="object"?n[t]?n.$:void 0:n}const ln=new Set(["beforeinput","click","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"]),se=e=>ie(()=>e());function cn(e,t,n){let r=n.length,s=t.length,a=r,o=0,i=0,l=t[s-1].nextSibling,c=null;for(;o<s||i<a;){if(t[o]===n[i]){o++,i++;continue}for(;t[s-1]===n[a-1];)s--,a--;if(s===o){const d=a<r?i?n[i-1].nextSibling:n[a-i]:l;for(;i<a;)e.insertBefore(n[i++],d)}else if(a===i)for(;o<s;)(!c||!c.has(t[o]))&&t[o].remove(),o++;else if(t[o]===n[a-1]&&n[i]===t[s-1]){const d=t[--s].nextSibling;e.insertBefore(n[i++],t[o++].nextSibling),e.insertBefore(n[--a],d),t[s]=n[a]}else{if(!c){c=new Map;let u=i;for(;u<a;)c.set(n[u],u++)}const d=c.get(t[o]);if(d!=null)if(i<d&&d<a){let u=o,g=1,k;for(;++u<s&&u<a&&!((k=c.get(t[u]))==null||k!==d+g);)g++;if(g>d-i){const y=t[o];for(;i<d;)e.insertBefore(n[i++],y)}else e.replaceChild(n[i++],t[o++])}else o++;else t[o++].remove()}}}const pt="_$DX_DELEGATE";function un(e,t,n,r={}){let s;return Pe(a=>{s=a,t===document?e():m(t,e(),t.firstChild?null:void 0,n)},r.owner),()=>{s(),t.textContent=""}}function C(e,t,n,r){let s;const a=()=>{const i=document.createElement("template");return i.innerHTML=e,i.content.firstChild},o=()=>(s||(s=a())).cloneNode(!0);return o.cloneNode=o,o}function le(e,t=window.document){const n=t[pt]||(t[pt]=new Set);for(let r=0,s=e.length;r<s;r++){const a=e[r];n.has(a)||(n.add(a),t.addEventListener(a,yn))}}function pe(e,t,n){n==null?e.removeAttribute(t):e.setAttribute(t,n)}function dn(e,t,n){n?e.setAttribute(t,""):e.removeAttribute(t)}function H(e,t){t==null?e.removeAttribute("class"):e.className=t}function He(e,t,n,r){if(r)Array.isArray(n)?(e[`$$${t}`]=n[0],e[`$$${t}Data`]=n[1]):e[`$$${t}`]=n;else if(Array.isArray(n)){const s=n[0];e.addEventListener(t,n[0]=a=>s.call(e,n[1],a))}else e.addEventListener(t,n,typeof n!="function"&&n)}function fn(e,t,n={}){const r=Object.keys(t||{}),s=Object.keys(n);let a,o;for(a=0,o=s.length;a<o;a++){const i=s[a];!i||i==="undefined"||t[i]||(vt(e,i,!1),delete n[i])}for(a=0,o=r.length;a<o;a++){const i=r[a],l=!!t[i];!i||i==="undefined"||n[i]===l||!l||(vt(e,i,!0),n[i]=l)}return n}function bt(e,t,n){if(!t)return n?pe(e,"style"):t;const r=e.style;if(typeof t=="string")return r.cssText=t;typeof n=="string"&&(r.cssText=n=void 0),n||(n={}),t||(t={});let s,a;for(a in n)t[a]==null&&r.removeProperty(a),delete n[a];for(a in t)s=t[a],s!==n[a]&&(r.setProperty(a,s),n[a]=s);return n}function hn(e,t={},n,r){const s={};return q(()=>typeof t.ref=="function"&&wt(t.ref,e)),q(()=>gn(e,t,n,!0,s,!0)),s}function wt(e,t,n){return ae(()=>e(t,n))}function m(e,t,n,r){if(n!==void 0&&!r&&(r=[]),typeof t!="function")return Re(e,t,r,n);q(s=>Re(e,t(),s,n),r)}function gn(e,t,n,r,s={},a=!1){t||(t={});for(const o in s)if(!(o in t)){if(o==="children")continue;s[o]=xt(e,o,null,s[o],n,a,t)}for(const o in t){if(o==="children")continue;const i=t[o];s[o]=xt(e,o,i,s[o],n,a,t)}}function mn(e){return e.toLowerCase().replace(/-([a-z])/g,(t,n)=>n.toUpperCase())}function vt(e,t,n){const r=t.trim().split(/\s+/);for(let s=0,a=r.length;s<a;s++)e.classList.toggle(r[s],n)}function xt(e,t,n,r,s,a,o){let i,l,c,d,u;if(t==="style")return bt(e,n,r);if(t==="classList")return fn(e,n,r);if(n===r)return r;if(t==="ref")a||n(e);else if(t.slice(0,3)==="on:"){const g=t.slice(3);r&&e.removeEventListener(g,r,typeof r!="function"&&r),n&&e.addEventListener(g,n,typeof n!="function"&&n)}else if(t.slice(0,10)==="oncapture:"){const g=t.slice(10);r&&e.removeEventListener(g,r,!0),n&&e.addEventListener(g,n,!0)}else if(t.slice(0,2)==="on"){const g=t.slice(2).toLowerCase(),k=ln.has(g);if(!k&&r){const y=Array.isArray(r)?r[0]:r;e.removeEventListener(g,y)}(k||n)&&(He(e,g,n,k),k&&le([g]))}else t.slice(0,5)==="attr:"?pe(e,t.slice(5),n):t.slice(0,5)==="bool:"?dn(e,t.slice(5),n):(u=t.slice(0,5)==="prop:")||(c=rn.has(t))||(d=an(t,e.tagName))||(l=nn.has(t))||(i=e.nodeName.includes("-")||"is"in o)?(u&&(t=t.slice(5),l=!0),t==="class"||t==="className"?H(e,n):i&&!l&&!c?e[mn(t)]=n:e[d||t]=n):pe(e,sn[t]||t,n);return n}function yn(e){let t=e.target;const n=`$$${e.type}`,r=e.target,s=e.currentTarget,a=l=>Object.defineProperty(e,"target",{configurable:!0,value:l}),o=()=>{const l=t[n];if(l&&!t.disabled){const c=t[`${n}Data`];if(c!==void 0?l.call(t,c,e):l.call(t,e),e.cancelBubble)return}return t.host&&typeof t.host!="string"&&!t.host._$host&&t.contains(e.target)&&a(t.host),!0},i=()=>{for(;o()&&(t=t._$host||t.parentNode||t.host););};if(Object.defineProperty(e,"currentTarget",{configurable:!0,get(){return t||document}}),e.composedPath){const l=e.composedPath();a(l[0]);for(let c=0;c<l.length-2&&(t=l[c],!!o());c++){if(t._$host){t=t._$host,i();break}if(t.parentNode===s)break}}else i();a(r)}function Re(e,t,n,r,s){for(;typeof n=="function";)n=n();if(t===n)return n;const a=typeof t,o=r!==void 0;if(e=o&&n[0]&&n[0].parentNode||e,a==="string"||a==="number"){if(a==="number"&&(t=t.toString(),t===n))return n;if(o){let i=n[0];i&&i.nodeType===3?i.data!==t&&(i.data=t):i=document.createTextNode(t),n=be(e,n,r,i)}else n!==""&&typeof n=="string"?n=e.firstChild.data=t:n=e.textContent=t}else if(t==null||a==="boolean")n=be(e,n,r);else{if(a==="function")return q(()=>{let i=t();for(;typeof i=="function";)i=i();n=Re(e,i,n,r)}),()=>n;if(Array.isArray(t)){const i=[],l=n&&Array.isArray(n);if(Ge(i,t,n,s))return q(()=>n=Re(e,i,n,r,!0)),()=>n;if(i.length===0){if(n=be(e,n,r),o)return n}else l?n.length===0?kt(e,i,r):cn(e,n,i):(n&&be(e),kt(e,i));n=i}else if(t.nodeType){if(Array.isArray(n)){if(o)return n=be(e,n,r,t);be(e,n,null,t)}else n==null||n===""||!e.firstChild?e.appendChild(t):e.replaceChild(t,e.firstChild);n=t}}return n}function Ge(e,t,n,r){let s=!1;for(let a=0,o=t.length;a<o;a++){let i=t[a],l=n&&n[e.length],c;if(!(i==null||i===!0||i===!1))if((c=typeof i)=="object"&&i.nodeType)e.push(i);else if(Array.isArray(i))s=Ge(e,i,l)||s;else if(c==="function")if(r){for(;typeof i=="function";)i=i();s=Ge(e,Array.isArray(i)?i:[i],Array.isArray(l)?l:[l])||s}else e.push(i),s=!0;else{const d=String(i);l&&l.nodeType===3&&l.data===d?e.push(l):e.push(document.createTextNode(d))}}return s}function kt(e,t,n=null){for(let r=0,s=t.length;r<s;r++)e.insertBefore(t[r],n)}function be(e,t,n,r){if(n===void 0)return e.textContent="";const s=r||document.createTextNode("");if(t.length){let a=!1;for(let o=t.length-1;o>=0;o--){const i=t[o];if(s!==i){const l=i.parentNode===e;!a&&!o?l?e.replaceChild(s,i):e.insertBefore(s,n):l&&i.remove()}else a=!0}}else e.insertBefore(s,n);return[s]}const we=(Rt=(Ft=globalThis.browser)==null?void 0:Ft.runtime)!=null&&Rt.id?globalThis.browser:globalThis.chrome;function pn(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Ye,St;function bn(){if(St)return Ye;St=1;var e=/^[a-z](?:[\.0-9_a-z\xB7\xC0-\xD6\xD8-\xF6\xF8-\u037D\u037F-\u1FFF\u200C\u200D\u203F\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])*-(?:[\x2D\.0-9_a-z\xB7\xC0-\xD6\xD8-\xF6\xF8-\u037D\u037F-\u1FFF\u200C\u200D\u203F\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])*$/,t=function(n){return e.test(n)};return Ye=t,Ye}var wn=bn();const vn=pn(wn);var xn=(e,t,n)=>new Promise((r,s)=>{var a=l=>{try{i(n.next(l))}catch(c){s(c)}},o=l=>{try{i(n.throw(l))}catch(c){s(c)}},i=l=>l.done?r(l.value):Promise.resolve(l.value).then(a,o);i((n=n.apply(e,t)).next())});function kn(e){return xn(this,null,function*(){const{name:t,mode:n="closed",css:r,isolateEvents:s=!1}=e;if(!vn(t))throw Error(`"${t}" is not a valid custom element name. It must be two words and kebab-case, with a few exceptions. See spec for more details: https://html.spec.whatwg.org/multipage/custom-elements.html#valid-custom-element-name`);const a=document.createElement(t),o=a.attachShadow({mode:n}),i=document.createElement("html"),l=document.createElement("body"),c=document.createElement("head");if(r){const d=document.createElement("style");"url"in r?d.textContent=yield fetch(r.url).then(u=>u.text()):d.textContent=r.textContent,c.appendChild(d)}return i.appendChild(c),i.appendChild(l),o.appendChild(i),s&&(Array.isArray(s)?s:["keydown","keyup","keypress"]).forEach(u=>{l.addEventListener(u,g=>g.stopPropagation())}),{parentElement:a,shadow:o,isolatedElement:l}})}const Sn=Symbol("null");let Cn=0;class $n extends Map{constructor(){super(),this._objectHashes=new WeakMap,this._symbolHashes=new Map,this._publicKeys=new Map;const[t]=arguments;if(t!=null){if(typeof t[Symbol.iterator]!="function")throw new TypeError(typeof t+" is not iterable (cannot read property Symbol(Symbol.iterator))");for(const[n,r]of t)this.set(n,r)}}_getPublicKeys(t,n=!1){if(!Array.isArray(t))throw new TypeError("The keys parameter must be an array");const r=this._getPrivateKey(t,n);let s;return r&&this._publicKeys.has(r)?s=this._publicKeys.get(r):n&&(s=[...t],this._publicKeys.set(r,s)),{privateKey:r,publicKey:s}}_getPrivateKey(t,n=!1){const r=[];for(let s of t){s===null&&(s=Sn);const a=typeof s=="object"||typeof s=="function"?"_objectHashes":typeof s=="symbol"?"_symbolHashes":!1;if(!a)r.push(s);else if(this[a].has(s))r.push(this[a].get(s));else if(n){const o=`@@mkm-ref-${Cn++}@@`;this[a].set(s,o),r.push(o)}else return!1}return JSON.stringify(r)}set(t,n){const{publicKey:r}=this._getPublicKeys(t,!0);return super.set(r,n)}get(t){const{publicKey:n}=this._getPublicKeys(t);return super.get(n)}has(t){const{publicKey:n}=this._getPublicKeys(t);return super.has(n)}delete(t){const{publicKey:n,privateKey:r}=this._getPublicKeys(t);return!!(n&&super.delete(n)&&this._publicKeys.delete(r))}clear(){super.clear(),this._symbolHashes.clear(),this._publicKeys.clear()}get[Symbol.toStringTag](){return"ManyKeysMap"}get size(){return super.size}}function Je(e){if(e===null||typeof e!="object")return!1;const t=Object.getPrototypeOf(e);return t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||Symbol.iterator in e?!1:Symbol.toStringTag in e?Object.prototype.toString.call(e)==="[object Module]":!0}function Xe(e,t,n=".",r){if(!Je(t))return Xe(e,{},n,r);const s=Object.assign({},t);for(const a in e){if(a==="__proto__"||a==="constructor")continue;const o=e[a];o!=null&&(r&&r(s,a,o,n)||(Array.isArray(o)&&Array.isArray(s[a])?s[a]=[...o,...s[a]]:Je(o)&&Je(s[a])?s[a]=Xe(o,s[a],(n?`${n}.`:"")+a.toString(),r):s[a]=o))}return s}function Tn(e){return(...t)=>t.reduce((n,r)=>Xe(n,r,"",e),{})}const An=Tn(),Ct=e=>e!==null?{isDetected:!0,result:e}:{isDetected:!1},Pn=e=>e===null?{isDetected:!0,result:null}:{isDetected:!1},_n=()=>({target:globalThis.document,unifyProcess:!0,detector:Ct,observeConfigs:{childList:!0,subtree:!0,attributes:!0},signal:void 0,customMatcher:void 0}),En=(e,t)=>An(e,t),Qe=new $n;function In(e){const{defaultOptions:t}=e;return(n,r)=>{const{target:s,unifyProcess:a,observeConfigs:o,detector:i,signal:l,customMatcher:c}=En(r,t),d=[n,s,a,o,i,l,c],u=Qe.get(d);if(a&&u)return u;const g=new Promise(async(k,y)=>{if(l!=null&&l.aborted)return y(l.reason);const T=new MutationObserver(async K=>{for(const V of K){if(l!=null&&l.aborted){T.disconnect();break}const O=await $t({selector:n,target:s,detector:i,customMatcher:c});if(O.isDetected){T.disconnect(),k(O.result);break}}});l==null||l.addEventListener("abort",()=>(T.disconnect(),y(l.reason)),{once:!0});const B=await $t({selector:n,target:s,detector:i,customMatcher:c});if(B.isDetected)return k(B.result);T.observe(s,o)}).finally(()=>{Qe.delete(d)});return Qe.set(d,g),g}}async function $t({target:e,selector:t,detector:n,customMatcher:r}){const s=r?r(t):e.querySelector(t);return await n(s)}const Ln=In({defaultOptions:_n()});function De(e,...t){}const Ze={debug:(...e)=>De(console.debug,...e),log:(...e)=>De(console.log,...e),warn:(...e)=>De(console.warn,...e),error:(...e)=>De(console.error,...e)};function Fn(e,t,n){var r,s;n.position!=="inline"&&(n.zIndex!=null&&(e.style.zIndex=String(n.zIndex)),e.style.overflow="visible",e.style.position="relative",e.style.width="0",e.style.height="0",e.style.display="block",t&&(n.position==="overlay"?(t.style.position="absolute",(r=n.alignment)!=null&&r.startsWith("bottom-")?t.style.bottom="0":t.style.top="0",(s=n.alignment)!=null&&s.endsWith("-right")?t.style.right="0":t.style.left="0"):(t.style.position="fixed",t.style.top="0",t.style.bottom="0",t.style.left="0",t.style.right="0")))}function et(e){if(e.anchor==null)return document.body;let t=typeof e.anchor=="function"?e.anchor():e.anchor;return typeof t=="string"?t.startsWith("/")?document.evaluate(t,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue??void 0:document.querySelector(t)??void 0:t??void 0}function Rn(e,t){var r,s;const n=et(t);if(n==null)throw Error("Failed to mount content script UI: could not find anchor element");switch(t.append){case void 0:case"last":n.append(e);break;case"first":n.prepend(e);break;case"replace":n.replaceWith(e);break;case"after":(r=n.parentElement)==null||r.insertBefore(e,n.nextElementSibling);break;case"before":(s=n.parentElement)==null||s.insertBefore(e,n);break;default:t.append(n,e);break}}function Dn(e,t){let n;const r=()=>{n==null||n.stopAutoMount(),n=void 0},s=()=>{e.mount()},a=e.remove;return{mount:s,remove:()=>{r(),e.remove()},autoMount:l=>{n&&Ze.warn("autoMount is already set."),n=Mn({mount:s,unmount:a,stopAutoMount:r},{...t,...l})}}}function Mn(e,t){const n=new AbortController,r="explicit_stop_auto_mount",s=()=>{var i;n.abort(r),(i=t.onStop)==null||i.call(t)};let a=typeof t.anchor=="function"?t.anchor():t.anchor;if(a instanceof Element)throw Error("autoMount and Element anchor option cannot be combined. Avoid passing `Element` directly or `() => Element` to the anchor.");async function o(i){let l=!!et(t);for(l&&e.mount();!n.signal.aborted;)try{l=!!await Ln(i??"body",{customMatcher:()=>et(t)??null,detector:l?Pn:Ct,signal:n.signal}),l?e.mount():(e.unmount(),t.once&&e.stopAutoMount())}catch(c){if(n.signal.aborted&&n.signal.reason===r)break;throw c}}return o(a),{stopAutoMount:s}}function On(e){let t=e,n="";const r=/(\s*@(property|font-face)[\s\S]*?{[\s\S]*?})/gm;let s;for(;(s=r.exec(e))!==null;)n+=s[1],t=t.replace(s[1],"");return{documentCss:n.trim(),shadowCss:t.trim()}}async function Nn(e,t){var k;const n=Math.random().toString(36).substring(2,15),r=[];if(t.inheritStyles||r.push("/* WXT Shadow Root Reset */ :host{all:initial !important;}"),t.css&&r.push(t.css),((k=e.options)==null?void 0:k.cssInjectionMode)==="ui"){const y=await jn();r.push(y.replaceAll(":root",":host"))}const{shadowCss:s,documentCss:a}=On(r.join(`
`).trim()),{isolatedElement:o,parentElement:i,shadow:l}=await kn({name:t.name,css:{textContent:s},mode:t.mode??"open",isolateEvents:t.isolateEvents});i.setAttribute("data-wxt-shadow-root","");let c;const d=()=>{if(Rn(i,t),Fn(i,l.querySelector("html"),t),a&&!document.querySelector(`style[wxt-shadow-root-document-styles="${n}"]`)){const y=document.createElement("style");y.textContent=a,y.setAttribute("wxt-shadow-root-document-styles",n),(document.head??document.body).append(y)}c=t.onMount(o,l,i)},u=()=>{var T;(T=t.onRemove)==null||T.call(t,c),i.remove();const y=document.querySelector(`style[wxt-shadow-root-document-styles="${n}"]`);for(y==null||y.remove();o.lastChild;)o.removeChild(o.lastChild);c=void 0},g=Dn({mount:d,remove:u},t);return e.onInvalidated(u),{shadow:l,shadowHost:i,uiContainer:o,...g,get mounted(){return c}}}async function jn(){const e=we.runtime.getURL("/content-scripts/content.css");try{return await(await fetch(e)).text()}catch(t){return Ze.warn(`Failed to load styles @ ${e}. Did you forget to import the stylesheet in your entrypoint?`,t),""}}function Rs(e){return e}function Tt(e){var t,n,r="";if(typeof e=="string"||typeof e=="number")r+=e;else if(typeof e=="object")if(Array.isArray(e)){var s=e.length;for(t=0;t<s;t++)e[t]&&(n=Tt(e[t]))&&(r&&(r+=" "),r+=n)}else for(n in e)e[n]&&(r&&(r+=" "),r+=n);return r}function Kn(){for(var e,t,n=0,r="",s=arguments.length;n<s;n++)(e=arguments[n])&&(t=Tt(e))&&(r&&(r+=" "),r+=t);return r}function G(...e){return Kn(e)}le(["click"]);var Un=C('<div><div class="bg-surface rounded-lg p-4 flex flex-col items-center justify-center min-h-[80px]"><div class="text-2xl font-mono font-bold text-purple-500"></div><div class="text-sm text-secondary mt-1">Score</div></div><div class="bg-surface rounded-lg p-4 flex flex-col items-center justify-center min-h-[80px]"><div class="text-2xl font-mono font-bold text-pink-500"></div><div class="text-sm text-secondary mt-1">Rank');const Bn=e=>(()=>{var t=Un(),n=t.firstChild,r=n.firstChild,s=n.nextSibling,a=s.firstChild;return m(r,()=>e.score!==null?e.score:"—"),m(a,()=>e.rank!==null?e.rank:"—"),q(()=>H(t,G("grid grid-cols-[1fr_1fr] gap-2 p-4",e.class))),t})();var zn=C('<svg class="animate-spin h-4 w-4"xmlns=http://www.w3.org/2000/svg fill=none viewBox="0 0 24 24"><circle class=opacity-25 cx=12 cy=12 r=10 stroke=currentColor stroke-width=4></circle><path class=opacity-75 fill=currentColor d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">'),qn=C("<span>"),Vn=C("<button>");const ve=e=>{const[t,n]=Zt(e,["variant","size","fullWidth","loading","leftIcon","rightIcon","children","class","disabled"]),r=()=>t.variant||"primary",s=()=>t.size||"md";return(()=>{var a=Vn();return hn(a,Qt({get disabled(){return t.disabled||t.loading},get class(){return G("inline-flex items-center justify-center font-medium transition-all cursor-pointer outline-none disabled:cursor-not-allowed disabled:opacity-50",{"bg-gradient-primary text-white hover:shadow-lg hover:brightness-110 glow-primary":r()==="primary","bg-surface text-primary border border-default hover:bg-elevated hover:border-strong":r()==="secondary","text-secondary hover:text-primary hover:bg-surface":r()==="ghost","bg-red-600 text-white hover:bg-red-700 hover:shadow-lg":r()==="danger","h-8 px-3 text-sm rounded-md gap-1.5":s()==="sm","h-10 px-4 text-base rounded-lg gap-2":s()==="md","h-12 px-6 text-lg rounded-lg gap-2.5":s()==="lg","w-full":t.fullWidth,"cursor-wait":t.loading},t.class)}},n),!1),m(a,h(R,{get when(){return t.loading},get children(){return zn()}}),null),m(a,h(R,{get when(){return t.leftIcon&&!t.loading},get children(){return t.leftIcon}}),null),m(a,h(R,{get when(){return t.children},get children(){var o=qn();return m(o,()=>t.children),o}}),null),m(a,h(R,{get when(){return t.rightIcon},get children(){return t.rightIcon}}),null),a})()};le(["click","input"]);var Wn=C("<div><div class=space-y-8>"),Hn=C("<div>");const At=e=>{const[t,n]=w(-1);let r;const s=o=>{var i,l;return((l=(i=e.lineScores)==null?void 0:i.find(c=>c.lineIndex===o))==null?void 0:l.score)||null},a=o=>o===null?{}:o>=95?{color:"#ff3838"}:o>=90?{color:"#ff6b6b"}:o>=80?{color:"#ff8787"}:o>=70?{color:"#ffa8a8"}:o>=60?{color:"#ffcece"}:{color:"#ffe0e0"};return ge(()=>{if(!e.currentTime||!e.lyrics.length){n(-1);return}const o=e.currentTime/1e3,l=o+.3;let c=-1;for(let d=0;d<e.lyrics.length;d++){const u=e.lyrics[d];if(!u)continue;const g=u.startTime+u.duration/1e3;if(l>=u.startTime&&l<g){c=d;break}}if(c===-1&&o>0)for(let d=e.lyrics.length-1;d>=0;d--){const u=e.lyrics[d];if(u&&o>=u.startTime){c=d;break}}if(c!==t()){const d=t();Math.abs(c-d)>5&&console.log("[LyricsDisplay] Current line changed:",{from:d,to:c,time:e.currentTime,timeInSeconds:o,jump:Math.abs(c-d)}),d!==-1&&Math.abs(c-d)>10&&console.warn("[LyricsDisplay] Large line jump detected!",{from:d,to:c,fromLine:e.lyrics[d],toLine:e.lyrics[c]}),n(c)}}),ge(()=>{const o=t();if(o===-1||!r||!e.isPlaying)return;const l=r.querySelectorAll("[data-line-index]")[o];if(l){const c=r.clientHeight,d=l.offsetTop,u=l.offsetHeight,g=d-c/2+u/2;r.scrollTo({top:g,behavior:"smooth"})}}),(()=>{var o=Wn(),i=o.firstChild,l=r;return typeof l=="function"?wt(l,o):r=o,m(i,h(yt,{get each(){return e.lyrics},children:(c,d)=>{const u=()=>s(d()),g=()=>a(u());return(()=>{var k=Hn();return m(k,()=>c.text),q(y=>{var T=d(),B=G("text-center","text-2xl leading-relaxed",d()===t()?"opacity-100":"opacity-60"),K=d()===t()&&!u()?"#ffffff":g().color||"#ffffff";return T!==y.e&&pe(k,"data-line-index",y.e=T),B!==y.t&&H(k,y.t=B),K!==y.a&&((y.a=K)!=null?k.style.setProperty("color",K):k.style.removeProperty("color")),y},{e:void 0,t:void 0,a:void 0}),k})()}})),q(()=>H(o,G("lyrics-display overflow-y-auto scroll-smooth","h-full px-6 py-12",e.class))),o})()};le(["click"]);var Gn=C("<div>"),Yn=C('<div class="flex flex-col items-center justify-center py-12 px-6 text-center"><div class="text-6xl mb-4 opacity-30">🎤</div><p class="text-lg text-secondary mb-2">Nobody has completed this song yet!</p><p class="text-sm text-tertiary">Be the first to set a high score'),Jn=C("<div><span>#</span><span></span><span>");const Xn=e=>(()=>{var t=Gn();return m(t,h(R,{get when(){return e.entries.length>0},get fallback(){return Yn()},get children(){return h(yt,{get each(){return e.entries},children:n=>(()=>{var r=Jn(),s=r.firstChild;s.firstChild;var a=s.nextSibling,o=a.nextSibling;return m(s,()=>n.rank,null),m(a,()=>n.username),m(o,()=>n.score.toLocaleString()),q(i=>{var l=G("flex items-center gap-3 px-3 py-2 rounded-lg transition-colors",n.isCurrentUser?"bg-accent-primary/10 border border-accent-primary/20":"bg-surface hover:bg-surface-hover"),c=G("w-8 text-center font-mono font-bold",n.rank<=3?"text-accent-primary":"text-secondary"),d=G("flex-1 truncate",n.isCurrentUser?"text-accent-primary font-medium":"text-primary"),u=G("font-mono font-bold",n.isCurrentUser?"text-accent-primary":"text-primary");return l!==i.e&&H(r,i.e=l),c!==i.t&&H(s,i.t=c),d!==i.a&&H(a,i.a=d),u!==i.o&&H(o,i.o=u),i},{e:void 0,t:void 0,a:void 0,o:void 0}),r})()})}})),q(()=>H(t,G("flex flex-col gap-2 p-4",e.class))),t})();var Qn=C('<div><button><span class="relative z-10">Start</span></button><div class="w-px bg-black/20"></div><button aria-label="Change playback speed"><span class="relative z-10">');const tt=["1x","0.75x","0.5x"],Zn=e=>{const[t,n]=w(0),r=()=>tt[t()],s=a=>{var l;a.stopPropagation();const o=(t()+1)%tt.length;n(o);const i=tt[o];i&&((l=e.onSpeedChange)==null||l.call(e,i))};return(()=>{var a=Qn(),o=a.firstChild,i=o.nextSibling,l=i.nextSibling,c=l.firstChild;return He(o,"click",e.onStart,!0),l.$$click=s,m(c,r),q(d=>{var u=G("relative inline-flex w-full rounded-lg overflow-hidden","bg-gradient-primary text-white shadow-lg","transition-all duration-300",e.class),g=e.disabled,k=G("flex-1 inline-flex items-center justify-center relative overflow-hidden","h-12 px-6 text-lg font-medium","cursor-pointer border-none outline-none","disabled:cursor-not-allowed disabled:opacity-50","hover:bg-white/10 active:bg-white/20"),y=e.disabled,T=G("inline-flex items-center justify-center relative","w-20 text-lg font-medium","cursor-pointer border-none outline-none","disabled:cursor-not-allowed disabled:opacity-50","hover:bg-white/10 active:bg-white/20",'after:content-[""] after:absolute after:inset-0',"after:bg-gradient-to-r after:from-transparent after:via-white/20 after:to-transparent","after:translate-x-[-200%] hover:after:translate-x-[200%]","after:transition-transform after:duration-700");return u!==d.e&&H(a,d.e=u),g!==d.t&&(o.disabled=d.t=g),k!==d.a&&H(o,d.a=k),y!==d.o&&(l.disabled=d.o=y),T!==d.i&&H(l,d.i=T),d},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),a})()};le(["click"]);var nt=C("<div>"),er=C("<button>");const rt=ut(),tr=e=>{var a,o;const[t,n]=w(e.defaultTab||((a=e.tabs[0])==null?void 0:a.id)||"");console.log("[Tabs] Initializing with:",{defaultTab:e.defaultTab,firstTabId:(o=e.tabs[0])==null?void 0:o.id,activeTab:t()});const s={activeTab:t,setActiveTab:i=>{var l;console.log("[Tabs] Tab changed to:",i),n(i),(l=e.onTabChange)==null||l.call(e,i)}};return h(rt.Provider,{value:s,get children(){var i=nt();return m(i,()=>e.children),q(()=>H(i,G("w-full",e.class))),i}})},nr=e=>(()=>{var t=nt();return m(t,()=>e.children),q(()=>H(t,G("inline-flex h-10 items-center justify-center rounded-md bg-surface p-1 text-secondary","w-full",e.class))),t})(),Pt=e=>{const t=Be(rt);if(!t)return console.error("[TabsTrigger] No TabsContext found. TabsTrigger must be used within Tabs component."),null;const n=()=>t.activeTab()===e.value;return(()=>{var r=er();return r.$$click=()=>t.setActiveTab(e.value),m(r,()=>e.children),q(()=>H(r,G("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5","text-sm font-medium ring-offset-base transition-all","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-purple-500 focus-visible:ring-offset-2","disabled:pointer-events-none disabled:opacity-50","flex-1",n()?"bg-base text-primary shadow-sm":"text-secondary hover:text-primary",e.class))),r})()},_t=e=>{const t=Be(rt);if(!t)return console.error("[TabsContent] No TabsContext found. TabsContent must be used within Tabs component."),null;const n=()=>t.activeTab()===e.value;return h(R,{get when(){return n()},get children(){var r=nt();return m(r,()=>e.children),q(()=>H(r,G("mt-2 ring-offset-base","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-purple-500 focus-visible:ring-offset-2",e.class))),r}})};le(["click"]);const Et={fireContainer:"_fireContainer_1dsec_1",fireEmoji:"_fireEmoji_1dsec_12"};var rr=C("<div><div>🔥");const sr=e=>{const[t,n]=w(!1),[r,s]=w(50);let a=-1,o;return ge(()=>{e.lineIndex>a&&e.score>=80&&(s(20+Math.random()*60),n(!0),o&&clearTimeout(o),o=setTimeout(()=>{n(!1)},2e3),a=e.lineIndex)}),xe(()=>{o&&clearTimeout(o)}),h(R,{get when(){return t()},get children(){var i=rr(),l=i.firstChild;return l.style.setProperty("font-size","32px"),q(c=>{var d=G(Et.fireContainer,e.class),u=Et.fireEmoji,g=`${r()}%`;return d!==c.e&&H(i,c.e=d),u!==c.t&&H(l,c.t=u),g!==c.a&&((c.a=g)!=null?l.style.setProperty("left",g):l.style.removeProperty("left")),c},{e:void 0,t:void 0,a:void 0}),i}})};var or=C("<div class=px-4>"),ir=C('<div class="p-4 bg-surface border-t border-subtle">'),ar=C('<div class="flex flex-col h-full"><div class="flex-1 min-h-0 overflow-hidden">'),lr=C('<div class="overflow-y-auto h-full">'),cr=C("<div>"),ur=C('<div class="flex-1 flex flex-col min-h-0"><div class="flex-1 min-h-0 overflow-hidden">');const dr=e=>{const t=()=>{const n=e.lineScores||[];if(n.length===0)return{score:0,lineIndex:-1};const r=n[n.length-1];return{score:(r==null?void 0:r.score)||0,lineIndex:(r==null?void 0:r.lineIndex)||-1}};return(()=>{var n=cr();return m(n,h(R,{get when(){return!e.isPlaying},get children(){return h(Bn,{get score(){return e.score},get rank(){return e.rank}})}}),null),m(n,h(R,{get when(){return!e.isPlaying},get fallback(){return(()=>{var r=ur(),s=r.firstChild;return m(s,h(At,{get lyrics(){return e.lyrics},get currentTime(){return e.currentTime},get isPlaying(){return e.isPlaying},get lineScores(){return e.lineScores}})),r})()},get children(){return h(tr,{tabs:[{id:"lyrics",label:"Lyrics"},{id:"leaderboard",label:"Leaderboard"}],defaultTab:"lyrics",class:"flex-1 flex flex-col min-h-0",get children(){return[(()=>{var r=or();return m(r,h(nr,{get children(){return[h(Pt,{value:"lyrics",children:"Lyrics"}),h(Pt,{value:"leaderboard",children:"Leaderboard"})]}})),r})(),h(_t,{value:"lyrics",class:"flex-1 min-h-0",get children(){var r=ar(),s=r.firstChild;return m(s,h(At,{get lyrics(){return e.lyrics},get currentTime(){return e.currentTime},get isPlaying(){return e.isPlaying},get lineScores(){return e.lineScores}})),m(r,h(R,{get when(){return!e.isPlaying&&e.onStart},get children(){var a=ir();return a.style.setProperty("flex-shrink","0"),m(a,h(Zn,{get onStart(){return e.onStart},get onSpeedChange(){return e.onSpeedChange}})),a}}),null),r}}),h(_t,{value:"leaderboard",class:"flex-1 overflow-hidden",get children(){var r=lr();return m(r,h(Xn,{get entries(){return e.leaderboard}})),r}})]}})}}),null),m(n,h(R,{get when(){return e.isPlaying},get children(){return h(sr,{get score(){return t().score},get lineIndex(){return t().lineIndex}})}}),null),q(()=>H(n,G("flex flex-col h-full bg-base relative",e.class))),n})()},fr=(e,t,n)=>{const r=e[t];return r?typeof r=="function"?r():Promise.resolve(r):new Promise((s,a)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(a.bind(null,new Error("Unknown variable dynamic import: "+t+(t.split("/").length!==n?". Note that variables only represent file names one level deep.":""))))})},It=ut(),hr=e=>{const[t,n]=w(e.defaultLocale||"en"),[r,s]=w();ge(async()=>{const u=t();try{const g=await fr(Object.assign({"./locales/en/index.ts":()=>Promise.resolve().then(()=>Lt),"./locales/zh-CN/index.ts":()=>Promise.resolve().then(()=>$s)}),`./locales/${u}/index.ts`,4);s(g.default)}catch{console.warn(`Failed to load locale ${u}, falling back to English`);const k=await Promise.resolve().then(()=>Lt);s(k.default)}});const a=(u,g)=>{const k=u.split(".");let y=r();for(const T of k)y=y==null?void 0:y[T];return typeof y=="string"&&g?y.replace(/\{\{(\w+)\}\}/g,(T,B)=>String(g[B]||"")):y||u},o=()=>"ltr",i=ie(()=>new Intl.NumberFormat(t())),d={locale:t,setLocale:n,t:a,dir:o,formatNumber:u=>i().format(u),formatDate:(u,g)=>new Intl.DateTimeFormat(t(),g).format(u)};return h(It.Provider,{value:d,get children(){return e.children}})},gr=()=>{const e=Be(It);if(!e)throw new Error("useI18n must be used within I18nProvider");return e};var mr=C('<div class="p-4 bg-surface border-t border-subtle">'),yr=C('<div><div class="flex-1 flex flex-col items-center justify-center p-6"><div class="text-center flex flex-col mb-10"><div class="text-lg text-secondary mb-3 order-1"></div><div class="text-7xl font-mono font-bold text-accent-primary order-2"></div></div><div class="flex gap-12 mb-12"><div class="text-center flex flex-col"><div class="text-lg text-secondary mb-2 order-1">Rank</div><div class="text-3xl font-bold text-primary order-2">#</div></div><div class="text-center flex flex-col"><div class="text-lg text-secondary mb-2 order-1"></div><div class="text-3xl font-bold text-primary order-2"></div></div></div><div class="max-w-md text-center"><p class="text-xl text-primary leading-relaxed">');const pr=e=>{const{t,formatNumber:n}=gr(),r=ie(()=>e.feedbackText?e.feedbackText:e.score>=95?t("karaoke.scoring.perfect"):e.score>=85?t("karaoke.scoring.excellent"):e.score>=70?t("karaoke.scoring.great"):e.score>=50?t("karaoke.scoring.good"):t("karaoke.scoring.keepPracticing"));return(()=>{var s=yr(),a=s.firstChild,o=a.firstChild,i=o.firstChild,l=i.nextSibling,c=o.nextSibling,d=c.firstChild,u=d.firstChild,g=u.nextSibling;g.firstChild;var k=d.nextSibling,y=k.firstChild,T=y.nextSibling,B=c.nextSibling,K=B.firstChild;return m(i,()=>t("karaoke.scoring.score")),m(l,()=>n(e.score)),m(g,()=>n(e.rank),null),m(y,()=>t("common.speed.label")),m(T,()=>e.speed),m(K,r),m(s,h(R,{get when(){return e.onPractice},get children(){var V=mr();return m(V,h(ve,{variant:"primary",size:"lg",fullWidth:!0,get onClick(){return e.onPractice},children:"Practice Errors"})),V}}),null),q(()=>H(s,G("flex flex-col h-full bg-base",e.class))),s})()};function br(e){const[t,n]=w(null),[r,s]=w(null),[,a]=w(null),[o,i]=w(!1),[l,c]=w(null),[d,u]=w(!1),[g,k]=w(null),[y,T]=w([]),[B,K]=w(!1),[V,O]=w([]),P=e==null?void 0:e.sampleRate,Y=async()=>{if(!t()){c(null);try{const v=new AudioContext({sampleRate:P});n(v);const E=await navigator.mediaDevices.getUserMedia({audio:{sampleRate:P,channelCount:1,echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1}});s(E),await v.audioWorklet.addModule(U());const A=new AudioWorkletNode(v,"karaoke-audio-processor",{numberOfInputs:1,numberOfOutputs:0,channelCount:1});A.port.onmessage=_=>{if(_.data.type==="audioData"){const I=new Float32Array(_.data.audioData);g()!==null&&T(f=>[...f,I]),B()&&O(f=>[...f,I])}},a(A);const b=v.createMediaStreamSource(E),p=v.createGain();p.gain.value=1.2,b.connect(p),p.connect(A),i(!0)}catch(v){console.error("[KaraokeAudioProcessor] Failed to initialize:",v),c(v instanceof Error?v:new Error("Unknown audio initialization error")),i(!1)}}},U=()=>{const v=`
      class KaraokeAudioProcessor extends AudioWorkletProcessor {
        constructor() {
          super();
          this.bufferSize = 1024;
          this.rmsHistory = [];
          this.maxHistoryLength = 10;
        }

        process(inputs, outputs, parameters) {
          const input = inputs[0];
          if (input && input[0]) {
            const inputData = input[0];
            
            let sum = 0;
            for (let i = 0; i < inputData.length; i++) {
              sum += inputData[i] * inputData[i];
            }
            const rms = Math.sqrt(sum / inputData.length);
            
            this.rmsHistory.push(rms);
            if (this.rmsHistory.length > this.maxHistoryLength) {
              this.rmsHistory.shift();
            }
            
            const avgRms = this.rmsHistory.reduce((a, b) => a + b, 0) / this.rmsHistory.length;
            
            this.port.postMessage({
              type: 'audioData',
              audioData: inputData,
              rmsLevel: rms,
              avgRmsLevel: avgRms,
              isTooQuiet: avgRms < 0.01,
              isTooLoud: avgRms > 0.3
            });
          }
          return true;
        }
      }
      registerProcessor('karaoke-audio-processor', KaraokeAudioProcessor);
    `,E=new Blob([v],{type:"application/javascript"});return URL.createObjectURL(E)},te=()=>{const v=t();v&&v.state==="suspended"&&v.resume(),u(!0)},J=()=>{const v=t();v&&v.state==="running"&&v.suspend(),u(!1)},F=()=>{const v=r();v&&(v.getTracks().forEach(A=>A.stop()),s(null));const E=t();E&&E.state!=="closed"&&(E.close(),n(null)),a(null),i(!1),u(!1)};xe(F);const M=v=>{k(v),T([]),o()&&!d()&&te()},X=()=>{if(g()===null)return[];const E=y();k(null);const A=[...E];return T([]),A.length,A},z=v=>{if(v.length===0)return null;const E=v.reduce((p,_)=>p+_.length,0),A=new Float32Array(E);let b=0;for(const p of v)A.set(p,b),b+=p.length;return $(A,P)},$=(v,E)=>{const A=v.length,b=new ArrayBuffer(44+A*2),p=new DataView(b),_=(f,S)=>{for(let x=0;x<S.length;x++)p.setUint8(f+x,S.charCodeAt(x))};_(0,"RIFF"),p.setUint32(4,36+A*2,!0),_(8,"WAVE"),_(12,"fmt "),p.setUint32(16,16,!0),p.setUint16(20,1,!0),p.setUint16(22,1,!0),p.setUint32(24,E,!0),p.setUint32(28,E*2,!0),p.setUint16(32,2,!0),p.setUint16(34,16,!0),_(36,"data"),p.setUint32(40,A*2,!0);const I=44;for(let f=0;f<A;f++){const S=Math.max(-1,Math.min(1,v[f]||0));p.setInt16(I+f*2,S*32767,!0)}return new Blob([b],{type:"audio/wav"})};return{isReady:o,error:l,isListening:d,isSessionActive:B,initialize:Y,startListening:te,pauseListening:J,cleanup:F,startRecordingLine:M,stopRecordingLineAndGetRawAudio:X,convertAudioToWavBlob:z,startFullSession:()=>{O([]),K(!0)},stopFullSessionAndGetWav:()=>{K(!1);const v=V(),E=z(v);return O([]),E}}}class wr{constructor(t){oe(this,"baseUrl");oe(this,"getAuthToken");oe(this,"onError");this.baseUrl=t.baseUrl.replace(/\/$/,""),this.getAuthToken=t.getAuthToken,this.onError=t.onError}async request(t,n={}){try{const r={"Content-Type":"application/json",...n.headers||{}};if(this.getAuthToken){const a=await this.getAuthToken();a&&(r.Authorization=`Bearer ${a}`)}const s=await fetch(`${this.baseUrl}${t}`,{...n,headers:r});if(!s.ok){const a=await s.text();throw new Error(`API Error ${s.status}: ${a}`)}return await s.json()}catch(r){throw this.onError&&this.onError(r),r}}async healthCheck(){try{return await this.request("/health"),!0}catch{return!1}}async getDemoToken(){return(await this.request("/auth/demo",{method:"POST"})).token}async getUserCredits(){return this.request("/api/user/credits")}async purchaseCredits(t){return this.request("/api/user/credits/purchase",{method:"POST",body:JSON.stringify(t)})}async getKaraokeData(t){return this.request(`/api/karaoke/${encodeURIComponent(t)}`)}async startKaraokeSession(t){return this.request("/api/karaoke/start",{method:"POST",body:JSON.stringify(t)})}async gradeKaraokeLine(t){return this.request("/api/karaoke/grade",{method:"POST",body:JSON.stringify(t)})}async completeKaraokeSession(t){return this.request("/api/karaoke/complete",{method:"POST",body:JSON.stringify(t)})}async transcribeAudio(t){return this.request("/api/speech-to-text/transcribe",{method:"POST",body:JSON.stringify(t)})}async getPracticeExercises(t,n=10){const r=new URLSearchParams;return t&&r.append("sessionId",t),r.append("limit",n.toString()),this.request(`/api/practice/exercises?${r}`)}async submitPracticeReview(t,n,r){return this.request("/api/practice/review",{method:"POST",body:JSON.stringify({cardId:t,score:n,reviewTime:r})})}async getUserBestScore(t){return this.request(`/api/users/me/songs/${t}/best-score`)}async getSongLeaderboard(t,n=10){return this.request(`/api/songs/${t}/leaderboard?limit=${n}`)}}class vr{constructor(t){this.client=t}async getData(t){return this.client.getKaraokeData(t)}async startSession(t,n,r){const s=await this.client.startKaraokeSession({trackId:t,songData:n,songCatalogId:r});if(!s.success||!s.data)throw new Error(s.error||"Failed to start session");return s.data}async gradeLine(t,n,r,s,a,o){const i=await this.client.gradeKaraokeLine({sessionId:t,lineIndex:n,audioBuffer:r,expectedText:s,startTime:a,endTime:o});if(!i.success||!i.data)throw new Error(i.error||"Failed to grade line");return i.data}async completeSession(t,n){const r=await this.client.completeKaraokeSession({sessionId:t,fullAudioBuffer:n});if(!r.success||!r.data)throw new Error(r.error||"Failed to complete session");return r.data}}class xr{constructor(t){this.client=t}async getExercises(t,n=10){const r=await this.client.getPracticeExercises(t,n);if(!r.success||!r.data)throw new Error(r.error||"Failed to fetch exercises");return r.data}async submitReview(t,n,r=new Date().toISOString()){const s=await this.client.submitPracticeReview(t,n,r);if(!s.success)throw new Error(s.error||"Failed to submit review")}}class kr{constructor(t){this.client=t}async transcribe(t,n,r=!1){const s=await this.client.transcribeAudio({audioBase64:t,expectedText:n,preferDeepgram:r});if(!s.success||!s.data)throw new Error(s.error||"Failed to transcribe audio");return s.data}async transcribeWithRetry(t,n,r=2){let s=null;for(let a=1;a<=r;a++)try{return await this.transcribe(t,n,!1)}catch(o){if(s=o,console.log(`[STT] Attempt ${a}/${r} failed:`,o),a===1)try{return console.log("[STT] Retrying with Deepgram..."),await this.transcribe(t,n,!0)}catch(i){s=i,console.error("[STT] Deepgram also failed:",i)}}throw s||new Error("STT failed after retries")}}class Sr{constructor(t){this.client=t}async getDemoToken(){return this.client.getDemoToken()}async getUserCredits(){return this.client.getUserCredits()}async purchaseCredits(t,n,r="Base",s){return this.client.purchaseCredits({fid:t,credits:n,chain:r,transactionHash:s})}}function Cr(e){const t=new wr(e);return{client:t,karaoke:new vr(t),practice:new xr(t),stt:new kr(t),auth:new Sr(t),healthCheck:()=>t.healthCheck()}}let $r=class{constructor(t="http://localhost:8787"){oe(this,"client");this.client=Cr({baseUrl:t})}async fetchKaraokeData(t){try{return await this.client.karaoke.getData(t)}catch(n){return console.error("[KaraokeApi] Failed to fetch karaoke data:",n),null}}async startSession(t,n,r,s,a){try{return await this.client.karaoke.startSession(t,n,s)}catch(o){return console.error("[KaraokeApi] Failed to start session:",o),null}}async gradeRecording(t,n,r,s,a,o,i,l){try{return await this.client.karaoke.gradeLine(t,n,r,s,a,o)}catch(c){return console.error("[KaraokeApi] Failed to grade recording:",c),null}}async completeSession(t,n){try{return await this.client.karaoke.completeSession(t,n)}catch(r){return console.error("[KaraokeApi] Failed to complete session:",r),null}}async getUserBestScore(t){var n;try{return((n=(await this.client.client.getUserBestScore(t)).data)==null?void 0:n.score)??null}catch(r){return console.error("[KaraokeApi] Failed to get user best score:",r),null}}async getSongLeaderboard(t,n=10){try{return(await this.client.client.getSongLeaderboard(t,n)).data??[]}catch(r){return console.error("[KaraokeApi] Failed to get song leaderboard:",r),[]}}};function Tr(e){return e?e.trim().split(/\s+/).filter(t=>t.length>0).length:0}function Ar(e,t){const n=e[t];if(!n)return{startIndex:t,endIndex:t,expectedText:"",wordCount:0};const r=Tr(n.text||"");return{startIndex:t,endIndex:t,expectedText:n.text||"",wordCount:r}}function Pr(e,t){var a;const{startIndex:n,endIndex:r}=t,s=e[n];if(!s)return 3e3;if(r>n){if(r+1<e.length){const i=e[r+1];if(i)return(i.startTime-s.startTime)*1e3}let o=0;for(let i=n;i<=r;i++)o+=((a=e[i])==null?void 0:a.duration)||3e3;return Math.min(o,8e3)}else{if(n+1<e.length){const o=e[n+1];if(o){const i=(o.startTime-s.startTime)*1e3;return Math.min(Math.max(i,1e3),5e3)}}return Math.min(s.duration||3e3,5e3)}}var _r=C('<div><div class="h-full bg-accent transition-all duration-300 ease-out rounded-r-sm">');const Er=e=>{const t=()=>Math.min(100,Math.max(0,e.current/e.total*100));return(()=>{var n=_r(),r=n.firstChild;return q(s=>{var a=G("w-full h-1.5 bg-highlight",e.class),o=`${t()}%`;return a!==s.e&&H(n,s.e=a),o!==s.t&&((s.t=o)!=null?r.style.setProperty("width",o):r.style.removeProperty("width")),s},{e:void 0,t:void 0}),n})()};var Ir=C('<button aria-label="Open Karaoke"><span>🎤');const Lr=e=>(()=>{var t=Ir(),n=t.firstChild;return t.addEventListener("mouseleave",r=>{r.currentTarget.style.transform="scale(1)"}),t.addEventListener("mouseenter",r=>{r.currentTarget.style.transform="scale(1.1)"}),He(t,"click",e.onClick,!0),t.style.setProperty("position","fixed"),t.style.setProperty("bottom","24px"),t.style.setProperty("right","24px"),t.style.setProperty("width","80px"),t.style.setProperty("height","80px"),t.style.setProperty("border-radius","50%"),t.style.setProperty("background","linear-gradient(135deg, #FF006E 0%, #C13584 100%)"),t.style.setProperty("box-shadow","0 8px 32px rgba(0, 0, 0, 0.3)"),t.style.setProperty("display","flex"),t.style.setProperty("align-items","center"),t.style.setProperty("justify-content","center"),t.style.setProperty("overflow","hidden"),t.style.setProperty("cursor","pointer"),t.style.setProperty("z-index","99999"),t.style.setProperty("border","none"),t.style.setProperty("transition","transform 0.2s ease"),n.style.setProperty("font-size","36px"),t})();le(["click"]);var Fr=C('<header><h1 class="text-lg font-semibold text-primary">');const Rr=e=>h(R,{get when(){return e.title},get children(){var t=Fr(),n=t.firstChild;return m(n,()=>e.title),q(()=>H(t,G("flex items-center justify-center h-14 px-4 bg-transparent",e.class))),t}});var Dr=C('<footer><div class="max-w-2xl mx-auto">');const Mr=e=>(()=>{var t=Dr(),n=t.firstChild;return m(n,h(R,{get when(){return!e.isRecording},get fallback(){return h(ve,{variant:"primary",size:"lg",fullWidth:!0,get onClick(){return e.onStop},get disabled(){return e.isProcessing},children:"Stop"})},get children(){return h(R,{get when(){return e.canSubmit},get fallback(){return h(ve,{variant:"primary",size:"lg",fullWidth:!0,get onClick(){return e.onRecord},get disabled(){return e.isProcessing},children:"Record"})},get children(){return h(ve,{variant:"primary",size:"lg",fullWidth:!0,get onClick(){return e.onSubmit},get disabled(){return e.isProcessing},get children(){return e.isProcessing?"Processing...":"Submit"}})}})}})),q(()=>H(t,G("border-t border-gray-700 bg-surface p-6",e.class))),t})();var Or=C('<svg data-phosphor-icon=check-circle aria-hidden=true width=1em height=1em pointer-events=none display=inline-block xmlns=http://www.w3.org/2000/svg fill=currentColor viewBox="0 0 256 256"><path d="M128 24a104 104 0 1 0 104 104A104.11 104.11 0 0 0 128 24m45.66 85.66-56 56a8 8 0 0 1-11.32 0l-24-24a8 8 0 0 1 11.32-11.32L112 148.69l50.34-50.35a8 8 0 0 1 11.32 11.32">');const Nr=e=>(()=>{var t=Or();return q(()=>pe(t,"class",e.class)),t})();var jr=C('<svg data-phosphor-icon=x-circle aria-hidden=true width=1em height=1em pointer-events=none display=inline-block xmlns=http://www.w3.org/2000/svg fill=currentColor viewBox="0 0 256 256"><path d="M128 24a104 104 0 1 0 104 104A104.11 104.11 0 0 0 128 24m37.66 130.34a8 8 0 0 1-11.32 11.32L128 139.31l-26.34 26.35a8 8 0 0 1-11.32-11.32L116.69 128l-26.35-26.34a8 8 0 0 1 11.32-11.32L128 116.69l26.34-26.35a8 8 0 0 1 11.32 11.32L139.31 128Z">');const Kr=e=>(()=>{var t=jr();return q(()=>pe(t,"class",e.class)),t})();var Ur=C('<div class="border-t border-gray-700 bg-surface p-6"><div class="max-w-2xl mx-auto">'),Br=C('<p class="text-base text-secondary mt-1">'),zr=C('<div class="flex items-center gap-4"><div><p class="text-2xl font-bold">'),qr=C('<div class="flex items-center justify-between gap-6">');const Vr=e=>(()=>{var t=Ur(),n=t.firstChild;return m(n,h(R,{get when(){return e.mode==="check"},get fallback(){return(()=>{var r=qr();return m(r,h(R,{get when(){return e.isCorrect!==void 0},get children(){var s=zr(),a=s.firstChild,o=a.firstChild;return m(s,h(R,{get when(){return e.isCorrect},get fallback(){return h(Kr,{style:"color: #ef4444;",class:"w-16 h-16 flex-shrink-0"})},get children(){return h(Nr,{style:"color: #22c55e;",class:"w-16 h-16 flex-shrink-0"})}}),a),m(o,()=>e.isCorrect?"Correct!":"Incorrect"),m(a,h(R,{get when(){return e.feedbackText&&!e.isCorrect},get children(){var i=Br();return m(i,()=>e.feedbackText),i}}),null),q(i=>bt(o,`color: ${e.isCorrect?"#22c55e":"#ef4444"};`,i)),s}}),null),m(r,h(ve,{variant:"primary",size:"lg",get onClick(){return e.onContinue},class:"min-w-[180px]",get children(){return e.continueLabel||"Next"}}),null),r})()},get children(){return h(ve,{variant:"primary",size:"lg",fullWidth:!0,get onClick(){return e.onCheck},children:"Check"})}})),t})();var Wr=C('<div><div class="flex-grow overflow-y-auto flex flex-col pb-24"><div class="w-full max-w-2xl mx-auto px-4 py-8">'),Hr=C('<p class="text-lg text-muted-foreground mb-4 text-left">');const Gr=e=>(()=>{var t=Wr(),n=t.firstChild,r=n.firstChild;return m(r,(()=>{var s=se(()=>!!e.instructionText);return()=>s()&&(()=>{var a=Hr();return m(a,()=>e.instructionText),a})()})(),null),m(r,()=>e.children,null),q(()=>H(t,G("flex flex-col h-full bg-base text-primary",e.class))),t})();var Yr=C('<div class=mt-8><p class="text-lg text-muted-foreground mb-4">You said:</p><p class="text-2xl text-left leading-relaxed">'),Jr=C('<div><p class="text-2xl text-left leading-relaxed">');const Xr=e=>(()=>{var t=Jr(),n=t.firstChild;return m(n,()=>e.prompt),m(t,h(R,{get when(){return e.userTranscript},get children(){var r=Yr(),s=r.firstChild,a=s.nextSibling;return m(a,()=>e.userTranscript),r}}),null),q(()=>H(t,G("space-y-4",e.class))),t})();var Qr=C('<div class="h-full bg-base flex flex-col">'),Zr=C('<div class="flex-1 flex items-center justify-center"><div class=text-center><div class="animate-spin rounded-full h-12 w-12 border-b-2 border-accent-primary mx-auto mb-4"></div><p class=text-muted-foreground>Loading exercises...'),es=C('<div class="flex-1 flex items-center justify-center p-8"><div class="text-center max-w-md"><p class="text-lg text-muted-foreground mb-4">No practice exercises available yet.</p><p class="text-sm text-muted-foreground">Complete karaoke sessions with errors to generate personalized exercises!'),ts=C("<main class=flex-1>");const ns=e=>{const[t,n]=w(0),[r,s]=w(!1),[a,o]=w(!1),[i,l]=w(""),[c,d]=w(null),[u,g]=w(null),[k,y]=w([]),[T,B]=w(!1),[K,V]=w(!1),O=()=>e.apiBaseUrl||"http://localhost:8787",[P]=Kt(async()=>{try{const $=e.sessionId?`${O()}/api/practice/exercises?limit=10&sessionId=${e.sessionId}`:`${O()}/api/practice/exercises?limit=10`,Z={};e.authToken&&(Z.Authorization=`Bearer ${e.authToken}`);const N=await fetch($,{headers:Z});if(!N.ok){const E=await N.text();throw console.error("[PracticeExerciseView] API error:",N.status,E),new Error("Failed to fetch exercises")}const v=await N.json();return v.data&&v.data.exercises?v.data.exercises:[]}catch($){return console.error("[PracticeExerciseView] Failed to fetch:",$),[]}});ge(()=>{P()});const Y=async()=>{l(""),d(null),y([]);try{const $=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}}),Z=MediaRecorder.isTypeSupported("audio/webm;codecs=opus")?"audio/webm;codecs=opus":"audio/webm",N=new MediaRecorder($,{mimeType:Z}),v=[];N.ondataavailable=E=>{E.data.size>0&&v.push(E.data)},N.onstop=async()=>{const E=new Blob(v,{type:Z});await U(E),$.getTracks().forEach(A=>A.stop())},N.start(),g(N),s(!0)}catch($){console.error("[PracticeExerciseView] Failed to start recording:",$),s(!1)}},U=async $=>{var Z,N;try{o(!0);const v=new FileReader,E=await new Promise(I=>{v.onloadend=()=>{const f=v.result;I(f.split(",")[1])},v.readAsDataURL($)});let A,b=0;const p=2,_={"Content-Type":"application/json"};for(e.authToken&&(_.Authorization=`Bearer ${e.authToken}`);b<p;){try{if(A=await fetch(`${O()}/api/speech-to-text/transcribe`,{method:"POST",headers:_,body:JSON.stringify({audioBase64:E,expectedText:(Z=z())==null?void 0:Z.full_line,preferDeepgram:b>0})}),A.ok)break}catch(I){console.error(`[PracticeExerciseView] STT attempt ${b+1} failed:`,I)}b++,b<p&&await new Promise(I=>setTimeout(I,500))}if(A&&A.ok){const I=await A.json();l(I.data.transcript);const f=J(((N=z())==null?void 0:N.full_line)||"",I.data.transcript);d(f),await F(f)}else throw new Error("STT failed after retries")}catch(v){console.error("[PracticeExerciseView] Failed to process recording:",v)}finally{o(!1)}},te=()=>{const $=u();$&&$.state!=="inactive"&&($.stop(),s(!1))},J=($,Z)=>{const N=$.toLowerCase().split(/\s+/),v=Z.toLowerCase().split(/\s+/);let E=0;for(let A=0;A<N.length;A++)v[A]===N[A]&&E++;return Math.round(E/N.length*100)},F=async $=>{var E;const Z=(E=P())==null?void 0:E[t()],N=k(),v=N.length>0?new Blob(N,{type:"audio/webm"}):null;if(V($>=80),B(!0),Z&&Z.card_ids.length>0&&v)try{const A=new FileReader,b=await new Promise(I=>{A.onloadend=()=>{const f=A.result;I(f.split(",")[1])},A.readAsDataURL(v)}),p={"Content-Type":"application/json"};e.authToken&&(p.Authorization=`Bearer ${e.authToken}`),(await fetch(`${O()}/api/practice/review`,{method:"POST",headers:p,body:JSON.stringify({exerciseId:Z.id,audioBase64:b,cardScores:Z.card_ids.map(I=>({cardId:I,score:$}))})})).ok}catch(A){console.error("[PracticeExerciseView] Failed to submit review:",A)}},M=async()=>{const $=c();$!==null&&await F($)},X=()=>{var $;t()<((($=P())==null?void 0:$.length)||0)-1?(n(t()+1),l(""),d(null),y([]),B(!1),V(!1)):e.onBack()},z=()=>{var $;return($=P())==null?void 0:$[t()]};return(()=>{var $=Qr();return m($,h(R,{get when(){return!P.loading},get fallback(){return Zr()},get children(){return h(R,{get when(){return(P()||[]).length>0},get fallback(){return es()},get children(){return h(R,{get when(){return z()},children:Z=>[h(Er,{get current(){return t()+1},get total(){var N;return((N=P())==null?void 0:N.length)||0}}),h(Rr,{get title(){return e.headerTitle||""},get onExit(){return e.onBack}}),(()=>{var N=ts();return m(N,h(Gr,{instructionText:"Read aloud:",get children(){return h(Xr,{get prompt(){return Z().full_line},get userTranscript(){return i()}})}})),N})(),h(R,{get when(){return T()},get fallback(){return h(Mr,{get isRecording(){return r()},get isProcessing(){return a()},get canSubmit(){return i().trim().length>0},onRecord:Y,onStop:te,onSubmit:M})},get children(){return h(Vr,{mode:"feedback",get isCorrect(){return K()},onContinue:X})}})]})}})}})),$})()};le(["click"]),le(["click"]);function rs(e){const[t,n]=w(!1),[r,s]=w(0),[a,o]=w(0),[i,l]=w(null),[c,d]=w(null),[u,g]=w([]),[k,y]=w(null),[T,B]=w(!1),[K,V]=w(e.audioElement),[O,P]=w(new Set),[Y,U]=w("1x");let te=null,J=null;const F=br({sampleRate:16e3}),M=new $r(e.apiUrl),X=f=>{switch(f){case"0.5x":return .5;case"0.75x":return .75;case"1x":return 1;default:return 1}},z=f=>{switch(f){case"0.5x":return 1.2;case"0.75x":return 1.1;case"1x":return 1;default:return 1}},$=f=>{console.log("[KaraokeSession] handleSpeedChange called with:",f),U(f);const S=K();if(S){const x=X(f);console.log("[KaraokeSession] Setting audio playback rate to:",x,"audio paused:",S.paused),S.playbackRate=x}else console.log("[KaraokeSession] No audio element available yet")},Z=async()=>{try{await F.initialize()}catch(S){console.error("[KaraokeSession] Failed to initialize audio:",S)}if(e.trackId&&e.songData)try{const S=await M.startSession(e.trackId,{title:e.songData.title,artist:e.songData.artist,duration:e.songData.duration,difficulty:"intermediate"},void 0,e.songCatalogId,Y());S?d(S.id):console.error("[KaraokeSession] Failed to create session")}catch(S){console.error("[KaraokeSession] Failed to create session:",S)}l(3);const f=setInterval(()=>{const S=i();S!==null&&S>1?l(S-1):(clearInterval(f),l(null),N())},1e3)},N=()=>{n(!0),F.startFullSession();const f=K()||e.audioElement;if(f){const S=X(Y());console.log("[KaraokeSession] Starting playback with speed:",Y(),"rate:",S),f.playbackRate=S,f.play().catch(console.error),te=setInterval(()=>{const D=f.currentTime*1e3;s(D),v(D)},100),f.addEventListener("ended",p)}},v=f=>{if(T()||!e.lyrics.length)return;const S=O();for(let x=0;x<e.lyrics.length;x++){if(S.has(x))continue;const D=Ar(e.lyrics,x),L=e.lyrics[D.startIndex];if(L&&L.startTime!==void 0){const Q=L.startTime*1e3-1e3,re=L.startTime*1e3;if(f>=Q&&f<re+500){P(ee=>new Set(ee).add(D.startIndex)),E(D);break}}x=D.endIndex}},E=async f=>{if(f.startIndex>=5){p();return}y(f),B(!0),F.startRecordingLine(f.startIndex);const S=Pr(e.lyrics,f),x=1/X(Y()),D=S*x;J=setTimeout(()=>{A()},D)},A=async()=>{const f=k();if(!f)return;B(!1);const S=F.stopRecordingLineAndGetRawAudio(),x=F.convertAudioToWavBlob(S);if(x&&x.size>1e3&&c()){const D=new FileReader;D.onloadend=async()=>{var Q;const L=(Q=D.result)==null?void 0:Q.toString().split(",")[1];L&&L.length>100&&await b(f,L)},D.readAsDataURL(x)}else x&&x.size<=1e3?g(D=>[...D,{lineIndex:f.startIndex,score:50,transcription:"",feedback:"Recording too short"}]):x&&c();y(null),J&&(clearTimeout(J),J=null)},b=async(f,S)=>{var D,L,Q;const x=c();if(x)try{const re=await M.gradeRecording(x,f.startIndex,S,f.expectedText,((D=e.lyrics[f.startIndex])==null?void 0:D.startTime)||0,(((L=e.lyrics[f.endIndex])==null?void 0:L.startTime)||0)+(((Q=e.lyrics[f.endIndex])==null?void 0:Q.duration)||0)/1e3,void 0,Y());if(re){const ee=z(Y()),Ne=Math.min(100,Math.round(re.score*ee)),Ce={lineIndex:f.startIndex,score:Ne,transcription:re.transcript||"",feedback:re.feedback};g(je=>[...je,Ce]),o(je=>{const Dt=[...u(),Ce],Ts=Dt.reduce((As,Ps)=>As+Ps.score,0)/Dt.length;return Math.round(Ts)})}else g(ee=>[...ee,{lineIndex:f.startIndex,score:50,transcription:"",feedback:"Failed to grade recording"}])}catch(re){console.error("[KaraokeSession] Failed to grade chunk:",re)}},p=async()=>{var L;n(!1),te&&clearInterval(te);const f=K()||e.audioElement;f&&!f.paused&&f.pause(),T()&&await A();const S={score:-1,accuracy:0,totalLines:u().length,perfectLines:0,goodLines:0,needsWorkLines:0,sessionId:c()||void 0,isLoading:!0};(L=e.onComplete)==null||L.call(e,S);const x=F.stopFullSessionAndGetWav(),D=c();if(D&&x&&x.size>1e3)try{const Q=new FileReader;Q.onloadend=async()=>{var Ne,Ce;const re=(Ne=Q.result)==null?void 0:Ne.toString().split(",")[1],ee=await M.completeSession(D,re);if(ee){const je={score:ee.finalScore,accuracy:ee.accuracy,totalLines:ee.totalLines,perfectLines:ee.perfectLines,goodLines:ee.goodLines,needsWorkLines:ee.needsWorkLines,sessionId:D};(Ce=e.onComplete)==null||Ce.call(e,je)}else _()},Q.readAsDataURL(x)}catch(Q){console.error("[KaraokeSession] Failed to complete session:",Q),_()}else _()},_=()=>{var D;const f=u(),S=f.length>0?f.reduce((L,Q)=>L+Q.score,0)/f.length:0,x={score:Math.round(S),accuracy:Math.round(S),totalLines:f.length,perfectLines:f.filter(L=>L.score>=90).length,goodLines:f.filter(L=>L.score>=70&&L.score<90).length,needsWorkLines:f.filter(L=>L.score<70).length,sessionId:c()||void 0};(D=e.onComplete)==null||D.call(e,x)},I=()=>{n(!1),l(null),B(!1),y(null),P(new Set),te&&(clearInterval(te),te=null),J&&(clearTimeout(J),J=null);const f=K()||e.audioElement;f&&(f.pause(),f.currentTime=0,f.removeEventListener("ended",p)),F.cleanup()};return xe(()=>{I()}),{isPlaying:t,currentTime:r,score:a,countdown:i,sessionId:c,lineScores:u,isRecording:T,currentChunk:k,playbackSpeed:Y,startSession:Z,stopSession:I,handleSpeedChange:$,audioProcessor:F,setAudioElement:f=>{V(f),f&&(f.playbackRate=X(Y()))}}}class ss{detectCurrentTrack(){return window.location.href.includes("sc.maid.zone")?this.detectSoundCloudTrack():null}detectSoundCloudTrack(){var t,n;try{const r=window.location.pathname.split("/").filter(Boolean);if(r.length<2)return null;const s=r[0],a=r[1];let o="";const i=document.querySelectorAll("h1");for(const d of i)if(!((t=d.textContent)!=null&&t.toLowerCase().includes("soundcloak"))&&(o=((n=d.textContent)==null?void 0:n.trim())||"",o))break;o||(o=a.replace(/-/g," "));let l="";const c=document.querySelector("a.listing .meta h3");if(c&&c.textContent&&(l=c.textContent.trim()),!l){const u=document.title.match(/by\s+(.+?)\s*~/);u&&(l=u[1].trim())}return l||(l=s.replace(/-/g," ").replace(/_/g," ")),console.log("[TrackDetector] Detected track:",{title:o,artist:l,artistPath:s,trackSlug:a}),{trackId:`${s}/${a}`,title:o,artist:l,platform:"soundcloud",url:window.location.href}}catch(r){return console.error("[TrackDetector] Error detecting SoundCloud track:",r),null}}watchForChanges(t){let n=window.location.href,r=this.detectCurrentTrack();t(r);const s=()=>{const c=window.location.href;if(c!==n){n=c;const d=this.detectCurrentTrack();(!r||!d||r.trackId!==d.trackId)&&(r=d,t(d))}},a=setInterval(s,1e3),o=()=>{setTimeout(s,100)};window.addEventListener("popstate",o);const i=history.pushState,l=history.replaceState;return history.pushState=function(...c){i.apply(history,c),o()},history.replaceState=function(...c){l.apply(history,c),o()},()=>{clearInterval(a),window.removeEventListener("popstate",o),history.pushState=i,history.replaceState=l}}}const os=new ss;async function is(){return(await we.storage.local.get("authToken")).authToken||null}class as{constructor(){oe(this,"baseUrl");this.baseUrl="http://localhost:8787/api"}async getKaraokeData(t,n,r){try{const s=new URLSearchParams;n&&s.set("title",n),r&&s.set("artist",r);const a=`${this.baseUrl}/karaoke/${encodeURIComponent(t)}${s.toString()?"?"+s.toString():""}`;console.log("[KaraokeApi] Fetching karaoke data:",a);const o=await fetch(a,{method:"GET"});if(!o.ok)return console.error("[KaraokeApi] Failed to fetch karaoke data:",o.status),null;const i=await o.json();return console.log("[KaraokeApi] Received karaoke data:",i),i.error?(console.log("[KaraokeApi] Server error (but API is reachable):",i.error),{success:!1,has_karaoke:!1,error:i.error,track_id:t,api_connected:!0}):i}catch(s){return console.error("[KaraokeApi] Error fetching karaoke data:",s),null}}async startSession(t,n){try{const r=await fetch(`${this.baseUrl}/karaoke/start`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({trackId:t,songData:n})});return r.ok?(await r.json()).session:(console.error("[KaraokeApi] Failed to start session:",r.status),null)}catch(r){return console.error("[KaraokeApi] Error starting session:",r),null}}async testConnection(){try{return(await fetch(`${this.baseUrl.replace("/api","")}/health`)).ok}catch(t){return console.error("[KaraokeApi] Connection test failed:",t),!1}}}const ls=new as,cs=e=>h(ns,{get sessionId(){return e.sessionId},get onBack(){return e.onBack}});var us=C('<button class="w-10 h-10 flex items-center justify-center rounded-lg transition-colors hover:bg-white/10"aria-label="Close Practice"><svg width=20 height=20 viewBox="0 0 20 20"fill=none xmlns=http://www.w3.org/2000/svg><path d="M15 5L5 15M5 5L15 15"stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round>'),ds=C('<div class="h-full overflow-y-auto">'),fs=C('<div><div class="h-full bg-surface rounded-2xl overflow-hidden flex flex-col"><div class="flex items-center justify-end p-2 bg-surface border-b border-subtle"><div class="flex items-center gap-2"><button class="w-10 h-10 flex items-center justify-center rounded-lg transition-colors hover:bg-white/10"aria-label=Minimize><svg width=24 height=24 viewBox="0 0 24 24"fill=none xmlns=http://www.w3.org/2000/svg><path d="M6 12h12"stroke=currentColor stroke-width=3 stroke-linecap=round></path></svg></button></div></div><div class="flex-1 min-h-0 overflow-hidden">'),hs=C("<div>"),gs=C('<div class="absolute inset-0 bg-black/80 flex items-center justify-center z-50"><div class=text-center><div class="text-8xl font-bold text-white animate-pulse"></div><p class="text-xl text-white/80 mt-4">Get ready!'),ms=C('<div class="h-full flex flex-col"><div class="flex-1 min-h-0 overflow-hidden">'),ys=C('<div class="flex items-center justify-center h-full bg-base"><div class=text-center><div class="animate-spin rounded-full h-12 w-12 border-b-2 border-accent-primary mx-auto mb-4"></div><p class=text-secondary>Loading lyrics...'),ps=C('<div class="flex items-center justify-center h-full p-8"><div class=text-center><p class="text-lg text-secondary mb-2">No lyrics available</p><p class="text-sm text-tertiary">Try a different song'),bs=C('<div class="h-full flex flex-col">'),ws=C('<div class="flex items-center justify-center h-full bg-base"><div class=text-center><div class="animate-spin rounded-full h-16 w-16 border-b-2 border-accent-primary mx-auto mb-4"></div><p class="text-lg text-secondary">Calculating your final score...</p><p class="text-sm text-tertiary mt-2">Analyzing full performance');const vs=()=>{console.log("[ContentApp] Rendering ContentApp component");const[e,t]=w(null),[n,r]=w(null),[s,a]=w(!1),[o,i]=w(null),[l,c]=w(!1),[d,u]=w(!1),[g,k]=w(!1),[y,T]=w(null),[B,K]=w(!1),[V,O]=w(0),[P,Y]=w(null),[U,te]=w(null),[J,F]=w(null),[M,X]=w(!1),[z,$]=w("1x");Ut(async()=>{console.log("[ContentApp] Loading auth token");const b=await is();b?(r(b),console.log("[ContentApp] Auth token loaded")):(console.log("[ContentApp] No auth token found, using demo token"),r("scarlett_demo_token_123"));const p=os.watchForChanges(_=>{console.log("[ContentApp] Track changed:",_),t(_),_&&(a(!0),Z(_))});xe(p)});const Z=async b=>{console.log("[ContentApp] Fetching karaoke data for track:",b),c(!0);try{const p=await ls.getKaraokeData(b.trackId,b.title,b.artist);console.log("[ContentApp] Karaoke data loaded:",p),i(p)}catch(p){console.error("[ContentApp] Failed to fetch karaoke data:",p)}finally{c(!1)}},N=async()=>{var _,I;console.log("[ContentApp] Start karaoke session"),u(!0);const b=o();P();const p=e();if(b&&p&&((_=b.lyrics)!=null&&_.lines)){console.log("[ContentApp] Creating karaoke session with audio capture",{trackId:p.id,trackTitle:p.title,songData:b.song,hasLyrics:!!((I=b.lyrics)!=null&&I.lines)});const f=rs({lyrics:b.lyrics.lines,trackId:p.trackId,songData:b.song?{title:b.song.title,artist:b.song.artist,album:b.song.album,duration:b.song.duration}:{title:p.title,artist:p.artist},songCatalogId:b.song_catalog_id,audioElement:void 0,apiUrl:"http://localhost:8787/api",onComplete:S=>{console.log("[ContentApp] Karaoke session completed:",S),u(!1),K(!1),F(S);const x=P();x&&x.pause()}});console.log("[ContentApp] Applying selected speed to new session:",z()),f.handleSpeedChange(z()),te(f),await f.startSession(),ge(()=>{f.countdown()===null&&f.isPlaying()&&!B()&&(console.log("[ContentApp] Countdown finished, starting audio playback"),v());const S=P();S&&f&&(console.log("[ContentApp] Setting audio element on new session"),f.setAudioElement(S))})}else{console.log("[ContentApp] Fallback to simple countdown"),T(3);const f=setInterval(()=>{const S=y();S!==null&&S>1?T(S-1):(clearInterval(f),T(null),v())},1e3)}},v=()=>{console.log("[ContentApp] Starting audio playback"),K(!0);const b=document.querySelectorAll("audio");if(console.log("[ContentApp] Found audio elements:",b.length),b.length>0){const p=b[0];console.log("[ContentApp] Audio element:",{src:p.src,paused:p.paused,duration:p.duration,currentTime:p.currentTime}),Y(p);const _=U();_&&(console.log("[ContentApp] Setting audio element on karaoke session"),_.setAudioElement(p),_.audioProcessor.isReady()||(console.log("[ContentApp] Initializing audio processor for session"),_.audioProcessor.initialize().catch(console.error))),p.play().then(()=>{console.log("[ContentApp] Audio started playing successfully")}).catch(f=>{console.error("[ContentApp] Failed to play audio:",f),console.log("[ContentApp] Attempting to click play button...");const S=document.querySelector('button[title*="Play"], button[aria-label*="Play"], .playControl, .playButton, [class*="play-button"]');S&&(console.log("[ContentApp] Found play button, clicking it"),S.click())});const I=()=>{O(p.currentTime)};p.addEventListener("timeupdate",I),p.addEventListener("ended",()=>{K(!1),p.removeEventListener("timeupdate",I)})}else{console.log("[ContentApp] No audio elements found, trying SoundCloud-specific approach");const p=document.querySelector('.playControl, .sc-button-play, button[title*="Play"]');p&&(console.log("[ContentApp] Found SoundCloud play button, clicking it"),p.click(),setTimeout(()=>{const _=document.querySelectorAll("audio");if(_.length>0){console.log("[ContentApp] Found audio element after clicking play");const I=_[0];Y(I);const f=()=>{O(I.currentTime)};I.addEventListener("timeupdate",f),I.addEventListener("ended",()=>{K(!1),I.removeEventListener("timeupdate",f)})}},500))}},E=()=>{console.log("[ContentApp] Minimize karaoke widget"),k(!0)},A=()=>{console.log("[ContentApp] Restore karaoke widget"),k(!1)};return console.log("[ContentApp] Render state:",{showKaraoke:s(),currentTrack:e(),karaokeData:o(),loading:l()}),[h(R,{get when(){return se(()=>!!(s()&&e()))()&&g()},get children(){return h(Lr,{onClick:A})}}),h(R,{get when(){return se(()=>!!(s()&&e()))()&&!g()},get fallback(){return(()=>{var b=hs();return b.style.setProperty("display","none"),m(b,()=>console.log("[ContentApp] Not showing - showKaraoke:",s(),"currentTrack:",e())),b})()},get children(){var b=fs(),p=b.firstChild,_=p.firstChild,I=_.firstChild,f=I.firstChild,S=_.nextSibling;return b.style.setProperty("position","fixed"),b.style.setProperty("top","20px"),b.style.setProperty("right","20px"),b.style.setProperty("bottom","20px"),b.style.setProperty("width","480px"),b.style.setProperty("z-index","99999"),b.style.setProperty("overflow","hidden"),b.style.setProperty("border-radius","16px"),b.style.setProperty("box-shadow","0 25px 50px -12px rgba(0, 0, 0, 0.6)"),b.style.setProperty("display","flex"),b.style.setProperty("flex-direction","column"),m(b,()=>console.log("[ContentApp] Rendering with completion data:",J()),p),_.style.setProperty("height","48px"),m(I,h(R,{get when(){return M()},get children(){var x=us();return x.$$click=()=>X(!1),x.style.setProperty("color","#a8a8a8"),x}}),f),f.$$click=E,f.style.setProperty("color","#a8a8a8"),m(S,h(R,{get when(){return J()},get fallback(){return h(R,{get when(){return!l()},get fallback(){return ys()},get children(){return h(R,{get when(){var x,D;return(D=(x=o())==null?void 0:x.lyrics)==null?void 0:D.lines},get fallback(){return ps()},get children(){var x=ms(),D=x.firstChild;return m(D,h(dr,{get score(){return se(()=>!!U())()?U().score():0},rank:1,get lyrics(){var L,Q;return((Q=(L=o())==null?void 0:L.lyrics)==null?void 0:Q.lines)||[]},get currentTime(){return se(()=>!!U())()?U().currentTime():V()*1e3},leaderboard:[],get isPlaying(){return se(()=>!!U())()?U().isPlaying()||U().countdown()!==null:B()||y()!==null},onStart:N,onSpeedChange:L=>{console.log("[ContentApp] Speed changed:",L),$(L);const Q=U();Q?(console.log("[ContentApp] Applying speed change to session"),Q.handleSpeedChange(L)):console.log("[ContentApp] No session yet, speed will be applied when session starts");const re=P();if(re){const ee=L==="0.5x"?.5:L==="0.75x"?.75:1;console.log("[ContentApp] Setting audio playback rate directly to:",ee),re.playbackRate=ee}},get isRecording(){return se(()=>!!U())()?U().isRecording():!1},get lineScores(){return se(()=>!!U())()?U().lineScores():[]}})),m(x,h(R,{get when(){return se(()=>!!U())()?U().countdown()!==null:y()!==null},get children(){var L=gs(),Q=L.firstChild,re=Q.firstChild;return m(re,(()=>{var ee=se(()=>!!U());return()=>ee()?U().countdown():y()})()),L}}),null),x}})}})},get children(){return h(R,{get when(){return M()},get fallback(){return h(hr,{get children(){var x=bs();return m(x,h(R,{get when(){return!J().isLoading},get fallback(){return ws()},get children(){return h(pr,{class:"h-full",get score(){return J().score},rank:1,get speed(){return z()},get feedbackText(){return se(()=>J().score>=95)()?"Perfect! You nailed it!":se(()=>J().score>=85)()?"Excellent performance!":se(()=>J().score>=70)()?"Great job!":J().score>=50?"Good effort!":"Keep practicing!"},onPractice:()=>{console.log("[ContentApp] Practice errors clicked"),X(!0)}})}})),x}})},get children(){var x=ds();return m(x,h(cs,{get sessionId(){var D;return(D=J())==null?void 0:D.sessionId},onBack:()=>X(!1)})),x}})}})),b}})]};le(["click"]);const xs={matches:["*://soundcloud.com/*","*://soundcloak.com/*","*://sc.maid.zone/*","*://*.maid.zone/*"],runAt:"document_idle",cssInjectionMode:"ui",async main(e){if(window.top!==window.self)return;(await Nn(e,{name:"scarlett-karaoke-ui",position:"overlay",anchor:"body",onMount:async n=>{const r=document.createElement("div");return r.className="karaoke-widget-container",n.appendChild(r),un(()=>h(vs,{}),r)},onRemove:n=>{n==null||n()}})).mount()}},Oe=class Oe extends Event{constructor(t,n){super(Oe.EVENT_NAME,{}),this.newUrl=t,this.oldUrl=n}};oe(Oe,"EVENT_NAME",ot("wxt:locationchange"));let st=Oe;function ot(e){var t;return`${(t=we==null?void 0:we.runtime)==null?void 0:t.id}:content:${e}`}function ks(e){let t,n;return{run(){t==null&&(n=new URL(location.href),t=e.setInterval(()=>{let r=new URL(location.href);r.href!==n.href&&(window.dispatchEvent(new st(r,n)),n=r)},1e3))}}}const Se=class Se{constructor(t,n){oe(this,"isTopFrame",window.self===window.top);oe(this,"abortController");oe(this,"locationWatcher",ks(this));oe(this,"receivedMessageIds",new Set);this.contentScriptName=t,this.options=n,this.abortController=new AbortController,this.isTopFrame?(this.listenForNewerScripts({ignoreFirstEvent:!0}),this.stopOldScripts()):this.listenForNewerScripts()}get signal(){return this.abortController.signal}abort(t){return this.abortController.abort(t)}get isInvalid(){return we.runtime.id==null&&this.notifyInvalidated(),this.signal.aborted}get isValid(){return!this.isInvalid}onInvalidated(t){return this.signal.addEventListener("abort",t),()=>this.signal.removeEventListener("abort",t)}block(){return new Promise(()=>{})}setInterval(t,n){const r=setInterval(()=>{this.isValid&&t()},n);return this.onInvalidated(()=>clearInterval(r)),r}setTimeout(t,n){const r=setTimeout(()=>{this.isValid&&t()},n);return this.onInvalidated(()=>clearTimeout(r)),r}requestAnimationFrame(t){const n=requestAnimationFrame((...r)=>{this.isValid&&t(...r)});return this.onInvalidated(()=>cancelAnimationFrame(n)),n}requestIdleCallback(t,n){const r=requestIdleCallback((...s)=>{this.signal.aborted||t(...s)},n);return this.onInvalidated(()=>cancelIdleCallback(r)),r}addEventListener(t,n,r,s){var a;n==="wxt:locationchange"&&this.isValid&&this.locationWatcher.run(),(a=t.addEventListener)==null||a.call(t,n.startsWith("wxt:")?ot(n):n,r,{...s,signal:this.signal})}notifyInvalidated(){this.abort("Content script context invalidated"),Ze.debug(`Content script "${this.contentScriptName}" context invalidated`)}stopOldScripts(){window.postMessage({type:Se.SCRIPT_STARTED_MESSAGE_TYPE,contentScriptName:this.contentScriptName,messageId:Math.random().toString(36).slice(2)},"*")}verifyScriptStartedEvent(t){var a,o,i;const n=((a=t.data)==null?void 0:a.type)===Se.SCRIPT_STARTED_MESSAGE_TYPE,r=((o=t.data)==null?void 0:o.contentScriptName)===this.contentScriptName,s=!this.receivedMessageIds.has((i=t.data)==null?void 0:i.messageId);return n&&r&&s}listenForNewerScripts(t){let n=!0;const r=s=>{if(this.verifyScriptStartedEvent(s)){this.receivedMessageIds.add(s.data.messageId);const a=n;if(n=!1,a&&(t!=null&&t.ignoreFirstEvent))return;this.notifyInvalidated()}};addEventListener("message",r),this.onInvalidated(()=>removeEventListener("message",r))}};oe(Se,"SCRIPT_STARTED_MESSAGE_TYPE",ot("wxt:content-script-started"));let it=Se;function Os(){}function Me(e,...t){}const Ss={debug:(...e)=>Me(console.debug,...e),log:(...e)=>Me(console.log,...e),warn:(...e)=>Me(console.warn,...e),error:(...e)=>Me(console.error,...e)},Cs=(async()=>{try{const{main:e,...t}=xs,n=new it("content",t);return await e(n)}catch(e){throw Ss.error('The content script "content" crashed on startup!',e),e}})(),Lt=Object.freeze(Object.defineProperty({__proto__:null,default:{common:{buttons:{start:"Start",stop:"Stop",continue:"Continue",cancel:"Cancel",back:"Back",next:"Next",skip:"Skip",save:"Save",share:"Share"},status:{loading:"Loading...",ready:"Ready",recording:"Recording",processing:"Processing...",error:"Error",success:"Success",offline:"Offline"},speed:{label:"Speed",slow:"Slow",normal:"Normal",fast:"Fast"}},karaoke:{header:{title:"Karaoke Session",subtitle:"Sing along and have fun!",songBy:"by {{artist}}"},lyrics:{loading:"Loading lyrics...",noLyrics:"No lyrics available",scrollPrompt:"Scroll to see more"},recording:{listening:"Listening...",speak:"Start singing!",processing:"Processing your performance..."},scoring:{perfect:"Perfect! You nailed every note!",excellent:"Excellent performance!",great:"Great job!",good:"Good performance!",keepPracticing:"Keep practicing!",score:"Score",accuracy:"Accuracy",timing:"Timing"},completion:{title:"Performance Complete!",performanceComplete:"You've completed the song!",yourScore:"Your score: {{score}}",sharePrompt:"Share your performance",shareMessage:"I just scored {{score}} on {{song}} by {{artist}}! 🎤",playAgain:"Play Again",tryAnotherSong:"Try Another Song",downloadRecording:"Download Recording"},leaderboard:{title:"Leaderboard",topPerformers:"Top Performers",yourRank:"Your Rank: #{{rank}}",anonymous:"Anonymous"}},display:{scorePanel:{currentScore:"Current Score",bestScore:"Best Score",streak:"Streak",multiplier:"{{value}}x Multiplier"}}}},Symbol.toStringTag,{value:"Module"})),$s=Object.freeze(Object.defineProperty({__proto__:null,default:{common:{buttons:{start:"开始",stop:"停止",continue:"继续",cancel:"取消",back:"返回",next:"下一步",skip:"跳过",save:"保存",share:"分享"},status:{loading:"加载中...",ready:"准备就绪",recording:"录音中",processing:"处理中...",error:"错误",success:"成功",offline:"离线"},speed:{label:"速度",slow:"慢速",normal:"正常",fast:"快速"}},karaoke:{header:{title:"卡拉OK时间",subtitle:"跟着唱，享受乐趣！",songBy:"演唱：{{artist}}"},lyrics:{loading:"歌词加载中...",noLyrics:"暂无歌词",scrollPrompt:"滚动查看更多"},recording:{listening:"聆听中...",speak:"开始唱歌吧！",processing:"正在处理您的表演..."},scoring:{perfect:"完美！每个音符都唱对了！",excellent:"表现出色！",great:"唱得很棒！",good:"表现不错！",keepPracticing:"继续加油！",score:"得分",accuracy:"准确度",timing:"节奏感"},completion:{title:"演唱完成！",performanceComplete:"您已完成这首歌！",yourScore:"您的得分：{{score}}",sharePrompt:"分享您的表演",shareMessage:"我刚在《{{song}}》（{{artist}}）中获得了{{score}}分！🎤",playAgain:"再唱一次",tryAnotherSong:"换首歌试试",downloadRecording:"下载录音"},leaderboard:{title:"排行榜",topPerformers:"最佳表演者",yourRank:"您的排名：第{{rank}}名",anonymous:"匿名用户"}},display:{scorePanel:{currentScore:"当前得分",bestScore:"最高得分",streak:"连击",multiplier:"{{value}}倍加成"}}}},Symbol.toStringTag,{value:"Module"}));return Cs}();
content;
